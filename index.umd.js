!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("quill")):"function"==typeof define&&define.amd?define(["exports","quill"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TableUp={},t.Quill)}(this,(function(t,e){"use strict";const s={container:"table-up-container",tableWrapper:"table-up",tableMain:"table-up-main",tableColgroup:"table-up-colgroup",tableCol:"table-up-col",tableBody:"table-up-body",tableRow:"table-up-row",tableCell:"table-up-cell",tableCellInner:"table-up-cell-inner"},i={colMinWidthPre:5,colMinWidthPx:40,colDefaultWidth:"100",rowMinHeightPx:36},o={AFTER_TABLE_RESIZE:"after-table-resize"},n=[["rgb(255, 255, 255)","rgb(0, 0, 0)","rgb(72, 83, 104)","rgb(41, 114, 244)","rgb(0, 163, 245)","rgb(49, 155, 98)","rgb(222, 60, 54)","rgb(248, 136, 37)","rgb(245, 196, 0)","rgb(153, 56, 215)"],["rgb(242, 242, 242)","rgb(127, 127, 127)","rgb(243, 245, 247)","rgb(229, 239, 255)","rgb(229, 246, 255)","rgb(234, 250, 241)","rgb(254, 233, 232)","rgb(254, 243, 235)","rgb(254, 249, 227)","rgb(253, 235, 255)"],["rgb(216, 216, 216)","rgb(89, 89, 89)","rgb(197, 202, 211)","rgb(199, 220, 255)","rgb(199, 236, 255)","rgb(195, 234, 213)","rgb(255, 201, 199)","rgb(255, 220, 196)","rgb(255, 238, 173)","rgb(242, 199, 255)"],["rgb(191, 191, 191)","rgb(63, 63, 63)","rgb(128, 139, 158)","rgb(153, 190, 255)","rgb(153, 221, 255)","rgb(152, 215, 182)","rgb(255, 156, 153)","rgb(255, 186, 132)","rgb(255, 226, 112)","rgb(213, 142, 255)"],["rgb(165, 165, 165)","rgb(38, 38, 38)","rgb(53, 59, 69)","rgb(20, 80, 184)","rgb(18, 116, 165)","rgb(39, 124, 79)","rgb(158, 30, 26)","rgb(184, 96, 20)","rgb(163, 130, 0)","rgb(94, 34, 129)"],["rgb(147, 147, 147)","rgb(13, 13, 13)","rgb(36, 39, 46)","rgb(12, 48, 110)","rgb(10, 65, 92)","rgb(24, 78, 50)","rgb(88, 17, 14)","rgb(92, 48, 10)","rgb(102, 82, 0)","rgb(59, 21, 81)"]],l=(t,e="table-up")=>{const s=e?`${e}-`:"";return{b:()=>`${s}${t}`,be:e=>e?`${s}${t}__${e}`:"",bm:e=>e?`${s}${t}--${e}`:"",bem:(e,i)=>e&&i?`${s}${t}__${e}--${i}`:"",ns:t=>t?`${s}${t}`:"",bs:e=>e?`${s}${t}-${e}`:"",cv:t=>t?`--${s}${t}`:"",is:t=>`is-${t}`}},r=t=>"function"==typeof t,a=Array.isArray,c=t=>"string"==typeof t,d=t=>{const{type:e="default",content:s}=t||{},i=l("button"),o=document.createElement("button");return o.classList.add(i.b(),e),s&&(c(s)?o.textContent=s:o.appendChild(s)),o},h=function(t,e){return t=Math.min(e,Math.max(0,Number.parseFloat(`${t}`))),Math.abs(t-e)<1e-6?1:t%e/Number.parseFloat(e)},u=t=>({h:Math.min(360,Math.max(0,t.h)),s:Math.min(100,Math.max(0,t.s)),b:Math.min(100,Math.max(0,t.b)),a:Math.min(1,Math.max(0,t.a))}),b=t=>{let{r:e,g:s,b:i,a:o}=t;e=h(e,255),s=h(s,255),i=h(i,255);const n=Math.max(e,s,i),l=Math.min(e,s,i);let r;const a=n,c=n-l,d=0===n?0:c/n;if(n===l)r=0;else{switch(n){case e:r=(s-i)/c+(s<i?6:0);break;case s:r=(i-e)/c+2;break;case i:r=(e-s)/c+4}r/=6}return{h:360*r,s:100*d,b:100*a,a:o}},p=t=>{let{h:e,s:s,b:i,a:o}=t;e=6*h(e,360),s=h(s,100),i=h(i,100);const n=Math.floor(e),l=e-n,r=i*(1-s),a=i*(1-l*s),c=i*(1-(1-l)*s),d=n%6,u=[i,a,r,r,c,i][d],b=[c,i,i,a,r,r][d],p=[r,r,c,i,i,a][d];return{r:Math.round(255*u),g:Math.round(255*b),b:Math.round(255*p),a:o}},m=t=>{const e=[t.r.toString(16),t.g.toString(16),t.b.toString(16),Math.round(255*t.a).toString(16)];for(const t in e)1===e[t].length&&(e[t]=`0${e[t]}`);return e.join("")},f=t=>m(p(t)),g=(t={})=>{const e=230,s=150,i=10;let o=b((n=(n=t.color||"#ff0000").startsWith("#")?n.slice(1):n,{r:Number.parseInt(n.slice(0,2),16),g:Number.parseInt(n.slice(2,4),16),b:Number.parseInt(n.slice(4,6),16),a:Number((Number.parseInt(n.slice(6,8)||"ff",16)/255).toFixed(2))}));var n;const r=l("color-picker"),a=document.createElement("div");a.classList.add(r.b());const c=document.createElement("div");c.classList.add(r.be("content"));const d=document.createElement("div");d.classList.add(r.be("selector"));const h=document.createElement("div");h.classList.add(r.be("background")),d.appendChild(h);const g=document.createElement("div");g.classList.add(r.be("background-handle")),h.appendChild(g);const w=document.createElement("div");w.classList.add(r.be("alpha"));const v=document.createElement("div");v.classList.add(r.be("alpha-bg"));const x=document.createElement("div");x.classList.add(r.be("alpha-handle")),w.appendChild(v),w.appendChild(x);const C=document.createElement("div");C.classList.add(r.be("hue"));const y=document.createElement("div");y.classList.add(r.be("hue-handle")),C.appendChild(y);const M=document.createElement("div");M.classList.add(r.be("action"));const[I,L,N,E]=["r","g","b","a"].map((t=>{const e=document.createElement("div");e.classList.add(r.be("action-item"),t);const s=document.createElement("label");s.textContent=t.toUpperCase();const i=document.createElement("input");return i.classList.add(r.be("input")),i.addEventListener("input",(()=>{i.value=i.value.replaceAll(/[^0-9]/g,"")})),i.addEventListener("change",(()=>{let e=Math.round(Number(i.value));"a"===t&&(e/=100);z(u(b(Object.assign({},p(o),{[t]:e})))),k()})),e.appendChild(s),e.appendChild(i),M.appendChild(e),i}));c.appendChild(C),c.appendChild(d),c.appendChild(w),a.appendChild(c),a.appendChild(M);let S=!1,T=!1,R=!1;function B(){const t=f(o);for(const[e,s]of[I,L,N].entries())s.value=String(Number.parseInt(t[2*e]+t[2*e+1],16));E.value=String((100*o.a).toFixed(0))}function k(){Object.assign(g.style,{left:`${Math.floor(e*o.s/100)}px`,top:`${Math.floor(s*(100-o.b)/100)}px`}),d.style.backgroundColor=`#${m(p({h:o.h,s:100,b:100,a:1}))}`,y.style.top=`${Math.floor(s-s*o.h/360)}px`,x.style.left=100*o.a+"%",function(){const{r:t,g:e,b:s}=p(o);v.style.background=`linear-gradient(to right, rgba(${t}, ${e}, ${s}, 0) 0%, rgba(${t}, ${e}, ${s}, 1) 100%)`}(),B()}function z(e){o=u(Object.assign({},o,e)),B(),t.onChange&&t.onChange(`#${f(o)}`)}function O(t){const i=d.getBoundingClientRect(),o=i.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),n=i.left+document.body.scrollLeft;z({s:Math.floor(100*Math.max(0,Math.min(e,t.pageX-n))/e),b:Math.floor(100*(s-Math.max(0,Math.min(s,t.pageY-o)))/s)}),k()}function A(t){const e=C.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0);z({h:Math.floor(360*(s-Math.max(0,Math.min(s,t.pageY-e)))/s)}),k()}function $(t){const{pageX:e}=t,s=w.getBoundingClientRect();let o=e-s.left;o=Math.max(i/2,o),o=Math.min(o,s.width-i/2),z({a:Math.round((o-5)/(s.width-10)*100)/100}),k()}function q(t){S&&(t.preventDefault(),O(t)),T&&(t.preventDefault(),A(t)),R&&(t.preventDefault(),$(t))}function W(){document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",W),S=!1}function H(){document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",H),T=!1}function D(){document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",D),R=!1}return d.addEventListener("mousedown",(function(t){document.addEventListener("mousemove",q),document.addEventListener("mouseup",W),S=!0,O(t)})),C.addEventListener("mousedown",(function(t){document.addEventListener("mousemove",q),document.addEventListener("mouseup",H),T=!0,A(t)})),w.addEventListener("mousedown",(function(t){document.addEventListener("mousemove",q),document.addEventListener("mouseup",D),R=!0,$(t)})),k(),a};let w=8e3;const v=({child:t,target:e=document.body,beforeClose:s=()=>{}}={})=>{const i=l("dialog"),o=e,n=document.createElement("div");n.classList.add(i.b()),n.style.zIndex=String(w);const r=document.createElement("div");if(r.classList.add(i.be("overlay")),n.appendChild(r),t){const e=document.createElement("div");e.classList.add(i.be("content")),e.appendChild(t),r.appendChild(e),e.addEventListener("click",(t=>{t.stopPropagation()}))}const a=getComputedStyle(o).overflow;o.style.overflow="hidden",o.appendChild(n);const c=()=>{s(),n.remove(),o.style.overflow=a};return n.addEventListener("click",c),w+=1,{dialog:n,close:c}},x=(t,e)=>{const s=l("input");e.type||(e.type="text"),e.value||(e.value="");const i=document.createElement("div");if(i.classList.add(s.be("item")),t){const e=document.createElement("span");e.classList.add(s.be("label")),e.textContent=t,i.appendChild(e)}const o=document.createElement("div");o.classList.add(s.be("input"));const n=document.createElement("input");for(const t in e)n.setAttribute(t,e[t]);(e.max||e.min)&&n.addEventListener("blur",(()=>{e.max&&e.max<=Number(n.value)&&(n.value=String(e.max)),e.min&&e.min>=Number(n.value)&&(n.value=String(e.min))})),o.appendChild(n),i.appendChild(o),n.addEventListener("focus",(()=>{o.classList.add("focus")})),n.addEventListener("blur",(()=>{o.classList.remove("focus")}));return{item:i,input:n,errorTip:t=>{let e;o.classList.contains("error")?e=o.querySelector(`.${s.be("error-tip")}`):(e=document.createElement("span"),e.classList.add(s.be("error-tip")),o.appendChild(e)),e.textContent=t,o.classList.add("error");return{removeError:()=>{o.classList.remove("error"),e.remove()}}}}},C=(t={})=>{const e=l("select-box"),s=document.createElement("div");s.classList.add(e.b());const i=document.createElement("div");i.classList.add(e.be("block"));for(let s=0;s<(t.row||8);s++)for(let o=0;o<(t.col||8);o++){const t=document.createElement("div");t.classList.add(e.be("item")),t.dataset.row=String(s+1),t.dataset.col=String(o+1),i.appendChild(t)}const o=()=>{const{row:t,col:e}=s.dataset;for(const t of Array.from(i.querySelectorAll(".active")))t.classList.remove("active");if(!t||!e)return;const o=Array.from(i.children);for(let s=0;s<o.length;s++){const{row:i,col:n}=o[s].dataset;if(i>t&&n>e)return;i<=t&&n<=e?o[s].classList.add("active"):o[s].classList.remove("active")}};if(i.addEventListener("mousemove",(t=>{if(!t.target)return;const{row:e,col:i}=t.target.dataset;e&&i&&(s.dataset.row=e,s.dataset.col=i,o())})),i.addEventListener("mouseleave",(()=>{s.removeAttribute("data-row"),s.removeAttribute("data-col"),o()})),i.addEventListener("click",(()=>{const{row:e,col:i}=s.dataset;e&&i&&t.onSelect&&t.onSelect(Number(e),Number(i))})),s.appendChild(i),t.customBtn){const i=t.texts||{},o=document.createElement("div");o.classList.add(e.be("custom")),o.textContent=i.customBtnText||"Custom",o.addEventListener("click",(async()=>{const e=await(async(t={})=>{const e=l("table-creator"),s=document.createElement("div");s.classList.add(e.b());const i=document.createElement("div");i.classList.add(e.be("input"));const{item:o,input:n,errorTip:r}=x(t.rowText||"Row",{type:"number",value:String(t.row||""),max:99}),{item:a,input:c,errorTip:h}=x(t.colText||"Column",{type:"number",value:String(t.col||""),max:99});i.appendChild(o),i.appendChild(a),s.appendChild(i);const u=document.createElement("div");u.classList.add(e.be("control"));const b=d({type:"confirm",content:t.confirmText||"Confirm"}),p=d({type:"default",content:t.cancelText||"Cancel"});u.appendChild(b),u.appendChild(p),s.appendChild(u);const m=(e=Number(n.value),s=Number(c.value))=>{if(Number.isNaN(e)||e<=0)r(t.notPositiveNumberError||"Please enter a positive integer");else{if(!(Number.isNaN(s)||s<=0))return{row:e,col:s};h(t.notPositiveNumberError||"Please enter a positive integer")}},f=t=>{"Escape"===t.key&&(close(),document.removeEventListener("keydown",f))};return new Promise(((t,e)=>{const{close:i}=v({child:s,beforeClose:e});n.focus();for(const e of[n,c])e.addEventListener("keydown",(e=>{if("Enter"===e.key){const e=m();e&&(t(e),i())}}));b.addEventListener("click",(async()=>{const e=m();e&&(t(e),i())})),document.addEventListener("keydown",f),p.addEventListener("click",i)}))})(i);e&&t.onSelect&&t.onSelect(e.row,e.col)})),s.appendChild(o)}return s},y=Math.min,M=Math.max,I=Math.round,L=Math.floor,N=t=>({x:t,y:t}),E={left:"right",right:"left",bottom:"top",top:"bottom"},S={start:"end",end:"start"};function T(t,e,s){return M(t,y(e,s))}function R(t,e){return"function"==typeof t?t(e):t}function B(t){return t.split("-")[0]}function k(t){return t.split("-")[1]}function z(t){return"x"===t?"y":"x"}function O(t){return"y"===t?"height":"width"}function A(t){return["top","bottom"].includes(B(t))?"y":"x"}function $(t){return z(A(t))}function q(t){return t.replace(/start|end/g,(t=>S[t]))}function W(t){return t.replace(/left|right|bottom|top/g,(t=>E[t]))}function H(t){const{x:e,y:s,width:i,height:o}=t;return{width:i,height:o,top:s,left:e,right:e+i,bottom:s+o,x:e,y:s}}function D(t,e,s){let{reference:i,floating:o}=t;const n=A(e),l=$(e),r=O(l),a=B(e),c="y"===n,d=i.x+i.width/2-o.width/2,h=i.y+i.height/2-o.height/2,u=i[r]/2-o[r]/2;let b;switch(a){case"top":b={x:d,y:i.y-o.height};break;case"bottom":b={x:d,y:i.y+i.height};break;case"right":b={x:i.x+i.width,y:h};break;case"left":b={x:i.x-o.width,y:h};break;default:b={x:i.x,y:i.y}}switch(k(e)){case"start":b[l]-=u*(s&&c?-1:1);break;case"end":b[l]+=u*(s&&c?-1:1)}return b}async function F(t,e){var s;void 0===e&&(e={});const{x:i,y:o,platform:n,rects:l,elements:r,strategy:a}=t,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:u=!1,padding:b=0}=R(e,t),p=function(t){return"number"!=typeof t?function(t){return{top:0,right:0,bottom:0,left:0,...t}}(t):{top:t,right:t,bottom:t,left:t}}(b),m=r[u?"floating"===h?"reference":"floating":h],f=H(await n.getClippingRect({element:null==(s=await(null==n.isElement?void 0:n.isElement(m)))||s?m:m.contextElement||await(null==n.getDocumentElement?void 0:n.getDocumentElement(r.floating)),boundary:c,rootBoundary:d,strategy:a})),g="floating"===h?{x:i,y:o,width:l.floating.width,height:l.floating.height}:l.reference,w=await(null==n.getOffsetParent?void 0:n.getOffsetParent(r.floating)),v=await(null==n.isElement?void 0:n.isElement(w))&&await(null==n.getScale?void 0:n.getScale(w))||{x:1,y:1},x=H(n.convertOffsetParentRelativeRectToViewportRelativeRect?await n.convertOffsetParentRelativeRectToViewportRelativeRect({elements:r,rect:g,offsetParent:w,strategy:a}):g);return{top:(f.top-x.top+p.top)/v.y,bottom:(x.bottom-f.bottom+p.bottom)/v.y,left:(f.left-x.left+p.left)/v.x,right:(x.right-f.right+p.right)/v.x}}function j(){return"undefined"!=typeof window}function P(t){return Y(t)?(t.nodeName||"").toLowerCase():"#document"}function V(t){var e;return(null==t||null==(e=t.ownerDocument)?void 0:e.defaultView)||window}function X(t){var e;return null==(e=(Y(t)?t.ownerDocument:t.document)||window.document)?void 0:e.documentElement}function Y(t){return!!j()&&(t instanceof Node||t instanceof V(t).Node)}function U(t){return!!j()&&(t instanceof Element||t instanceof V(t).Element)}function _(t){return!!j()&&(t instanceof HTMLElement||t instanceof V(t).HTMLElement)}function K(t){return!(!j()||"undefined"==typeof ShadowRoot)&&(t instanceof ShadowRoot||t instanceof V(t).ShadowRoot)}function Z(t){const{overflow:e,overflowX:s,overflowY:i,display:o}=st(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+s)&&!["inline","contents"].includes(o)}function G(t){return["table","td","th"].includes(P(t))}function Q(t){return[":popover-open",":modal"].some((e=>{try{return t.matches(e)}catch(t){return!1}}))}function J(t){const e=tt(),s=U(t)?st(t):t;return"none"!==s.transform||"none"!==s.perspective||!!s.containerType&&"normal"!==s.containerType||!e&&!!s.backdropFilter&&"none"!==s.backdropFilter||!e&&!!s.filter&&"none"!==s.filter||["transform","perspective","filter"].some((t=>(s.willChange||"").includes(t)))||["paint","layout","strict","content"].some((t=>(s.contain||"").includes(t)))}function tt(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function et(t){return["html","body","#document"].includes(P(t))}function st(t){return V(t).getComputedStyle(t)}function it(t){return U(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function ot(t){if("html"===P(t))return t;const e=t.assignedSlot||t.parentNode||K(t)&&t.host||X(t);return K(e)?e.host:e}function nt(t){const e=ot(t);return et(e)?t.ownerDocument?t.ownerDocument.body:t.body:_(e)&&Z(e)?e:nt(e)}function lt(t,e,s){var i;void 0===e&&(e=[]),void 0===s&&(s=!0);const o=nt(t),n=o===(null==(i=t.ownerDocument)?void 0:i.body),l=V(o);if(n){const t=rt(l);return e.concat(l,l.visualViewport||[],Z(o)?o:[],t&&s?lt(t):[])}return e.concat(o,lt(o,[],s))}function rt(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function at(t){const e=st(t);let s=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const o=_(t),n=o?t.offsetWidth:s,l=o?t.offsetHeight:i,r=I(s)!==n||I(i)!==l;return r&&(s=n,i=l),{width:s,height:i,$:r}}function ct(t){return U(t)?t:t.contextElement}function dt(t){const e=ct(t);if(!_(e))return N(1);const s=e.getBoundingClientRect(),{width:i,height:o,$:n}=at(e);let l=(n?I(s.width):s.width)/i,r=(n?I(s.height):s.height)/o;return l&&Number.isFinite(l)||(l=1),r&&Number.isFinite(r)||(r=1),{x:l,y:r}}const ht=N(0);function ut(t){const e=V(t);return tt()&&e.visualViewport?{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}:ht}function bt(t,e,s,i){void 0===e&&(e=!1),void 0===s&&(s=!1);const o=t.getBoundingClientRect(),n=ct(t);let l=N(1);e&&(i?U(i)&&(l=dt(i)):l=dt(t));const r=function(t,e,s){return void 0===e&&(e=!1),!(!s||e&&s!==V(t))&&e}(n,s,i)?ut(n):N(0);let a=(o.left+r.x)/l.x,c=(o.top+r.y)/l.y,d=o.width/l.x,h=o.height/l.y;if(n){const t=V(n),e=i&&U(i)?V(i):i;let s=t,o=rt(s);for(;o&&i&&e!==s;){const t=dt(o),e=o.getBoundingClientRect(),i=st(o),n=e.left+(o.clientLeft+parseFloat(i.paddingLeft))*t.x,l=e.top+(o.clientTop+parseFloat(i.paddingTop))*t.y;a*=t.x,c*=t.y,d*=t.x,h*=t.y,a+=n,c+=l,s=V(o),o=rt(s)}}return H({width:d,height:h,x:a,y:c})}function pt(t,e){const s=it(t).scrollLeft;return e?e.left+s:bt(X(t)).left+s}function mt(t,e,s){void 0===s&&(s=!1);const i=t.getBoundingClientRect();return{x:i.left+e.scrollLeft-(s?0:pt(t,i)),y:i.top+e.scrollTop}}function ft(t,e,s){let i;if("viewport"===e)i=function(t,e){const s=V(t),i=X(t),o=s.visualViewport;let n=i.clientWidth,l=i.clientHeight,r=0,a=0;if(o){n=o.width,l=o.height;const t=tt();(!t||t&&"fixed"===e)&&(r=o.offsetLeft,a=o.offsetTop)}return{width:n,height:l,x:r,y:a}}(t,s);else if("document"===e)i=function(t){const e=X(t),s=it(t),i=t.ownerDocument.body,o=M(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),n=M(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let l=-s.scrollLeft+pt(t);const r=-s.scrollTop;return"rtl"===st(i).direction&&(l+=M(e.clientWidth,i.clientWidth)-o),{width:o,height:n,x:l,y:r}}(X(t));else if(U(e))i=function(t,e){const s=bt(t,!0,"fixed"===e),i=s.top+t.clientTop,o=s.left+t.clientLeft,n=_(t)?dt(t):N(1);return{width:t.clientWidth*n.x,height:t.clientHeight*n.y,x:o*n.x,y:i*n.y}}(e,s);else{const s=ut(t);i={x:e.x-s.x,y:e.y-s.y,width:e.width,height:e.height}}return H(i)}function gt(t,e){const s=ot(t);return!(s===e||!U(s)||et(s))&&("fixed"===st(s).position||gt(s,e))}function wt(t,e,s){const i=_(e),o=X(e),n="fixed"===s,l=bt(t,!0,n,e);let r={scrollLeft:0,scrollTop:0};const a=N(0);if(i||!i&&!n)if(("body"!==P(e)||Z(o))&&(r=it(e)),i){const t=bt(e,!0,n,e);a.x=t.x+e.clientLeft,a.y=t.y+e.clientTop}else o&&(a.x=pt(o));const c=!o||i||n?N(0):mt(o,r);return{x:l.left+r.scrollLeft-a.x-c.x,y:l.top+r.scrollTop-a.y-c.y,width:l.width,height:l.height}}function vt(t){return"static"===st(t).position}function xt(t,e){if(!_(t)||"fixed"===st(t).position)return null;if(e)return e(t);let s=t.offsetParent;return X(t)===s&&(s=s.ownerDocument.body),s}function Ct(t,e){const s=V(t);if(Q(t))return s;if(!_(t)){let e=ot(t);for(;e&&!et(e);){if(U(e)&&!vt(e))return e;e=ot(e)}return s}let i=xt(t,e);for(;i&&G(i)&&vt(i);)i=xt(i,e);return i&&et(i)&&vt(i)&&!J(i)?s:i||function(t){let e=ot(t);for(;_(e)&&!et(e);){if(J(e))return e;if(Q(e))return null;e=ot(e)}return null}(t)||s}const yt={convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{elements:e,rect:s,offsetParent:i,strategy:o}=t;const n="fixed"===o,l=X(i),r=!!e&&Q(e.floating);if(i===l||r&&n)return s;let a={scrollLeft:0,scrollTop:0},c=N(1);const d=N(0),h=_(i);if((h||!h&&!n)&&(("body"!==P(i)||Z(l))&&(a=it(i)),_(i))){const t=bt(i);c=dt(i),d.x=t.x+i.clientLeft,d.y=t.y+i.clientTop}const u=!l||h||n?N(0):mt(l,a,!0);return{width:s.width*c.x,height:s.height*c.y,x:s.x*c.x-a.scrollLeft*c.x+d.x+u.x,y:s.y*c.y-a.scrollTop*c.y+d.y+u.y}},getDocumentElement:X,getClippingRect:function(t){let{element:e,boundary:s,rootBoundary:i,strategy:o}=t;const n=[..."clippingAncestors"===s?Q(e)?[]:function(t,e){const s=e.get(t);if(s)return s;let i=lt(t,[],!1).filter((t=>U(t)&&"body"!==P(t))),o=null;const n="fixed"===st(t).position;let l=n?ot(t):t;for(;U(l)&&!et(l);){const e=st(l),s=J(l);s||"fixed"!==e.position||(o=null),(n?!s&&!o:!s&&"static"===e.position&&o&&["absolute","fixed"].includes(o.position)||Z(l)&&!s&&gt(t,l))?i=i.filter((t=>t!==l)):o=e,l=ot(l)}return e.set(t,i),i}(e,this._c):[].concat(s),i],l=n[0],r=n.reduce(((t,s)=>{const i=ft(e,s,o);return t.top=M(i.top,t.top),t.right=y(i.right,t.right),t.bottom=y(i.bottom,t.bottom),t.left=M(i.left,t.left),t}),ft(e,l,o));return{width:r.right-r.left,height:r.bottom-r.top,x:r.left,y:r.top}},getOffsetParent:Ct,getElementRects:async function(t){const e=this.getOffsetParent||Ct,s=this.getDimensions,i=await s(t.floating);return{reference:wt(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}},getClientRects:function(t){return Array.from(t.getClientRects())},getDimensions:function(t){const{width:e,height:s}=at(t);return{width:e,height:s}},getScale:dt,isElement:U,isRTL:function(t){return"rtl"===st(t).direction}};function Mt(t,e,s,i){void 0===i&&(i={});const{ancestorScroll:o=!0,ancestorResize:n=!0,elementResize:l="function"==typeof ResizeObserver,layoutShift:r="function"==typeof IntersectionObserver,animationFrame:a=!1}=i,c=ct(t),d=o||n?[...c?lt(c):[],...lt(e)]:[];d.forEach((t=>{o&&t.addEventListener("scroll",s,{passive:!0}),n&&t.addEventListener("resize",s)}));const h=c&&r?function(t,e){let s,i=null;const o=X(t);function n(){var t;clearTimeout(s),null==(t=i)||t.disconnect(),i=null}return function l(r,a){void 0===r&&(r=!1),void 0===a&&(a=1),n();const{left:c,top:d,width:h,height:u}=t.getBoundingClientRect();if(r||e(),!h||!u)return;const b={rootMargin:-L(d)+"px "+-L(o.clientWidth-(c+h))+"px "+-L(o.clientHeight-(d+u))+"px "+-L(c)+"px",threshold:M(0,y(1,a))||1};let p=!0;function m(t){const e=t[0].intersectionRatio;if(e!==a){if(!p)return l();e?l(!1,e):s=setTimeout((()=>{l(!1,1e-7)}),1e3)}p=!1}try{i=new IntersectionObserver(m,{...b,root:o.ownerDocument})}catch(t){i=new IntersectionObserver(m,b)}i.observe(t)}(!0),n}(c,s):null;let u,b=-1,p=null;l&&(p=new ResizeObserver((t=>{let[i]=t;i&&i.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(b),b=requestAnimationFrame((()=>{var t;null==(t=p)||t.observe(e)}))),s()})),c&&!a&&p.observe(c),p.observe(e));let m=a?bt(t):null;return a&&function e(){const i=bt(t);!m||i.x===m.x&&i.y===m.y&&i.width===m.width&&i.height===m.height||s();m=i,u=requestAnimationFrame(e)}(),s(),()=>{var t;d.forEach((t=>{o&&t.removeEventListener("scroll",s),n&&t.removeEventListener("resize",s)})),null==h||h(),null==(t=p)||t.disconnect(),p=null,a&&cancelAnimationFrame(u)}}const It=function(t){return void 0===t&&(t=0),{name:"offset",options:t,async fn(e){var s,i;const{x:o,y:n,placement:l,middlewareData:r}=e,a=await async function(t,e){const{placement:s,platform:i,elements:o}=t,n=await(null==i.isRTL?void 0:i.isRTL(o.floating)),l=B(s),r=k(s),a="y"===A(s),c=["left","top"].includes(l)?-1:1,d=n&&a?-1:1,h=R(e,t);let{mainAxis:u,crossAxis:b,alignmentAxis:p}="number"==typeof h?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return r&&"number"==typeof p&&(b="end"===r?-1*p:p),a?{x:b*d,y:u*c}:{x:u*c,y:b*d}}(e,t);return l===(null==(s=r.offset)?void 0:s.placement)&&null!=(i=r.arrow)&&i.alignmentOffset?{}:{x:o+a.x,y:n+a.y,data:{...a,placement:l}}}}},Lt=function(t){return void 0===t&&(t={}),{name:"shift",options:t,async fn(e){const{x:s,y:i,placement:o}=e,{mainAxis:n=!0,crossAxis:l=!1,limiter:r={fn:t=>{let{x:e,y:s}=t;return{x:e,y:s}}},...a}=R(t,e),c={x:s,y:i},d=await F(e,a),h=A(B(o)),u=z(h);let b=c[u],p=c[h];if(n){const t="y"===u?"bottom":"right";b=T(b+d["y"===u?"top":"left"],b,b-d[t])}if(l){const t="y"===h?"bottom":"right";p=T(p+d["y"===h?"top":"left"],p,p-d[t])}const m=r.fn({...e,[u]:b,[h]:p});return{...m,data:{x:m.x-s,y:m.y-i,enabled:{[u]:n,[h]:l}}}}}},Nt=function(t){return void 0===t&&(t={}),{name:"flip",options:t,async fn(e){var s,i;const{placement:o,middlewareData:n,rects:l,initialPlacement:r,platform:a,elements:c}=e,{mainAxis:d=!0,crossAxis:h=!0,fallbackPlacements:u,fallbackStrategy:b="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:m=!0,...f}=R(t,e);if(null!=(s=n.arrow)&&s.alignmentOffset)return{};const g=B(o),w=A(r),v=B(r)===r,x=await(null==a.isRTL?void 0:a.isRTL(c.floating)),C=u||(v||!m?[W(r)]:function(t){const e=W(t);return[q(t),e,q(e)]}(r)),y="none"!==p;!u&&y&&C.push(...function(t,e,s,i){const o=k(t);let n=function(t,e,s){const i=["left","right"],o=["right","left"],n=["top","bottom"],l=["bottom","top"];switch(t){case"top":case"bottom":return s?e?o:i:e?i:o;case"left":case"right":return e?n:l;default:return[]}}(B(t),"start"===s,i);return o&&(n=n.map((t=>t+"-"+o)),e&&(n=n.concat(n.map(q)))),n}(r,m,p,x));const M=[r,...C],I=await F(e,f),L=[];let N=(null==(i=n.flip)?void 0:i.overflows)||[];if(d&&L.push(I[g]),h){const t=function(t,e,s){void 0===s&&(s=!1);const i=k(t),o=$(t),n=O(o);let l="x"===o?i===(s?"end":"start")?"right":"left":"start"===i?"bottom":"top";return e.reference[n]>e.floating[n]&&(l=W(l)),[l,W(l)]}(o,l,x);L.push(I[t[0]],I[t[1]])}if(N=[...N,{placement:o,overflows:L}],!L.every((t=>t<=0))){var E,S;const t=((null==(E=n.flip)?void 0:E.index)||0)+1,e=M[t];if(e)return{data:{index:t,overflows:N},reset:{placement:e}};let s=null==(S=N.filter((t=>t.overflows[0]<=0)).sort(((t,e)=>t.overflows[1]-e.overflows[1]))[0])?void 0:S.placement;if(!s)switch(b){case"bestFit":{var T;const t=null==(T=N.filter((t=>{if(y){const e=A(t.placement);return e===w||"y"===e}return!0})).map((t=>[t.placement,t.overflows.filter((t=>t>0)).reduce(((t,e)=>t+e),0)])).sort(((t,e)=>t[1]-e[1]))[0])?void 0:T[0];t&&(s=t);break}case"initialPlacement":s=r}if(o!==s)return{reset:{placement:s}}}return{}}}},Et=function(t){return void 0===t&&(t={}),{options:t,fn(e){const{x:s,y:i,placement:o,rects:n,middlewareData:l}=e,{offset:r=0,mainAxis:a=!0,crossAxis:c=!0}=R(t,e),d={x:s,y:i},h=A(o),u=z(h);let b=d[u],p=d[h];const m=R(r,e),f="number"==typeof m?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(a){const t="y"===u?"height":"width",e=n.reference[u]-n.floating[t]+f.mainAxis,s=n.reference[u]+n.reference[t]-f.mainAxis;b<e?b=e:b>s&&(b=s)}if(c){var g,w;const t="y"===u?"width":"height",e=["top","left"].includes(B(o)),s=n.reference[h]-n.floating[t]+(e&&(null==(g=l.offset)?void 0:g[h])||0)+(e?0:f.crossAxis),i=n.reference[h]+n.reference[t]+(e?0:(null==(w=l.offset)?void 0:w[h])||0)-(e?f.crossAxis:0);p<s?p=s:p>i&&(p=i)}return{[u]:b,[h]:p}}}},St=(t,e,s)=>{const i=new Map,o={platform:yt,...s},n={...o.platform,_c:i};return(async(t,e,s)=>{const{placement:i="bottom",strategy:o="absolute",middleware:n=[],platform:l}=s,r=n.filter(Boolean),a=await(null==l.isRTL?void 0:l.isRTL(e));let c=await l.getElementRects({reference:t,floating:e,strategy:o}),{x:d,y:h}=D(c,i,a),u=i,b={},p=0;for(let s=0;s<r.length;s++){const{name:n,fn:m}=r[s],{x:f,y:g,data:w,reset:v}=await m({x:d,y:h,initialPlacement:i,placement:u,strategy:o,middlewareData:b,rects:c,platform:l,elements:{reference:t,floating:e}});d=null!=f?f:d,h=null!=g?g:h,b={...b,[n]:{...b[n],...w}},v&&p<=50&&(p++,"object"==typeof v&&(v.placement&&(u=v.placement),v.rects&&(c=!0===v.rects?await l.getElementRects({reference:t,floating:e,strategy:o}):v.rects),({x:d,y:h}=D(c,u,a))),s=-1)}return{x:d,y:h,placement:u,strategy:o,middlewareData:b}})(t,e,{...o,platform:n})};let Tt;const Rt=(t,e={})=>{const{msg:s="",delay:i=150,content:o,direction:n="bottom",type:r="hover",container:a,onOpen:c,onClose:d,closed:h,onDestroy:u}=e,b=l("tooltip");if(s||o){Tt||(Tt=document.createElement("div"),document.body.appendChild(Tt));const e=a||Tt,l=document.createElement("div");let p,m,f;l.classList.add(b.b(),"hidden","transparent"),o?l.appendChild(o):s&&(l.textContent=s);const g=()=>{f&&f(),St(t,l,{placement:n,middleware:[Nt(),Lt({limiter:Et()}),It(4)]}).then((({x:t,y:e})=>{Object.assign(l.style,{left:`${t}px`,top:`${e}px`})}))},w=()=>{l.classList.add("hidden"),e.contains(l)&&e.removeChild(l),f&&f(),h&&h()},v=(s=!1)=>{m&&clearTimeout(m),p=setTimeout((()=>{if(c){const t=c(s);if(!s&&t)return}e.appendChild(l),l.removeEventListener("transitionend",w),l.classList.remove("hidden"),f=Mt(t,l,g),l.classList.remove("transparent")}),i)},x=(t=!1)=>{p&&clearTimeout(p),m=setTimeout((()=>{if(d){const e=d(t);if(!t&&e)return}l.addEventListener("transitionend",w,{once:!0}),l.classList.add("transparent")}),i)},C=()=>{const e=t=>{t.stopPropagation(),x(!1)},s=t=>{t.stopPropagation(),v(),document.removeEventListener("click",e),document.addEventListener("click",e,{once:!0})};return{prepare:()=>{l.addEventListener("click",(t=>t.stopPropagation())),t.addEventListener("click",s)},show:v,hide:(t=!1)=>{x(t),document.removeEventListener("click",e)},destroy:()=>{t.removeEventListener("click",s),document.removeEventListener("click",e)}}},y={hover:()=>{const e=[t,l],s=x.bind(void 0,!1),i=v.bind(void 0,!1);return{prepare:()=>{for(const t of e)t.addEventListener("mouseenter",i),t.addEventListener("mouseleave",s)},show:v,hide:x,destroy:()=>{for(const t of e)t.removeEventListener("mouseenter",i),t.removeEventListener("mouseleave",s)}}},click:C},{prepare:M,show:I,hide:L,destroy:N}=y[r]();M();const E=()=>{L(!0),u&&u(),N(),f&&f(),l.remove()};return{show:I,hide:L,destroy:E}}return null};function Bt(t,e,s=4){const{x:i,y:o,x1:n,y1:l}=t,{x:r,y:a,x1:c,y1:d}=e;return!(n<=r+s||i+s>=c||(l<=a+s||o+s>=d))}const kt=()=>Math.random().toString(36).slice(2),zt=(t,e)=>{let s;return function(...i){s&&clearTimeout(s),s=setTimeout((()=>{t.apply(this,i)}),e)}};function Ot(t,e){let s=t.parent;for(;s&&s.statics.blotName!==e&&s!==t.scroll;)s=s.parent;if(s===t.scroll)throw new Error(`${t.statics.blotName} must be a child of ${e}`);return s}function At(t,e){const s=new Array(e.length),i=new Map(e.map(((t,e)=>[t,e])));let o=t.parent;for(;o&&o!==t.scroll&&0!==i.size;){if(i.has(o.statics.blotName)){s[i.get(o.statics.blotName)]=o,i.delete(o.statics.blotName)}o=o.parent}if(i.size>0)throw new Error(`${t.statics.blotName} must be a child of ${Array.from(i.keys()).join(", ")}`);return s}function $t(t,e){for(const s of Object.getOwnPropertyNames(e))/^constructor$/.test(s)||Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(e,s));return t}function qt(t,e){const s=class extends t{constructor(...t){super(...t)}};for(const t of e)$t(s.prototype,t.prototype);return s}const Wt=t=>{let{left:e,top:s,width:i,height:o}=t;const{clientWidth:n,clientHeight:l}=document.documentElement;let r=!1,a=!1;return e+i>n?(e=n-i-8,r=!0):e<0&&(e=8,r=!0),s+o>l?(s=l-o-8,a=!0):s<0&&(s=8,a=!0),{left:e,top:s,leftLimited:r,topLimited:a}};function Ht(t,e){t.addEventListener("scroll",e),this.scrollHandler.push([t,e])}function Dt(){for(let t=0;t<this.scrollHandler.length;t++){const[e,s]=this.scrollHandler[t];e.removeEventListener("scroll",s)}this.scrollHandler=[]}const Ft=e.import("parchment"),jt=e.import("blots/container"),Pt=e.import("blots/block"),Vt=e.import("blots/block/embed");class Xt extends jt{static tagName;static blotName=s.container;static scope=Ft.Scope.BLOCK_BLOT;static allowedChildren=[Pt,Vt,jt];static requiredContainer;static defaultChild;static create(t){const e=document.createElement(this.tagName);return this.className&&e.classList.add(this.className),e}insertAt(t,e,s){const[i]=this.children.find(t);if(!i){const t=this.scroll.create(this.statics.defaultChild.blotName||"block");this.appendChild(t)}super.insertAt(t,e,s)}optimize(t){if(0===this.children.length)if(null!=this.statics.defaultChild){const t=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(t)}else this.remove();this.children.length>0&&null!=this.next&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}}const Yt=e.import("parchment"),Ut=e.import("blots/block");class _t extends Ut{replaceWith(t,e){const i="string"==typeof t?this.scroll.create(t,e):t;if(i instanceof Yt.ParentBlot){if(i.statics.blotName===s.tableCellInner){const t=this.parent;if(t.statics.blotName===s.tableCellInner){if(null!=t&&t.insertBefore(i,this.prev?null:this.next),this.parent.statics.blotName===s.tableCellInner&&this.prev){let t=this;for(;t;){const e=t.next;i.appendChild(t),t=e}}else i.appendChild(this);if(t&&0===t.length()){t.parent.remove();const e=t.parent.parent;e.statics.blotName===s.tableRow&&0===e.children.length&&e.remove()}}else null!=t&&t.insertBefore(i,this.next),i.appendChild(this);return i}this.moveChildren(i)}return null!=this.parent&&(this.parent.insertBefore(i,this.next||void 0),this.remove()),this.attributes.copy(i),i}format(t,e){if(t!==s.tableCellInner||this.parent.statics.blotName!==t||e)super.format(t,e);else{const[t,e,i]=At(this,[s.tableCell,s.tableRow,s.tableWrapper]),o=i.next;let n=e.next,l=t.next;for(i.parent.insertBefore(this,o);l;){const t=l.next;i.parent.insertBefore(l,o),l=t}for(;n;){const t=n.next;i.parent.insertBefore(n,o),n=t}}}}const Kt=e.import("formats/blockquote");class Zt extends(qt(Kt,[_t])){}const Gt=e.import("formats/code-block");class Qt extends(qt(Gt,[_t])){}const Jt=e.import("formats/header");class te extends(qt(Jt,[_t])){}const ee=e.import("formats/list");class se extends(qt(ee,[_t])){static register(){}}const ie=e.import("parchment"),oe=e.import("blots/scroll");class ne extends oe{createBlock(t,e){let i,o={};for(const[e,s]of Object.entries(t)){null!=this.query(e,ie.Scope.BLOCK&ie.Scope.BLOT)?i=e:o[e]=s}i===s.tableCellInner&&(o={...t},delete o[i]);const n=this.create(i||this.statics.defaultChild.blotName,i?t[i]:void 0);this.insertBefore(n,e||void 0);const l=n.length();for(const[t,e]of Object.entries(o))n.formatAt(0,l,t,e);return n}}const le=t=>{return e=t,!Number.isNaN(e)&&Number(e)>0?t:1;var e},re=e.import("blots/block"),ae=e.import("blots/block/embed");class ce extends Xt{static blotName=s.tableCellInner;static tagName="div";static className="ql-table-cell-inner";static allowDataAttrs=new Set(["table-id","row-id","col-id","rowspan","colspan"]);static defaultChild=re;static allowStyle=new Set(["background-color","border","height"]);static isAllowStyle(t){for(const e of this.allowStyle)if(t.startsWith(e))return!0;return!1}static create(t){const{tableId:e,rowId:s,colId:i,rowspan:o,colspan:n,style:l}=t,r=super.create();return r.dataset.tableId=e,r.dataset.rowId=s,r.dataset.colId=i,r.dataset.rowspan=String(le(o)),r.dataset.colspan=String(le(n)),l&&(r.dataset.style=l),r}static formats(t){const{tableId:e,rowId:s,colId:i,rowspan:o,colspan:n,style:l}=t.dataset,r={tableId:e,rowId:s,colId:i,rowspan:Number(le(o)),colspan:Number(le(n))};return l&&(r.style=l),r}setFormatValue(t,e,s=!1){if(s){if(!this.statics.isAllowStyle(t))return;this.parent&&(this.parent.setFormatValue(t,e),this.domNode.dataset.style=this.parent.domNode.style.cssText)}else{if(!this.statics.allowDataAttrs.has(t))return;const s=`data-${t}`;e?this.domNode.setAttribute(s,e):this.domNode.removeAttribute(s),this.parent&&this.parent.setFormatValue(t,e)}const i=this.descendants(re,0);for(const t of i)t.cache={}}get tableId(){return this.domNode.dataset.tableId}get rowId(){return this.domNode.dataset.rowId}set rowId(t){this.setFormatValue("row-id",t)}get colId(){return this.domNode.dataset.colId}set colId(t){this.setFormatValue("col-id",t)}get rowspan(){return Number(this.domNode.dataset.rowspan)}set rowspan(t){this.setFormatValue("rowspan",t)}get colspan(){return Number(this.domNode.dataset.colspan)}set colspan(t){this.setFormatValue("colspan",t)}getColumnIndex(){return Ot(this,s.tableMain).getColIds().indexOf(this.colId)}formatAt(t,e,s,i){0===this.children.length&&(this.appendChild(this.scroll.create(this.statics.defaultChild.blotName)),e+=1),super.formatAt(t,e,s,i)}formats(){const t=this.statics.formats(this.domNode);return{[this.statics.blotName]:t}}checkMerge(){const{colId:t,rowId:e,colspan:s,rowspan:i}=this,o=this.next;return null!==o&&o.statics.blotName===this.statics.blotName&&o.rowId===e&&o.colId===t&&o.colspan===s&&o.rowspan===i}optimize(){const t=this.parent,e=this.statics.formats(this.domNode);if(this.prev&&this.prev instanceof ae){const t=this.scroll.create("block");this.appendChild(this.prev),this.appendChild(t)}if(null!==t&&t.statics.blotName!==s.tableCell&&(this.wrap(s.tableCell,e),0===this.children.length)){const t=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(t)}this.children.length>0&&null!=this.next&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove()),null!=this.uiNode&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),0===this.children.length&&this.remove()}insertBefore(t,e){if(t.statics.blotName===this.statics.blotName){const i=t,o=this.statics.formats(i.domNode),n=this.statics.formats(this.domNode);if(Object.entries(n).every((([t,e])=>e===o[t])))return this.parent.insertBefore(i,this.next);{const[t,l]=At(this,[s.tableRow,s.tableCell]);if(e){const i=e.offset();if(i+1<this.length()){const e=this.scroll.create(s.tableCellInner,n);this.children.forEachAt(i+1,this.length(),(t=>{e.appendChild(t)})),t.insertBefore(e.wrap(s.tableCell,n),l.next),0===this.children.length&&(this.remove(),0===this.parent.children.length&&this.parent.remove())}}if(this.rowId!==i.rowId){if(e){const s=e.offset(t);t.split(s)}else if(l.next){const e=l.next.offset(t);t.split(e)}const n=this.scroll.create(s.tableRow,o),r=this.scroll.create(s.tableCell,o);return r.appendChild(i),n.appendChild(r),t.parent.insertBefore(n,t.next)}return t.insertBefore(i.wrap(s.tableCell,o),e?l:l.next)}}super.insertBefore(t,e)}}class de extends Xt{static blotName=s.tableRow;static tagName="tr";static className="ql-table-row";static create(t){const e=super.create();return e.dataset.tableId=t.tableId,e.dataset.rowId=t.rowId,e}get rowId(){return this.domNode.dataset.rowId}get tableId(){return this.domNode.dataset.tableId}setHeight(t){this.foreachCellInner((e=>{e.setFormatValue("height",t,!0)}))}insertCell(t,e){const i=[],o=this.children.iterator();let n,l=0;for(;(n=o())&&(l+=n.colspan,!(l>t));)if(1!==n.rowspan)for(let t=0;t<n.rowspan-1;t++)i[t]=(i[t]||0)+n.colspan;if(n&&l-n.colspan<t){n.getCellInner().colspan+=1,1!==n.rowspan&&(i.skipRowNum=n.rowspan-1)}else{const t=this.scroll.create(s.tableCell,e),i=this.scroll.create(s.tableCellInner,e),o=this.scroll.create("block");o.appendChild(this.scroll.create("break")),i.appendChild(o),t.appendChild(i),this.insertBefore(t,n)}return i}getCellByColumIndex(t){const e=[];let s=null,i=0;if(t<0)return[s,i,e];const o=this.children.iterator();for(;s=o();){if(i+=s.colspan,1!==s.rowspan)for(let t=0;t<s.rowspan-1;t++)e[t]=(e[t]||0)+s.colspan;if(i>t)break}return[s,i,e]}removeCell(t){if(t<0)return[];const e=this.getCellByColumIndex(t),[i,o]=e,n=e[2];if(!i)return n;if(o-i.colspan<t||i.colspan>1){const[e]=i.descendants(ce);if(1!==i.colspan&&t===o-i.colspan){const t=Ot(this,s.tableMain).getColIds();e.colId=t[t.indexOf(e.colId)+1]}1!==i.rowspan&&(n.skipRowNum=i.rowspan-1),e.colspan-=1}else i.remove();return n}foreachCellInner(t){const e=this.children.iterator();let s,i=0;for(;s=e();){const[e]=s.descendants(ce);if(t(e,i++))break}}checkMerge(){const t=this.next;return null!==t&&t.statics.blotName===this.statics.blotName&&t.rowId===this.rowId}optimize(t){const e=this.parent,{tableId:i}=this;null!==e&&e.statics.blotName!==s.tableBody&&this.wrap(s.tableBody,i),super.optimize(t)}}class he extends Xt{static blotName=s.tableBody;static tagName="tbody";static create(t){const e=super.create();return e.dataset.tableId=t,e}get tableId(){return this.domNode.dataset.tableId}insertRow(t){const e=Ot(this,s.tableMain);if(!e)return;const i=e.getColIds(),o=this.descendants(de),n=new Set(i);let l=0;for(const e of o){if(l===t)break;e.foreachCellInner((e=>{if(l+e.rowspan>t&&(e.rowspan+=1,n.delete(e.colId),1!==e.colspan)){const t=i.indexOf(e.colId);for(let s=0;s<e.colspan-1;s++)n.delete(i[t+s+1])}})),l+=1}const r=e.tableId,a=kt(),c=this.scroll.create(s.tableRow,{tableId:r,rowId:a});for(const t of n){const e=this.scroll.create("break").wrap("block").wrap(s.tableCellInner,{tableId:r,rowId:a,colId:t,rowspan:1,colspan:1}).wrap(s.tableCell,{tableId:r,rowId:a,colId:t,rowspan:1,colspan:1});c.appendChild(e)}this.insertBefore(c,o[t]||null)}checkMerge(){const t=this.next;return null!==t&&t.statics.blotName===this.statics.blotName&&t.tableId===this.tableId}optimize(t){const e=this.parent;if(null!==e&&e.statics.blotName!==s.tableMain){const{tableId:t}=this;this.wrap(s.tableMain,{tableId:t})}super.optimize(t)}}class ue extends Xt{static blotName=s.tableCell;static tagName="td";static className="ql-table-cell";static allowDataAttrs=new Set(["table-id","row-id","col-id"]);static allowAttrs=new Set(["rowspan","colspan"]);static allowStyle=new Set(["background-color","border","height"]);static isAllowStyle(t){for(const e of this.allowStyle)if(t.startsWith(e))return!0;return!1}static create(t){const{tableId:e,rowId:s,colId:i,rowspan:o,colspan:n,style:l}=t,r=super.create();return r.dataset.tableId=e,r.dataset.rowId=s,r.dataset.colId=i,r.setAttribute("rowspan",String(le(o))),r.setAttribute("colspan",String(le(n))),l&&(r.style.cssText=l),r}static formats(t){const{tableId:e,rowId:s,colId:i}=t.dataset,o=Number(t.getAttribute("rowspan")),n=Number(t.getAttribute("colspan")),l={tableId:e,rowId:s,colId:i,rowspan:le(o),colspan:le(n)},r={};for(let e=0;e<t.style.length;e++){const s=t.style[e],i=t.style[s];this.isAllowStyle(String(s))&&!["initial","inherit"].includes(i)&&(r[s]=i)}const a=Object.entries(r);return a.length>0&&(l.style=a.map((([t,e])=>`${t}:${e}`)).join(";")),l}setFormatValue(t,e){if(this.statics.allowAttrs.has(t)||this.statics.allowDataAttrs.has(t)){let s=t;this.statics.allowDataAttrs.has(t)&&(s=`data-${t}`),e?this.domNode.setAttribute(s,e):this.domNode.removeAttribute(s)}else this.statics.isAllowStyle(t)&&Object.assign(this.domNode.style,{[t]:e})}get tableId(){return this.domNode.dataset.tableId}get rowId(){return this.domNode.dataset.rowId}get colId(){return this.domNode.dataset.colId}get rowspan(){return Number(this.domNode.getAttribute("rowspan"))}get colspan(){return Number(this.domNode.getAttribute("colspan"))}getCellInner(){return this.children.head}checkMerge(){const{colId:t,rowId:e,colspan:s,rowspan:i}=this,o=this.next;return null!==o&&o.statics.blotName===this.statics.blotName&&o.rowId===e&&o.colId===t&&o.colspan===s&&o.rowspan===i}optimize(t){const e=this.parent,{tableId:i,rowId:o}=this;null!==e&&e.statics.blotName!==s.tableRow&&this.wrap(s.tableRow,{tableId:i,rowId:o}),super.optimize(t)}}const be=e.import("blots/block/embed");class pe extends be{scroll;domNode;static blotName=s.tableCol;static tagName="col";static validWidth(t,e){let s=Number.parseFloat(String(t));return Number.isNaN(s)&&(s=i[e?"colMinWidthPre":"colMinWidthPx"]),`${s}${e?"%":"px"}`}static create(t){const{width:e,tableId:s,colId:i,full:o,align:n}=t,l=super.create();return l.setAttribute("width",this.validWidth(e,!!o)),o&&(l.dataset.full=String(o)),n&&"left"!==n&&(l.dataset.align=n),l.dataset.tableId=s,l.dataset.colId=i,l}static value(t){const{tableId:e,colId:s}=t.dataset,o=t.getAttribute("width")||i.colDefaultWidth,n=t.dataset.align,l={tableId:e,colId:s,full:Object.hasOwn(t.dataset,"full")};return o&&(l.width=Number.parseFloat(o)),n&&(l.align=n),l}constructor(t,e){super(t,e),this.scroll=t,this.domNode=e}get width(){let t=this.domNode.getAttribute("width");if(!t){if(t=this.domNode.getBoundingClientRect().width,this.full){const e=this.domNode.closest("table");return e?t/100*e.getBoundingClientRect().width:i[this.full?"colMinWidthPre":"colMinWidthPx"]}return t}return Number.parseFloat(String(t))}set width(t){let e=Number.parseFloat(String(t));Number.isNaN(e)&&(e=i[this.full?"colMinWidthPre":"colMinWidthPx"]),this.domNode.setAttribute("width",this.statics.validWidth(e,!!this.full))}get tableId(){return this.domNode.dataset.tableId}get colId(){return this.domNode.dataset.colId}get full(){return Object.hasOwn(this.domNode.dataset,"full")}get align(){return this.domNode.dataset.align||""}set align(t){"right"===t||"center"===t?this.domNode.dataset.align=t:this.domNode.removeAttribute("data-align")}checkMerge(){const t=this.next,{tableId:e,colId:s}=this;return null!==t&&t.statics.blotName===this.statics.blotName&&t.tableId===e&&t.colId===s}optimize(t){const e=this.parent;if(null!=e&&e.statics.blotName!==s.tableColgroup){const t=this.statics.value(this.domNode);this.wrap(s.tableColgroup,t)}Ot(this,s.tableColgroup).align=this.align,super.optimize(t)}insertAt(t,e,i){if(null!=i)return void super.insertAt(t,e,i);const o=e.split("\n"),n=o.pop(),l=o.map((t=>{const e=this.scroll.create("block");return e.insertAt(0,t),e})),r=this.split(t),[a,c]=At(this,[s.tableColgroup,s.tableMain]),d=a.next;if(r){const t=r.offset(a);a.split(t)}let h=c.parent.parent,u=c.parent.next;if(d){const t=d.descendants(ce);if(t.length>0){const e=t[0],i=ce.formats(e.domNode),o=this.scroll.create("block"),n=o.wrap(s.tableCellInner,i).wrap(s.tableCell,i).wrap(s.tableRow,i).wrap(s.tableBody,i.tableId);a.parent.insertBefore(n,a.next),h=o,u=o.next}}for(const t of l)h.insertBefore(t,u);n&&h.insertBefore(this.scroll.create("text",n),u)}}class me extends Xt{static blotName=s.tableMain;static tagName="table";static create(t){const e=super.create(),{tableId:s,full:i,align:o}=t;return e.dataset.tableId=s,"right"===o||"center"===o?e.dataset.align=o:e.removeAttribute("date-align"),i&&(e.dataset.full=String(i)),e.classList.add("ql-table"),e.setAttribute("cellpadding","0"),e.setAttribute("cellspacing","0"),e}constructor(t,e,s){super(t,e),this.updateAlign()}colWidthFillTable(){if(this.full)return;const t=this.getCols();if(!t)return;const e=t.reduce(((t,e)=>e.width+t),0);return 0===e||Number.isNaN(e)?null:(this.domNode.style.width=`${e}px`,e)}get tableId(){return this.domNode.dataset.tableId}get full(){return Object.hasOwn(this.domNode.dataset,"full")}get align(){return this.domNode.dataset.align||""}set align(t){"right"===t||"center"===t?this.domNode.dataset.align=t:this.domNode.removeAttribute("data-align"),this.updateAlign()}cancelFull(){if(!this.full)return;const t=this.getCols(),e=this.domNode.getBoundingClientRect().width;for(const s of t)s.domNode.removeAttribute("data-full"),s.width=s.width/100*e;const i=this.children.head;i&&i.statics.blotName===s.tableColgroup&&(i.full=!1),this.domNode.removeAttribute("data-full"),this.colWidthFillTable()}updateAlign(){const t={marginLeft:null,marginRight:null};switch(this.align){case"center":t.marginLeft="auto",t.marginRight="auto";break;case"":case"left":t.marginRight="auto";break;case"right":t.marginLeft="auto"}Object.assign(this.domNode.style,t)}getRows(){return this.descendants(de)}getRowIds(){return this.getRows().map((t=>t.rowId))}getCols(){return this.descendants(pe)}getColIds(){return this.getCols().map((t=>t.colId))}checkMerge(){const t=this.next;return null!==t&&t.statics.blotName===this.statics.blotName&&t.domNode.dataset.tableId===this.tableId}optimize(t){const e=this.parent;null!==e&&e.statics.blotName!==s.tableWrapper&&this.wrap(s.tableWrapper,this.tableId),super.optimize(t)}}class fe extends Xt{static blotName=s.tableColgroup;static tagName="colgroup";static create(t){const e=super.create();return e.dataset.tableId=t.tableId,t.full&&(e.dataset.full=String(t.full)),t.align&&"left"!==t.align&&(e.dataset.align=t.align),e.setAttribute("contenteditable","false"),e}get tableId(){return this.domNode.dataset.tableId}get full(){return Object.hasOwn(this.domNode.dataset,"full")}set full(t){t?this.domNode.dataset.full="true":this.domNode.removeAttribute("data-full")}get align(){return this.domNode.dataset.align||""}set align(t){"right"===t||"center"===t?this.domNode.dataset.align=t:this.domNode.removeAttribute("data-align")}findCol(t){const e=this.children.iterator();let s,i=0;for(;(s=e())&&i!==t;)i++;return s}insertColByIndex(t,e){const o=this.parent;if(!(o instanceof me))throw new TypeError("TableColgroupFormat should be child of TableFormat");const n=this.findCol(t),l=this.scroll.create(s.tableCol,e);if(o.full){const t=this.children.iterator();let e;for(;e=t();)if(e.width-l.width>=i.colMinWidthPre){e.width-=l.width;break}}this.insertBefore(l,n)}removeColByIndex(t){const e=this.parent;if(!(e instanceof me))throw new TypeError("TableColgroupFormat should be child of TableMainFormat");const s=this.findCol(t);s&&(e.full&&(s.next?s.next.width+=s.width:s.prev&&(s.prev.width+=s.width)),s.remove(),e.colWidthFillTable())}checkMerge(){const t=this.next,e=this.parent;return e instanceof me&&!e.full&&e.colWidthFillTable(),null!==t&&t.statics.blotName===this.statics.blotName&&t.tableId===this.tableId}optimize(t){const e=this.parent,{tableId:i,full:o,align:n}=this;null!=e&&e.statics.blotName!==s.tableMain&&this.wrap(s.tableMain,{tableId:i,full:o,align:n});Ot(this,s.tableMain).align=n,super.optimize(t)}}class ge extends Xt{static blotName=s.tableWrapper;static tagName="div";static className="ql-table-wrapper";static create(t){const e=super.create();return e.dataset.tableId=t,e.addEventListener("dragstart",(t=>{t.preventDefault(),t.stopPropagation()}),!0),e.addEventListener("drop",(t=>{t.preventDefault()})),e.addEventListener("dragover",(t=>{t.preventDefault(),t.dataTransfer.dropEffect="none"})),e}get tableId(){return this.domNode.dataset.tableId}checkMerge(){const t=this.next;return null!==t&&t.statics.blotName===this.statics.blotName&&t.tableId===this.tableId}deleteAt(t,e){super.deleteAt(t,e);const s=this.descendants(he),i=this.descendants(fe);0!==s.length&&0!==i.length||this.remove()}}const we="color-selector",ve=[{name:"InsertTop",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm17.94 4.5h-2v4h-2v-4h-2l3-3z"/></svg>',tip:"Insert row above",handle:t=>{t.appendRow(!1),t.hideTableTools()}},{name:"InsertRight",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm15.44 8v-2h-4v-2h4v-2l3 3z"/></svg>',tip:"Insert column right",handle:t=>{t.appendCol(!0),t.hideTableTools()}},{name:"InsertBottom",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm11.94 5.5h2v-4h2v4h2l-3 3z"/></svg>',tip:"Insert row below",handle:t=>{t.appendRow(!0),t.hideTableTools()}},{name:"InsertLeft",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm14.44 2v2h4v2h-4v2l-3-3z"/></svg>',tip:"Insert column Left",handle:t=>{t.appendCol(!1),t.hideTableTools()}},{name:"break"},{name:"MergeCell",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M5 10H3V4h8v2H5zm14 8h-6v2h8v-6h-2zM5 18v-4H3v6h8v-2zM21 4h-8v2h6v4h2zM8 13v2l3-3l-3-3v2H3v2zm8-2V9l-3 3l3 3v-2h5v-2z"/></svg>',tip:"Merge Cell",handle:t=>{t.mergeCells(),t.hideTableTools()}},{name:"SplitCell",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M19 14h2v6H3v-6h2v4h14zM3 4v6h2V6h14v4h2V4zm8 7v2H8v2l-3-3l3-3v2zm5 0V9l3 3l-3 3v-2h-3v-2z"/></svg>',tip:"Split Cell",handle:t=>{t.splitCell(),t.hideTableTools()}},{name:"break"},{name:"DeleteRow",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M9.41 13L12 15.59L14.59 13L16 14.41L13.41 17L16 19.59L14.59 21L12 18.41L9.41 21L8 19.59L10.59 17L8 14.41zM22 9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2zM4 9h4V6H4zm6 0h4V6h-4zm6 0h4V6h-4z"/></svg>',tip:"Delete Row",handle:t=>{t.removeRow(),t.hideTableTools()}},{name:"DeleteColumn",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M4 2h7a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h7v-4zm0 6v4h7v-4zM4 4v4h7V4zm13.59 8L15 9.41L16.41 8L19 10.59L21.59 8L23 9.41L20.41 12L23 14.59L21.59 16L19 13.41L16.41 16L15 14.59z"/></svg>',tip:"Delete Column",handle:t=>{t.removeCol(),t.hideTableTools()}},{name:"DeleteTable",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="m15.46 15.88l1.42-1.42L19 16.59l2.12-2.13l1.42 1.42L20.41 18l2.13 2.12l-1.42 1.42L19 19.41l-2.12 2.13l-1.42-1.42L17.59 18zM4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4z"/></svg>',tip:"Delete table",handle:t=>{t.deleteTable()}},{name:"break"},{name:"BackgroundColor",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m4 8l4-4m6 0L4 14m0 6L20 4m0 6L10 20m10-4l-4 4"/></svg>',isColorChoose:!0,tip:"Set background color",key:"background-color",handle:(t,e,s)=>{t.setCellAttrs(e,"background-color",s,!0)}},{name:"BorderColor",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m12.01 16l-.01.011M12.01 12l-.01.011M12.01 8l-.01.011M8.01 12l-.01.011M16.01 12l-.01.011M21 3.6v16.8a.6.6 0 0 1-.6.6H3.6a.6.6 0 0 1-.6-.6V3.6a.6.6 0 0 1 .6-.6h16.8a.6.6 0 0 1 .6.6"/></svg>',isColorChoose:!0,tip:"Set border color",key:"border-color",handle:(t,e,s)=>{t.setCellAttrs(e,"border-color",s,!0)}}],xe=new Set,Ce=l("color-map"),ye={selectWrapper:Ce.b(),used:Ce.bm("used"),item:Ce.be("item"),btn:Ce.be("btn"),map:Ce.be("content"),mapRow:Ce.be("content-row")};class Me{tableModule;quill;options;menu=null;updateUsedColor;tooltipItem=[];bem=l("menu");colorItemClass=`color-${kt()}`;colorChooseTooltipOption={direction:"top"};constructor(t,e,s){this.tableModule=t,this.quill=e,this.options=this.resolveOptions(s);try{const t=localStorage.getItem(this.options.localstorageKey)||"[]";let e=JSON.parse(t);a(e)||(e=[]),e.slice(-10).map((t=>xe.add(t)))}catch{}this.updateUsedColor=zt((t=>{if(!t)return;if(xe.add(t),xe.size>10){const t=Array.from(xe).slice(-10);xe.clear(),t.map((t=>xe.add(t)))}localStorage.setItem(this.options.localstorageKey,JSON.stringify(Array.from(xe)));const e=Array.from(document.querySelectorAll(`.${this.colorItemClass}.${ye.used}`));for(const s of e){const e=document.createElement("div");e.classList.add(ye.item),e.style.backgroundColor=String(t);Array.from(s.querySelectorAll(`.${ye.item}[style*="background-color: ${e.style.backgroundColor}"]`)).length<=0&&s.appendChild(e);const i=Array.from(s.querySelectorAll(`.${ye.item}`)).slice(0,-10);for(const t of i)t.remove()}}),1e3)}resolveOptions(t){return Object.assign({tipText:!0,tipTexts:{},tools:ve,localstorageKey:"__table-bg-used-color",defaultColorMap:n},t)}getUsedColors(){return xe}buildTools(){const t=document.createElement("div");t.classList.add(this.bem.b()),Object.assign(t.style,{display:"flex"});for(const e of this.options.tools){const{name:s,icon:i,handle:o,isColorChoose:n,key:l,tip:a=""}=e,c=document.createElement("span");if(c.classList.add(this.bem.be("item")),"break"===s)c.classList.add(this.bem.is("break"));else{const t=document.createElement("i");if(t.classList.add("icon"),r(i)?t.appendChild(i(this.tableModule)):t.innerHTML=i,c.appendChild(t),n&&l){const t=this.createColorChoose(c,{name:s,icon:i,handle:o,isColorChoose:n,key:l,tip:a});this.tooltipItem.push(t),c.classList.add(we)}else r(o)&&c.addEventListener("click",(t=>{this.quill.focus(),o(this.tableModule,this.getSelectedTds(),t)}),!1);const e=this.options.tipTexts[s]||a;this.options.tipText&&e&&a&&this.createTipText(c,e)}t.appendChild(c)}return t}createColorChoose(t,{handle:e,key:s}){const i=document.createElement("div");if(i.classList.add(ye.selectWrapper),this.options.defaultColorMap.length>0){const t=document.createElement("div");t.classList.add(ye.map);for(const e of this.options.defaultColorMap){const s=document.createElement("div");s.classList.add(ye.mapRow);for(const t of e){const e=document.createElement("div");e.classList.add(ye.item),e.style.backgroundColor=t,s.appendChild(e)}t.appendChild(s)}i.appendChild(t)}const o=document.createElement("div");o.classList.add(ye.mapRow),Object.assign(o.style,{marginTop:"4px"});const n=document.createElement("div");n.classList.add(ye.btn,"transparent"),n.textContent=this.tableModule.options.texts.transparent,n.addEventListener("click",(()=>{e(this.tableModule,this.getSelectedTds(),"transparent")}));const l=document.createElement("div");l.classList.add(ye.btn,"clear"),l.textContent=this.tableModule.options.texts.clear,l.addEventListener("click",(()=>{e(this.tableModule,this.getSelectedTds(),null)}));const r=document.createElement("div");r.classList.add(ye.btn,"custom"),r.textContent=this.tableModule.options.texts.custom;const a=g({onChange:t=>{e(this.tableModule,this.getSelectedTds(),t),this.updateUsedColor(t)}}),{hide:c,destroy:d}=Rt(r,{direction:"right",type:"click",content:a,container:r});if(o.appendChild(n),o.appendChild(l),o.appendChild(r),i.appendChild(o),xe.size>0){const t=document.createElement("div");t.classList.add(ye.used,this.colorItemClass);for(const e of xe){const s=document.createElement("div");s.classList.add(ye.item),s.style.backgroundColor=e,t.appendChild(s)}i.appendChild(t)}return i.addEventListener("click",(t=>{t.stopPropagation(),c();const e=t.target,i=e.style.backgroundColor,o=this.getSelectedTds();if(e&&i&&o.length>0){if(this.tableModule.setCellAttrs(o,s,i,!0),!e.closest(`.${ye.item}`))return;this.updateUsedColor(i)}})),Rt(t,{content:i,onClose(t){const e=i.contains(a);return t&&e&&c(),e},onDestroy(){d()},...this.colorChooseTooltipOption})}getSelectedTds(){return this.tableModule.tableSelection?.selectedTds||[]}createTipText(t,e){const s=Rt(t,{msg:e});s&&this.tooltipItem.push(s)}update(){this.menu&&this.tableModule.tableSelection&&this.tableModule.tableSelection.boundary&&Object.assign(this.menu.style,{display:"flex"})}hide(){this.menu&&Object.assign(this.menu.style,{display:"none"});for(const t of this.tooltipItem)t.hide(!0)}destroy(){for(const t of this.tooltipItem)t.destroy();this.menu&&(this.menu.remove(),this.menu=null)}}const Ie=t=>!t.full&&"right"===t.align;class Le{tableModule;quill;colIndex=-1;tableMain;dragging=!1;dragColBreak=null;handleColMouseUpFunc=this.handleColMouseUp.bind(this);handleColMouseMoveFunc=this.handleColMouseMove.bind(this);handleColMouseDownFunc=this.handleColMouseDown.bind(this);rowIndex=-1;dragRowBreak=null;handleRowMouseUpFunc=this.handleRowMouseUp.bind(this);handleRowMouseMoveFunc=this.handleRowMouseMove.bind(this);handleRowMouseDownFunc=this.handleRowMouseDown.bind(this);dragBEM=l("drag-line");constructor(t,e){this.tableModule=t,this.quill=e}findCurrentColIndex(t){return-1}colWidthChange(t,e,s){}async createConfirmDialog({message:t,confirm:e,cancel:s}){return new Promise((i=>{const o=document.createElement("div");Object.assign(o.style,{padding:"8px 12px",fontSize:"14px",lineHeight:"1.5"});const n=document.createElement("p");n.textContent=t;const l=document.createElement("div");Object.assign(l.style,{display:"flex",justifyContent:"flex-end",gap:"6px"});const r=d({content:s}),a=d({type:"confirm",content:e});l.appendChild(r),l.appendChild(a),o.appendChild(n),o.appendChild(l);const{close:c}=v({child:o});r.addEventListener("click",(()=>{i(!1),c()})),a.addEventListener("click",(()=>{i(!0),c()}))}))}async handleColMouseUp(){if(!this.dragColBreak||!this.tableMain||-1===this.colIndex)return;const t=this.tableMain.getCols(),e=Number.parseInt(this.dragColBreak.dataset.w||"0");let s=this.tableMain.full,n=!1;const l=[];if(s){let s=e/this.tableMain.domNode.getBoundingClientRect().width*100;const o=t[this.colIndex].width;if(s<o){if(s=Math.max(i.colMinWidthPre,s),t[this.colIndex+1]||t[this.colIndex-1]){const e=t[this.colIndex+1]?this.colIndex+1:this.colIndex-1;l.push({index:e,width:t[e].width+o-s})}else s=100;n=!0,l.push({index:this.colIndex,width:s})}else if(t[this.colIndex+1]){const e=o+t[this.colIndex+1].width;s=Math.min(e-i.colMinWidthPre,s),n=!0,l.push({index:this.colIndex,width:s},{index:this.colIndex+1,width:e-s})}}else this.tableMain.domNode.style.width=`${Number.parseFloat(this.tableMain.domNode.style.width)-t[this.colIndex].domNode.getBoundingClientRect().width+e}px`,n=!0,l.push({index:this.colIndex,width:e});if(document.body.removeChild(this.dragColBreak),this.dragColBreak=null,document.removeEventListener("mouseup",this.handleColMouseUpFunc),document.removeEventListener("mousemove",this.handleColMouseMoveFunc),this.dragging=!1,n){const e=this.tableMain.domNode.getBoundingClientRect().width;if(s){let i=0;const o=new Set(l.map((({index:t,width:e})=>(i+=e,t))));for(const[e,s]of t.entries())o.has(e)||(i+=s.width);if(i>100){if(!await this.createConfirmDialog({message:this.tableModule.options.texts.perWidthInsufficient,confirm:this.tableModule.options.texts.confirmText,cancel:this.tableModule.options.texts.cancelText}))return;this.tableMain.cancelFull(),s=!1;for(const[t,s]of l.entries()){const{width:i,index:o}=s;l[t]={index:o,width:i/100*e}}}}for(const{index:i,width:o}of l)t[i].width=`${o}${s?"%":"px"}`,this.colWidthChange(i,s?o/100*e:o,s)}this.quill.emitter.emit(o.AFTER_TABLE_RESIZE)}handleColMouseMove(t){if(t.preventDefault(),!this.dragColBreak||!this.tableMain||-1===this.colIndex)return;const e=this.tableMain.getCols(),s=e[this.colIndex].domNode.getBoundingClientRect(),o=this.tableMain.domNode.getBoundingClientRect();let n=t.clientX;if(this.tableMain.full){const t=i.colMinWidthPre/100*o.width;let l=o.right;n>s.right&&e[this.colIndex+1]&&(l=Math.max(e[this.colIndex+1].domNode.getBoundingClientRect().right-t,s.left+t));const r=s.x+t;n=Math.min(Math.max(n,r),l)}else Ie(this.tableMain)?s.right-n<i.colMinWidthPx&&(n=s.right-i.colMinWidthPx):n-s.x<i.colMinWidthPx&&(n=s.x+i.colMinWidthPx);let l=n-s.x;return Ie(this.tableMain)&&(l=s.right-n),this.dragColBreak.style.left=`${n}px`,this.dragColBreak.dataset.w=String(l),{left:n,width:l}}handleColMouseDown(t){if(0!==t.button)return;if(t.preventDefault(),!this.tableMain)return;const e=this.tableMain.getCols(),s=this.tableMain.domNode.getBoundingClientRect(),i=s.width;if(this.colIndex=this.findCurrentColIndex(t),-1===this.colIndex)return;const o=e[this.colIndex].width,n=this.tableMain.full?o/100*i:o;document.addEventListener("mouseup",this.handleColMouseUpFunc),document.addEventListener("mousemove",this.handleColMouseMoveFunc),this.dragging=!0;const l=document.createElement("div");l.classList.add(this.dragBEM.b()),l.classList.add(this.dragBEM.is("col")),l.dataset.w=String(n);const r={top:s.y,left:t.clientX,height:s.height};Object.assign(l.style,{top:`${r.top}px`,left:`${r.left}px`,height:`${r.height}px`});const a=document.body;return a.appendChild(l),this.dragColBreak&&a.removeChild(this.dragColBreak),this.dragColBreak=l,r}findCurrentRowIndex(t){return-1}rowHeightChange(t,e){}handleRowMouseUp(){if(!this.tableMain||!this.dragRowBreak||-1===this.rowIndex)return;const t=Number.parseInt(this.dragRowBreak.dataset.h||"0");this.tableMain.getRows()[this.rowIndex].setHeight(`${t}px`),this.rowHeightChange(this.rowIndex,t),document.body.removeChild(this.dragRowBreak),this.dragRowBreak=null,document.removeEventListener("mouseup",this.handleRowMouseUpFunc),document.removeEventListener("mousemove",this.handleRowMouseMoveFunc),this.dragging=!1,this.quill.emitter.emit(o.AFTER_TABLE_RESIZE)}handleRowMouseMove(t){if(!this.tableMain||!this.dragRowBreak||-1===this.rowIndex)return;t.preventDefault();const e=this.tableMain.getRows()[this.rowIndex].domNode.getBoundingClientRect();let s=t.clientY;return s-e.y<i.rowMinHeightPx&&(s=e.y+i.rowMinHeightPx),this.dragRowBreak.style.top=`${s}px`,this.dragRowBreak.dataset.h=String(s-e.y),{top:s,height:s-e.y}}handleRowMouseDown(t){if(0!==t.button)return;if(t.preventDefault(),!this.tableMain)return;if(this.rowIndex=this.findCurrentRowIndex(t),-1===this.rowIndex)return;this.dragging=!0,document.addEventListener("mouseup",this.handleRowMouseUpFunc),document.addEventListener("mousemove",this.handleRowMouseMoveFunc);const e=this.tableMain.getRows()[this.rowIndex].domNode.getBoundingClientRect().height,s=this.tableMain?.domNode.getBoundingClientRect(),i=document.createElement("div");i.classList.add(this.dragBEM.b()),i.classList.add(this.dragBEM.is("row")),i.dataset.h=String(e);const o={top:t.clientY,left:s.x,width:s.width};Object.assign(i.style,{top:`${o.top}px`,left:`${o.left}px`,width:`${o.width}px`});const n=document.body;return n.appendChild(i),this.dragRowBreak&&n.removeChild(this.dragRowBreak),this.dragRowBreak=i,o}update(){}destroy(){}}class Ne{quill;isVertical;table;scrollbarContainer;minSize=20;gap=4;move=0;cursorDown=!1;cursorLeave=!1;ratioY=1;ratioX=1;sizeWidth="";sizeHeight="";size="";thumbState={X:0,Y:0};ob;container;scrollbar;thumb=document.createElement("div");scrollHandler=[];propertyMap;bem=l("scrollbar");constructor(t,e,s,i){this.quill=t,this.isVertical=e,this.table=s,this.scrollbarContainer=i,this.container=s.parentElement,this.propertyMap=this.isVertical?{size:"height",offset:"offsetHeight",scrollDirection:"scrollTop",scrollSize:"scrollHeight",axis:"Y",direction:"top",client:"clientY"}:{size:"width",offset:"offsetWidth",scrollDirection:"scrollLeft",scrollSize:"scrollWidth",axis:"X",direction:"left",client:"clientX"},this.calculateSize(),this.ob=new ResizeObserver((()=>{this.update()})),this.ob.observe(s),this.scrollbar=this.createScrollbar(),this.setScrollbarPosition(),Ht.call(this,this.quill.root,(()=>this.setScrollbarPosition())),this.showScrollbar()}update(){this.calculateSize(),this.setScrollbarPosition()}setScrollbarPosition(){const{scrollLeft:t,scrollTop:s}=this.quill.root,{offsetLeft:i,offsetTop:o}=this.container,{width:n,height:l}=this.container.getBoundingClientRect(),{width:r,height:a}=this.table.getBoundingClientRect();let c=i,d=o;this.isVertical?c+=Math.min(n,r):d+=Math.min(l,a);const h=e.find(this.table);h&&"left"!==h.align&&(c+=this.table.offsetLeft-i),Object.assign(this.scrollbar.style,{[this.propertyMap.size]:`${this.isVertical?l:n}px`,transform:`translate(${c-t}px, ${d-s}px)`}),this.containerScrollHandler(this.container)}calculateSize(){const t=this.container.offsetHeight-this.gap,e=this.container.offsetWidth-this.gap,s=t**2/this.container.scrollHeight,i=e**2/this.container.scrollWidth,o=Math.max(s,this.minSize),n=Math.max(i,this.minSize);this.ratioY=s/(t-s)/(o/(t-o)),this.ratioX=i/(e-i)/(n/(e-n)),this.sizeWidth=n+this.gap<e?`${n}px`:"",this.sizeHeight=o+this.gap<t?`${o}px`:"",this.size=this.isVertical?this.sizeHeight:this.sizeWidth}createScrollbar(){const t=document.createElement("div");t.classList.add(this.bem.b()),t.classList.add(this.isVertical?this.bem.is("vertical"):this.bem.is("horizontal"),this.bem.is("transparent")),Object.assign(t.style,{display:"none"}),this.thumb.classList.add(this.bem.be("thumb"));const e=t=>{if(!1===this.cursorDown)return;const e=this.thumbState[this.propertyMap.axis];if(!e)return;const s=this.scrollbar[this.propertyMap.offset]**2/this.container[this.propertyMap.scrollSize]/(this.isVertical?this.ratioY:this.ratioX)/this.thumb[this.propertyMap.offset],i=100*(-1*(this.scrollbar.getBoundingClientRect()[this.propertyMap.direction]-t[this.propertyMap.client])-(this.thumb[this.propertyMap.offset]-e))*s/this.scrollbar[this.propertyMap.offset];this.container[this.propertyMap.scrollDirection]=i*this.container[this.propertyMap.scrollSize]/100},s=()=>{this.thumbState[this.propertyMap.axis]=0,this.cursorDown=!1,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",s),this.cursorLeave&&(this.scrollbar.style.display="none")},i=t=>{t.stopImmediatePropagation(),this.cursorDown=!0,document.addEventListener("mousemove",e),document.addEventListener("mouseup",s),document.onselectstart=()=>!1};this.thumb.addEventListener("mousedown",(t=>{if(t.stopPropagation(),t.ctrlKey||[1,2].includes(t.button))return;window.getSelection()?.removeAllRanges(),i(t);const e=t.currentTarget;e&&(this.thumbState[this.propertyMap.axis]=e[this.propertyMap.offset]-(t[this.propertyMap.client]-e.getBoundingClientRect()[this.propertyMap.direction]))}));const o=[this.table,t];for(const t of o)t.addEventListener("mouseenter",this.showScrollbar),t.addEventListener("mouseleave",this.hideScrollbar);return Ht.call(this,this.container,(()=>{this.containerScrollHandler(this.container)})),t.appendChild(this.thumb),t}containerScrollHandler(t){const e=t[this.propertyMap.offset]-this.gap;this.move=100*t[this.propertyMap.scrollDirection]/e*(this.isVertical?this.ratioY:this.ratioX),Object.assign(this.thumb.style,{[this.propertyMap.size]:this.size,transform:`translate${this.propertyMap.axis}(${this.move}%)`})}showScrollbar=zt((()=>{this.cursorLeave=!1,this.scrollbar.removeEventListener("transitionend",this.hideScrollbarTransitionend),this.scrollbar.style.display=this.size?"block":"none",requestAnimationFrame((()=>{this.scrollbar.classList.remove(this.bem.is("transparent"))}))}),200);hideScrollbar=zt((()=>{this.cursorLeave=!0,this.scrollbar.removeEventListener("transitionend",this.hideScrollbarTransitionend),this.scrollbar.addEventListener("transitionend",this.hideScrollbarTransitionend,{once:!0}),this.scrollbar.classList.add(this.bem.is("transparent"))}),200);hideScrollbarTransitionend=()=>{this.scrollbar.style.display=this.cursorDown&&this.size?"block":"none"};destroy(){this.ob.disconnect(),Dt.call(this),this.table.removeEventListener("mouseenter",this.showScrollbar),this.table.removeEventListener("mouseleave",this.hideScrollbar)}}const Ee=e.import("delta"),Se=e.import("blots/break"),Te=e.import("ui/icons"),Re=(t,{tableId:e,rowId:i,colId:o})=>{const n={tableId:e,rowId:i,colId:o,colspan:1,rowspan:1},l=t.create(s.tableCell,n),r=t.create(s.tableCellInner,n),a=t.create("block");return a.appendChild(t.create("break")),r.appendChild(a),l.appendChild(r),l},Be=t=>{let e=Number.parseFloat(t.getAttribute("width")||i.colDefaultWidth);if(Number.isNaN(e)){const s=t.style.width;e=s?Number.parseFloat(s):t.offsetWidth}return e},ke=new Set([s.tableCellInner]),ze=t=>{return!(!t||!t.parent)&&(e=t.parent,!!ke.has(e.statics.blotName)||ze(t.parent));var e};class Oe{static moduleName="table-up";static toolName=s.tableWrapper;static keyboradHandler={"forbid remove table by backspace":{bindInHead:!0,key:"Backspace",collapsed:!0,offset:0,handler(t,e){const i=this.quill.getLine(t.index)[0];if(i.prev instanceof ge)return i.prev.remove(),!1;if(e.format[s.tableCellInner]){if(0===i.offset(Ot(i,s.tableCellInner)))return!1}return!0}},"forbid remove table by delete":{bindInHead:!0,key:"Delete",collapsed:!0,handler(t,e){const i=this.quill.getLine(t.index),o=i[0],n=i[1];if((o.next instanceof ge||o.next instanceof pe)&&n===o.length()-1)return!1;if(e.format[s.tableCellInner]){if(o===Ot(o,s.tableCellInner).children.tail&&n===o.length()-1)return!1}return!0}},"after table insert new line":{bindInHead:!0,key:"Enter",collapsed:!0,format:[s.tableCellInner],prefix:/^$/,suffix:/^\s*$/,handler(t){const[i,o]=this.quill.getLine(t.index);if(this.quill.getFormat(t.index+o+1,1)[s.tableCellInner])return!0;let n=2,l=i;for(;null!==l&&l.length()<=1;)if(l=l.prev,n-=1,n<=0)return this.quill.insertText(t.index+1,"\n"),this.quill.setSelection(t.index+1,e.sources.SILENT),!1;return!0}}};static register(){ge.allowedChildren=[me],me.allowedChildren=[he,fe],me.requiredContainer=ge,fe.allowedChildren=[pe],fe.requiredContainer=me,he.allowedChildren=[de],he.requiredContainer=me,de.allowedChildren=[ue],ue.requiredContainer=he,ue.allowedChildren=[ce,Se],ue.requiredContainer=de,ce.requiredContainer=ue,e.register({"blots/scroll":ne,"blots/block":_t,[`blots/${s.container}`]:Xt,"formats/header":te,"formats/list":se,"formats/blockquote":Zt,"formats/code-block":Qt,[`formats/${s.tableCell}`]:ue,[`formats/${s.tableCellInner}`]:ce,[`formats/${s.tableRow}`]:de,[`formats/${s.tableBody}`]:he,[`formats/${s.tableCol}`]:pe,[`formats/${s.tableColgroup}`]:fe,[`formats/${s.tableMain}`]:me,[`formats/${s.tableWrapper}`]:ge},!0)}quill;options;toolBox;fixTableByLisenter=zt(this.balanceTables,100);selector;table;tableSelection;tableResize;tableScrollbar;tableAlign;tableResizeScale;get statics(){return this.constructor}constructor(t,i){if(this.quill=t,this.options=this.resolveOptions(i||{}),!this.options.scrollbar){const t=l("scrollbar");this.quill.container.classList.add(t.bm("origin"))}const n=l("toolbox");this.toolBox=this.quill.addContainer(n.b());const r=this.quill.getModule("toolbar");if(r&&this.quill.theme.pickers){const[,t]=(r.controls||[]).find((([t])=>t===this.statics.toolName))||[];if(t&&"select"===t.tagName.toLocaleLowerCase()){const e=this.quill.theme.pickers.find((e=>e.select===t));e&&(e.label.innerHTML=this.options.icon,this.buildCustomSelect(this.options.customSelect,e),e.label.addEventListener("mousedown",(()=>{if(!this.selector||!e)return;const t=this.selector.getBoundingClientRect(),{leftLimited:s}=Wt(t);if(s){const t=e.label.getBoundingClientRect();Object.assign(e.options.style,{transform:`translateX(calc(-100% + ${t.width}px))`})}else Object.assign(e.options.style,{transform:void 0})})))}}const a=this.quill.getModule("keyboard");for(const t of Object.values(Oe.keyboradHandler))t.bindInHead?a.bindings[t.key].unshift(t):a.addBinding(t.key,t);this.quill.root.addEventListener("click",(e=>{const s=e.composedPath();if(!s||s.length<=0)return;const i=s.find((t=>t.tagName&&"TABLE"===t.tagName.toUpperCase()&&t.classList.contains("ql-table")));if(i){if(this.table===i)return this.tableSelection&&this.tableSelection.show(),void(this.tableAlign&&this.tableAlign.update());this.table&&this.hideTableTools(),this.showTableTools(i,t)}else this.table&&this.hideTableTools()}),!1),this.quill.on(e.events.EDITOR_CHANGE,((t,i,o)=>{if(t===e.events.SELECTION_CHANGE&&i){const[t]=this.quill.getLine(i.index),[n]=this.quill.getLine(i.index+i.length);let l,r;try{l=Ot(t,s.tableMain)}catch{}try{r=Ot(n,s.tableMain)}catch{}if(t instanceof pe)return o||(o={index:0,length:0}),this.quill.setSelection(i.index+(o.index>i.index?-1:1),i.length+(o.length===i.length?0:o.length>i.length?-1:1),e.sources.USER);if(n instanceof pe)return this.quill.setSelection(i.index+1,i.length+1,e.sources.USER);i.length>0&&(l&&!r?this.quill.setSelection(i.index-1,i.length+1,e.sources.USER):r&&!l&&this.quill.setSelection(i.index,i.length+1,e.sources.USER)),l&&r||this.hideTableTools()}})),this.quill.on(o.AFTER_TABLE_RESIZE,(()=>{this.tableSelection&&this.tableSelection.hide()})),this.pasteTableHandler(),this.listenBalanceCells()}addContainer(t){if(c(t)){const e=document.createElement("div");for(const s of t.split(" "))e.classList.add(s);return this.toolBox.appendChild(e),e}return this.toolBox.appendChild(t),t}resolveOptions(t){return Object.assign({customBtn:!1,texts:this.resolveTexts(t.texts||{}),full:!1,icon:Te.table,selectionOptions:{},alignOptions:{},scrollbarOptions:{},resizeOptions:{},resizeScaleOptions:{}},t)}resolveTexts(t){return Object.assign({customBtnText:"Custom",confirmText:"Confirm",cancelText:"Cancel",rowText:"Row",colText:"Column",notPositiveNumberError:"Please enter a positive integer",custom:"Custom",clear:"Clear",transparent:"Transparent",perWidthInsufficient:"The percentage width is insufficient. To complete the operation, the table needs to be converted to a fixed width. Do you want to continue?"},t)}pasteTableHandler(){let t=kt(),e=kt(),o=[],n=0,l=0;const r=(t,e,i)=>{const o=this.quill.getSelection(!0),n=this.quill.getFormat(o)[s.tableCellInner];if(n)for(const t of e.ops)t.attributes||(t.attributes={}),t.attributes[s.tableCellInner]=n;return e};this.quill.clipboard.addMatcher(Node.TEXT_NODE,r),this.quill.clipboard.addMatcher(Node.ELEMENT_NODE,r),this.quill.clipboard.addMatcher("table",((e,r)=>{if(0===r.ops.length)return r;if(this.quill.getFormat()[s.tableCellInner])return new Ee;const a=[],c=[];for(let t=0;t<r.ops.length;t++){const{attributes:e,insert:i}=r.ops[t],{table:o,[s.tableCell]:n,...l}=e||{};i&&i[s.tableCol]?c.push({insert:i}):a.push({attributes:l,insert:i})}const d=((t,e)=>{const s=new Array(e).fill(i.colDefaultWidth),o=Array.from(t.querySelectorAll("tr"));for(const t of o){const i=Array.from(t.querySelectorAll("td"));for(const[t,o]of i.entries()){if(!(t<e))break;{const e=Be(o);s[t]=e||s[t]}}}return s})(e,o.length).reduce(((e,i,n)=>(c[n]?e.push(c[n]):e.push({insert:{[s.tableCol]:{tableId:t,colId:o[n],width:i,full:!1}}}),e)),[]);return a.unshift(...d),t=kt(),o=[],n=0,l=0,a.unshift({insert:"\n"}),a.push({insert:"\n"}),new Ee(a)})),this.quill.clipboard.addMatcher("colgroup",((t,e)=>{const s=e.ops.slice(-1)[0];return s.attributes||"\n"!==s.insert?e:new Ee(e.ops.slice(0,-1))})),this.quill.clipboard.addMatcher("col",(e=>{o[l]=kt();const i=(new Ee).insert({[s.tableCol]:Object.assign(pe.value(e),{tableId:t,colId:o[l]})});return l+=1,i})),this.quill.clipboard.addMatcher("tr",((t,i)=>{e=kt(),n=0;for(const t of i.ops)if(t.attributes&&t.attributes.background&&t.attributes[s.tableCellInner]){const e=t.attributes[s.tableCellInner];e.style||(e.style=""),t.attributes[s.tableCellInner].style=`background:${t.attributes.background};${e.style}`}return i}));const a=(i,l)=>{const r=i,a=ue.formats(r);if(!o[n])for(let t=n;t>=0;t--)o[t]||(o[t]=kt());const c=o[n];n+=a.colspan;const d=Object.assign(a,{tableId:t,rowId:e,colId:c});"none"===r.style.border&&(d.style=d.style.replaceAll(/border-(top|right|bottom|left)-style:none;?/g,""));const h=[];for(const t of l.ops)"string"==typeof t.insert&&h.push({insert:t.insert,attributes:{[s.tableCellInner]:d}});return new Ee(h)};this.quill.clipboard.addMatcher("td",a),this.quill.clipboard.addMatcher("th",a)}showTableTools(t,e){t&&(this.table=t,this.options.selection&&(this.tableSelection=new this.options.selection(this,t,e,this.options.selectionOptions)),this.options.align&&(this.tableAlign=new this.options.align(this,t,e,this.options.alignOptions)),this.options.scrollbar&&(this.tableScrollbar=new this.options.scrollbar(this,t,e,this.options.scrollbarOptions)),this.options.resize&&(this.tableResize=new this.options.resize(this,t,e,this.options.resizeOptions)),this.options.resizeScale&&(this.tableResizeScale=new this.options.resizeScale(this,t,e,this.options.resizeScaleOptions)))}hideTableTools(){this.tableSelection&&(this.tableSelection.destroy(),this.tableSelection=void 0),this.tableScrollbar&&(this.tableScrollbar.destroy(),this.tableScrollbar=void 0),this.tableAlign&&(this.tableAlign.destroy(),this.tableAlign=void 0),this.tableResize&&(this.tableResize.destroy(),this.tableResize=void 0),this.tableResizeScale&&this.tableResizeScale.destroy(),this.table=void 0}async buildCustomSelect(t,e){if(!t||!r(t))return;const s=document.createElement("div");s.classList.add("ql-custom-select"),this.selector=await t(this,e),s.appendChild(this.selector),e.options.appendChild(s)}setCellAttrs(t,e,s,i=!1){if(0!==t.length)for(const o of t)o.setFormatValue(e,s,i)}insertTable(t,o){if(t>=30||o>=30)throw new Error("Both rows and columns must be less than 30.");this.quill.focus();const n=this.quill.getSelection();if(null==n)return;const[l]=this.quill.getLeaf(n.index);if(!l)return;if(ze(l))throw new Error(`Not supported ${l.statics.blotName} insert into table.`);const r=getComputedStyle(this.quill.root),a=Number.parseInt(r.paddingLeft),c=Number.parseInt(r.paddingRight),d=Number.parseInt(r.width)-a-c,h=kt(),u=new Array(o).fill(0).map((()=>kt())),b=this.options.full?`${Math.max(1/o*100,i.colMinWidthPre)}%`:`${Math.max(Math.floor(d/o),i.colMinWidthPx)}px`,p=[{retain:n.index},{insert:"\n"}];for(let t=0;t<o;t++)p.push({insert:{[s.tableCol]:{width:b,tableId:h,colId:u[t],full:this.options.full}}});for(let e=0;e<t;e++){const t=kt();for(let e=0;e<o;e++)p.push({insert:"\n",attributes:{[s.tableCellInner]:{tableId:h,rowId:t,colId:u[e],rowspan:1,colspan:1}}})}this.quill.updateContents(new Ee(p),e.sources.USER),this.quill.setSelection(n.index+o+o*t+1,e.sources.SILENT),this.quill.focus()}fixUnusuaDeletelTable(t){const e=t.getRows(),s=t.getColIds();if(0===e.length)return t.remove();if(0===s.length)return;const i=new Array(e.length).fill(0).map((()=>new Array(s.length).fill(!1))),o=t.tableId;for(const[t,n]of e.entries()){let l=0,r=0;const a=i[t],c=n.descendants(ue);for(;r<s.length;){if(a[r]){r+=1;continue}const d=c[l];if(d&&d.colId===s[r]){t+d.rowspan-1>=e.length&&(d.getCellInner().rowspan=e.length-t);const{colspan:s,rowspan:o}=d;if(s>1)for(let t=1;t<s;t++)a[r+t]=!0;if(o>1)for(let e=t+1;e<t+o;e++)for(let t=0;t<s;t++)i[e][r+t]=!0;l+=1}else n.insertBefore(Re(this.quill.scroll,{tableId:o,colId:s[r],rowId:n.rowId}),d);r+=1}if(l<c.length)for(let t=l;t<c.length;t++)c[t].remove()}}balanceTables(){for(const t of this.quill.scroll.descendants(me))this.fixUnusuaDeletelTable(t)}listenBalanceCells(){this.quill.on(e.events.SCROLL_OPTIMIZE,(t=>{t.some((t=>!!["TD","TR","TBODY","TABLE"].includes(t.target.tagName)&&(this.fixTableByLisenter(),!0)))}))}deleteTable(){if(!this.tableSelection||0===this.tableSelection.selectedTds.length)return;const t=Ot(this.tableSelection.selectedTds[0],s.tableMain);t&&t.remove(),this.hideTableTools()}appendRow(t){if(!this.tableSelection)return;const e=this.tableSelection.selectedTds;if(e.length<=0)return;const i=e[t?e.length-1:0],[o,n,l]=At(i,[s.tableMain,s.tableBody,s.tableRow]),r=o.getRows().indexOf(l)+(t?i.rowspan:0);n.insertRow(r)}appendCol(t){if(!this.tableSelection)return;const e=this.tableSelection.selectedTds;if(e.length<=0)return;const[i]=e.reduce(((e,s)=>{const i=s.getColumnIndex();return(!t&&i<=e[1]||t&&i>=e[1])&&(e=[s,i]),e}),[e[0],e[0].getColumnIndex()]),o=i.getColumnIndex()+(t?i.colspan:0),n=Ot(i,s.tableMain),l=n.tableId,r=kt(),[a]=n.descendants(fe);a&&a.insertColByIndex(o,{tableId:l,colId:r,width:n.full?"6%":"160px",full:n.full});const c=n.getRows(),d=[];let h=0;for(const t of Object.values(c)){const e=d.shift()||0;if(h>0){h-=1;continue}const s=t.insertCell(o-e,{tableId:l,rowId:t.rowId,colId:r,rowspan:1,colspan:1});s.skipRowNum&&(h+=s.skipRowNum);for(const[t,e]of s.entries())d[t]=(d[t]||0)+e}}fixTableByRemove(t){const e=t.getRows(),s=t.getCols(),i=s.reduce(((t,e)=>(t[e.colId]=0,t)),{}),o=[...e].reverse(),n=[];for(const[t,s]of o.entries()){const o=e.length-t-1;s.children.length<=0?n.push(o):s.foreachCellInner((t=>{const e=n.reduce(((e,s)=>t.rowspan+o>s?e+1:e),0);t.rowspan-=e,i[t.colId]+=1}))}let l=0;for(const t of Object.values(i))if(0===t){const t=[];let s=0;for(const i of Object.values(e)){const e=t.shift()||0;let o=[];s>0?(o=i.getCellByColumIndex(l-e)[2],s-=1):(o=i.removeCell(l-e),o.skipRowNum&&(s+=o.skipRowNum));for(const[e,s]of o.entries())t[e]=(t[e]||0)+s}}else l+=1;for(const t of s)0===i[t.colId]&&(t.prev?t.prev.width+=t.width:t.next&&(t.next.width+=t.width),t.remove())}removeRow(){if(!this.tableSelection)return;const t=this.tableSelection.selectedTds;if(t.length<=0)return;const e=Ot(t[0],s.tableMain),i=e.getRows();let o=i.length,n=-1;for(const e of t){const t=Ot(e,s.tableRow),l=i.indexOf(t);l<o&&(o=l),l+e.rowspan>n&&(n=l+e.rowspan)}const l={};for(let t=o;t<Math.min(i.length,n);t++){i[t].foreachCellInner((e=>{e.rowspan+t>n&&(l[e.colId]={rowspan:e.rowspan+t-n,colspan:e.colspan,colIndex:e.getColumnIndex()}),e.parent.remove()}))}if(i[n]){const t=i[n],s=e.tableId;for(const[e,{colIndex:i,colspan:o,rowspan:n}]of Object.entries(l))t.insertCell(i,{tableId:s,rowId:t.rowId,colId:e,colspan:o,rowspan:n})}this.fixTableByRemove(e)}removeCol(){if(!this.tableSelection)return;const t=this.tableSelection.selectedTds;if(t.length<=0)return;const e=t[0],i=Ot(e,s.tableMain),o={};for(const e of t)o[e.rowId]||(o[e.rowId]=0),o[e.rowId]+=e.colspan;const n=Math.max(...Object.values(o)),l=e.getColumnIndex(),r=i.descendants(de);for(let t=0;t<n;t++){const t=[];let e=0;for(const s of Object.values(r)){const i=t.shift()||0;if(e>0){e-=1;continue}const o=s.removeCell(l-i);o.skipRowNum&&(e+=o.skipRowNum);for(const[e,s]of o.entries())t[e]=(t[e]||0)+s}}const[a]=i.descendants(fe);if(a)for(let t=0;t<n;t++)a.removeColByIndex(l);this.fixTableByRemove(i)}mergeCells(){if(!this.tableSelection)return;const t=this.tableSelection.selectedTds;if(t.length<=1)return;const e=t.reduce(((t,e,s)=>{const i=e.colId;t[0][i]||(t[0][i]=0),t[0][i]+=e.rowspan;const o=e.rowId;return t[1][o]||(t[1][o]=0),t[1][o]+=e.colspan,0!==s&&(e.moveChildren(t[2]),e.parent.remove()),t}),[{},{},t[0]]),i=Math.max(...Object.values(e[0])),o=Math.max(...Object.values(e[1])),n=e[2];n.colspan=o,n.rowspan=i;const l=Ot(n,s.tableMain);this.fixTableByRemove(l)}splitCell(){if(!this.tableSelection)return;const t=this.tableSelection.selectedTds;if(1!==t.length)return;const e=t[0];if(1===e.colspan&&1===e.rowspan)return;const[i,o]=At(e,[s.tableMain,s.tableRow]),n=i.tableId,l=e.getColumnIndex(),r=i.getColIds().slice(l,l+e.colspan).reverse();let a=o,c=e.rowspan;for(e.colspan=1,e.rowspan=1;a&&c>0;){for(const t of r)a===o&&t===e.colId||a.insertCell(l+(a===o?1:0),{tableId:n,rowId:a.rowId,colId:t,rowspan:1,colspan:1});c-=1,a=a.next}}}t.BlockOverride=_t,t.BlockquoteOverride=Zt,t.CodeBlockOverride=Qt,t.ContainerFormat=Xt,t.HeaderOverride=te,t.ListItemOverride=se,t.ScrollOverride=ne,t.Scrollbar=Ne,t.TableAlign=class{tableModule;table;quill;tableBlot;tableWrapperBlot;alignBox;cleanup;bem=l("align");resizeObserver=new ResizeObserver((()=>this.hide()));constructor(t,s,i){this.tableModule=t,this.table=s,this.quill=i,this.tableBlot=e.find(s),this.tableWrapperBlot=this.tableBlot.parent,this.alignBox=this.buildTool()}buildTool(){const t=this.tableModule.addContainer(this.bem.b()),s=e.import("ui/icons"),i={left:s.align[""],center:s.align.center,right:s.align.right};for(const[s,o]of Object.entries(i)){const i=document.createElement("span");i.dataset.align=s,i.classList.add(this.bem.be("item")),i.innerHTML=`<i class="icon">${o}</i>`,i.addEventListener("click",(()=>{const t=i.dataset.align;t&&(this.setTableAlign(this.tableBlot,t),this.quill.once(e.events.SCROLL_OPTIMIZE,(()=>{this.tableModule.tableSelection&&this.tableModule.tableSelection.hide(),this.tableModule.tableResize&&this.tableModule.tableResize.update(),this.tableModule.tableResizeScale&&this.tableModule.tableResizeScale.update(),this.tableModule.tableScrollbar&&this.tableModule.tableScrollbar.update()})))})),t.appendChild(i)}return this.cleanup||(this.cleanup=Mt(this.tableWrapperBlot.domNode,t,(()=>this.update()))),t}setTableAlign(t,e){const s=t.getCols();for(const t of s)t.align=e}show(){this.alignBox&&(this.alignBox.classList.add(this.bem.bm("active")),this.resizeObserver.observe(this.table))}hide(){this.alignBox&&(this.alignBox.classList.remove(this.bem.bm("active")),this.cleanup&&(this.cleanup(),this.cleanup=void 0))}update(){this.alignBox&&(this.tableBlot.full||this.tableBlot.domNode.offsetWidth>=this.quill.root.offsetWidth?this.hide():(this.show(),St(this.tableWrapperBlot.domNode,this.alignBox,{placement:"top",middleware:[Nt(),Lt({limiter:Et()}),It(16)]}).then((({x:t,y:e})=>{Object.assign(this.alignBox.style,{left:`${t}px`,top:`${e}px`})}))))}destroy(){this.hide(),this.resizeObserver.disconnect(),this.alignBox&&(this.alignBox.remove(),this.alignBox=void 0)}},t.TableBodyFormat=he,t.TableCellFormat=ue,t.TableCellInnerFormat=ce,t.TableColFormat=pe,t.TableColgroupFormat=fe,t.TableMainFormat=me,t.TableMenuCommon=Me,t.TableMenuContextmenu=class extends Me{tableModule;quill;colorChooseTooltipOption={direction:"right"};constructor(t,e,s){super(t,e,s),this.tableModule=t,this.quill=e,this.quill.root.addEventListener("contextmenu",this.listenContextmenu)}listenContextmenu=t=>{t.preventDefault();const e=t.composedPath();if(!e||e.length<=0)return;e.find((t=>t.tagName&&"TABLE"===t.tagName.toUpperCase()&&t.classList.contains("ql-table")))&&this.tableModule.tableSelection?.selectedTds?.length?(this.menu||(this.menu=this.buildTools()),this.update({x:t.clientX,y:t.clientY}),document.addEventListener("click",(()=>{this.hide()}),{once:!0})):this.hide()};buildTools(){const t=super.buildTools();t.classList.add(this.bem.is("contextmenu"));const e=t.getElementsByClassName(we);for(const t of Array.from(e))t.addEventListener("click",(t=>t.stopPropagation()));return document.body.appendChild(t),t}createTipText(t,e){const s=document.createElement("span");s.textContent=e,t.appendChild(s)}update(t){if(!this.menu||!this.tableModule.tableSelection||!this.tableModule.tableSelection.boundary)return;super.update();const e={display:"flex",left:0,top:0};if(!t)return this.hide();const{x:s,y:i}=t;e.left=s,e.top=i,Object.assign(this.menu.style,{...e,left:`${e.left+window.scrollX}px`,top:`${e.top+window.scrollY}px`});const o=this.menu.getBoundingClientRect(),{left:n,top:l}=Wt(o);Object.assign(this.menu.style,{left:`${n+window.scrollX}px`,top:`${l+window.scrollY}px`})}destroy(){this.quill.root.removeEventListener("contextmenu",this.listenContextmenu),super.destroy()}},t.TableMenuSelect=class extends Me{tableModule;quill;constructor(t,e,s){super(t,e,s),this.tableModule=t,this.quill=e,this.menu=this.buildTools(),this.tableModule.addContainer(this.menu)}update(){this.menu&&this.tableModule.tableSelection&&this.tableModule.tableSelection.boundary&&(super.update(),St(this.tableModule.tableSelection.cellSelect,this.menu,{placement:"bottom",middleware:[Nt(),Lt({limiter:Et()}),It(8)]}).then((({x:t,y:e})=>{Object.assign(this.menu.style,{left:`${t}px`,top:`${e}px`})})))}},t.TableResizeBox=class extends Le{tableModule;table;root;tableMain;tableWrapper;resizeObserver;tableCols=[];tableRows=[];rowHeadWrapper=null;colHeadWrapper=null;corner=null;scrollHandler=[];lastHeaderSelect=null;size=12;bem=l("resize-box");constructor(t,s,i){super(t,i),this.tableModule=t,this.table=s,this.tableMain=e.find(this.table),this.tableMain&&(this.tableWrapper=this.tableMain.parent,this.tableWrapper&&(this.root=this.tableModule.addContainer(this.bem.b()),this.resizeObserver=new ResizeObserver((()=>{this.show()})),this.resizeObserver.observe(this.table)))}handleResizerHeader(t,e){const{clientX:s,clientY:i}=e,o=this.table.getBoundingClientRect();if(this.tableModule.tableSelection){const n=this.tableModule.tableSelection;e.shiftKey||(this.lastHeaderSelect=null);const l=[{x:t?o.left:s,y:t?i:o.top},{x:t?o.right:s,y:t?i:o.bottom}];this.lastHeaderSelect?(l[0]={x:Math.min(l[0].x,this.lastHeaderSelect[0].x),y:Math.min(l[0].y,this.lastHeaderSelect[0].y)},l[1]={x:Math.max(l[1].x,this.lastHeaderSelect[1].x),y:Math.max(l[1].y,this.lastHeaderSelect[1].y)}):this.lastHeaderSelect=l,n.selectedTds=n.computeSelectedTds(...l),n.show()}}findCurrentColIndex(t){return Array.from(this.root.getElementsByClassName(this.bem.be("col-separator"))).indexOf(t.target)}colWidthChange(t,e,s){Array.from(this.root.getElementsByClassName(this.bem.be("col-header")))[t].style.width=`${e}px`}handleColMouseDownFunc=function(t){const e=this.handleColMouseDown(t);return e&&this.dragColBreak&&Object.assign(this.dragColBreak.style,{top:e.top-this.size+"px",left:`${e.left}px`,height:`${e.height+this.size}px`}),e}.bind(this);bindColEvents(){const t=Array.from(this.root.getElementsByClassName(this.bem.be("col-header"))),e=Array.from(this.root.getElementsByClassName(this.bem.be("col-separator")));Ht.call(this,this.tableWrapper.domNode,(()=>{this.colHeadWrapper.scrollLeft=this.tableWrapper.domNode.scrollLeft}));for(const e of t)e.addEventListener("click",this.handleResizerHeader.bind(this,!1));for(const t of e)t.addEventListener("mousedown",this.handleColMouseDownFunc),t.addEventListener("dragstart",(t=>t.preventDefault()))}findCurrentRowIndex(t){return Array.from(this.root.getElementsByClassName(this.bem.be("row-separator"))).indexOf(t.target)}rowHeightChange(t,e){Array.from(this.root.getElementsByClassName(this.bem.be("row-header")))[t].style.height=`${e}px`}handleRowMouseDownFunc=function(t){const e=this.handleRowMouseDown(t);return e&&this.dragRowBreak&&Object.assign(this.dragRowBreak.style,{top:`${e.top}px`,left:e.left-this.size+"px",width:`${e.width+this.size}px`}),e}.bind(this);bindRowEvents(){const t=Array.from(this.root.getElementsByClassName(this.bem.be("row-header"))),e=Array.from(this.root.getElementsByClassName(this.bem.be("row-separator")));Ht.call(this,this.tableWrapper.domNode,(()=>{this.rowHeadWrapper.scrollTop=this.tableWrapper.domNode.scrollTop}));for(const e of t)e.addEventListener("click",this.handleResizerHeader.bind(this,!0));for(const t of e)t.addEventListener("mousedown",this.handleRowMouseDownFunc),t.addEventListener("dragstart",(t=>t.preventDefault()))}update(){const t=this.tableMain.domNode.getBoundingClientRect(),e=this.tableWrapper.domNode.getBoundingClientRect(),s=Math.max(t.x,e.x),i=Math.max(t.y,e.y),o=this.quill.root.getBoundingClientRect();Object.assign(this.root.style,{top:i-o.y+"px",left:s-o.x+"px"});let n=-1*this.size,l=-1*this.size;Ie(this.tableMain)?(this.root.classList.add(this.bem.is("align-right")),n=Math.min(e.width,t.width),l=Math.min(e.width,t.width)):this.root.classList.remove(this.bem.is("align-right")),this.corner&&Object.assign(this.corner.style,{transform:`translateY(${-1*this.size}px) translateX(${n}px)`}),this.rowHeadWrapper&&Object.assign(this.rowHeadWrapper.style,{transform:`translateX(${l}px)`})}show(){this.tableCols=this.tableMain.getCols(),this.tableRows=this.tableMain.getRows(),this.root.innerHTML="";const t=this.tableWrapper.domNode.getBoundingClientRect(),e=this.tableMain.domNode.getBoundingClientRect();if(this.tableCols.length>0&&this.tableRows.length>0&&(this.corner=document.createElement("div"),this.corner.classList.add(this.bem.be("corner")),Object.assign(this.corner.style,{width:`${this.size}px`,height:`${this.size}px`}),this.corner.addEventListener("click",(()=>{const t=this.table.getBoundingClientRect();if(this.tableModule.tableSelection){const e=this.tableModule.tableSelection;e.selectedTds=e.computeSelectedTds({x:t.x,y:t.y},{x:t.right,y:t.bottom}),e.show()}})),this.root.appendChild(this.corner)),this.tableCols.length>0){let s="";for(const[t,i]of this.tableCols.entries()){const o=i.domNode.getBoundingClientRect().width;s+=`<div class="${this.bem.be("col-header")}" style="width: ${o+(t===this.tableCols.length-1?1:0)}px">\n          <div class="${this.bem.be("col-separator")}" style="height: ${e.height+this.size-3}px"></div>\n        </div>`}const i=document.createElement("div");i.classList.add(this.bem.be("col"));const o=document.createElement("div");o.classList.add(this.bem.be("col-wrapper")),Object.assign(i.style,{transform:`translateY(-${this.size}px)`,maxWidth:`${t.width}px`,height:`${this.size}px`}),Object.assign(o.style,{width:`${e.width}px`}),o.innerHTML=s,i.appendChild(o),this.root.appendChild(i),i.scrollLeft=this.tableWrapper.domNode.scrollLeft,this.colHeadWrapper=i,this.bindColEvents()}if(this.tableRows.length>0){let s="";for(const[t,i]of this.tableRows.entries()){const o=`${i.domNode.getBoundingClientRect().height}px`;s+=`<div class="${this.bem.be("row-header")}" style="height: ${Number.parseFloat(o)+(t===this.tableRows.length-1?1:0)}px">\n          <div class="${this.bem.be("row-separator")}" style="width: ${e.width+this.size-3}px"></div>\n        </div>`}const i=document.createElement("div");i.classList.add(this.bem.be("row"));const o=document.createElement("div");o.classList.add(this.bem.be("row-wrapper")),Object.assign(i.style,{transform:`translateX(-${this.size}px)`,width:`${this.size}px`,maxHeight:`${t.height}px`}),Object.assign(o.style,{height:`${e.height}px`}),o.innerHTML=s,i.appendChild(o),this.root.appendChild(i),i.scrollTop=this.tableWrapper.domNode.scrollTop,this.rowHeadWrapper=i,this.bindRowEvents()}this.update(),Ht.call(this,this.quill.root,(()=>{this.update()}))}hide(){this.root.classList.add(this.bem.is("hidden"))}destroy(){this.hide(),Dt.call(this),this.resizeObserver.disconnect();for(const[t,e]of this.scrollHandler)t.removeEventListener("scroll",e);this.root.remove()}},t.TableResizeCommon=Le,t.TableResizeLine=class extends Le{tableModule;table;colResizer;rowResizer;currentTableCell;dragging=!1;curColIndex=-1;curRowIndex=-1;tableCellBlot;bem=l("resize-line");constructor(t,s,i){super(t,i),this.tableModule=t,this.table=s,this.colResizer=this.tableModule.addContainer(this.bem.be("col")),this.rowResizer=this.tableModule.addContainer(this.bem.be("row")),this.table.addEventListener("mousemove",this.mousemoveHandler),this.quill.on(e.events.TEXT_CHANGE,this.hideWhenTextChange)}mousemoveHandler=t=>{if(this.dragging)return;const i=this.findTableCell(t);if(!i)return this.hide();const o=e.find(i);o&&this.currentTableCell!==i&&(this.show(),this.currentTableCell=i,this.tableCellBlot=o,this.tableMain=Ot(o,s.tableMain),this.tableMain.getCols().length>0&&this.updateColResizer(),this.updateRowResizer())};hideWhenTextChange=()=>{this.hide()};findTableCell(t){for(const e of t.composedPath()){if(e instanceof HTMLElement&&"TD"===e.tagName)return e;if(e===document.body)return null}return null}findCurrentColIndex(){return this.curColIndex}handleColMouseUpFunc=async function(){await this.handleColMouseUp(),this.updateColResizer()}.bind(this);updateColResizer(){if(!this.tableMain||!this.tableCellBlot)return;const t=this.tableCellBlot;this.tableModule.toolBox.removeChild(this.colResizer),this.colResizer=this.tableModule.addContainer(this.bem.be("col"));const[e]=At(t,[s.tableBody]),i=e.domNode.getBoundingClientRect(),o=t.domNode.getBoundingClientRect(),n=this.quill.root.getBoundingClientRect();let l=o.right-n.x;Ie(this.tableMain)&&(l=o.left-n.x),Object.assign(this.colResizer.style,{top:i.y-n.y+"px",left:`${l}px`,height:`${i.height}px`});const r=this.tableMain.getCols();this.curColIndex=r.findIndex((e=>e.colId===t.colId)),this.colResizer.addEventListener("mousedown",this.handleColMouseDownFunc),this.colResizer.addEventListener("dragstart",(t=>{t.preventDefault()}))}findCurrentRowIndex(){return this.curRowIndex}handleRowMouseUpFunc=function(){this.handleRowMouseUp(),this.updateRowResizer()}.bind(this);updateRowResizer(){if(!this.tableMain||!this.tableCellBlot)return;const t=this.tableCellBlot;this.tableModule.toolBox.removeChild(this.rowResizer),this.rowResizer=this.tableModule.addContainer(this.bem.be("row"));const e=t.parent;if(!(e instanceof de))return;const[i]=At(t,[s.tableBody]),o=i.domNode.getBoundingClientRect(),n=t.domNode.getBoundingClientRect(),l=this.quill.root.getBoundingClientRect();Object.assign(this.rowResizer.style,{top:n.bottom-l.y+"px",left:o.x-l.x+"px",width:`${o.width}px`});const r=this.tableMain.getRows();this.curRowIndex=r.indexOf(e),this.rowResizer.addEventListener("mousedown",this.handleRowMouseDownFunc),this.rowResizer.addEventListener("dragstart",(t=>{t.preventDefault()}))}show(){Object.assign(this.colResizer.style,{display:null}),Object.assign(this.rowResizer.style,{display:null})}hide(){this.currentTableCell=void 0,this.rowResizer.style.display="none",this.colResizer.style.display="none"}update(){this.updateColResizer(),this.updateRowResizer()}destroy(){this.colResizer.remove(),this.rowResizer.remove(),this.table.removeEventListener("mousemove",this.mousemoveHandler),this.quill.off(e.events.TEXT_CHANGE,this.hideWhenTextChange)}},t.TableResizeScale=class{tableModule;table;quill;scrollHandler=[];tableMainBlot=null;tableWrapperBlot=null;bem=l("scale");startX=0;startY=0;options;root;block;resizeobserver=new ResizeObserver((()=>this.update()));constructor(t,s,i,o){this.tableModule=t,this.table=s,this.quill=i,this.options=this.resolveOptions(o),this.tableMainBlot=e.find(s),this.tableMainBlot&&!this.tableMainBlot.full&&(this.tableWrapperBlot=this.tableMainBlot.parent,this.buildResizer(),this.show())}resolveOptions(t){return Object.assign({blockSize:12},t)}buildResizer(){if(!this.tableMainBlot||!this.tableWrapperBlot)return;this.root=this.tableModule.addContainer(this.bem.b()),this.root.classList.add(this.bem.is("hidden")),this.block=document.createElement("div"),this.block.classList.add(this.bem.be("block")),Object.assign(this.block.style,{width:`${this.options.blockSize}px`,height:`${this.options.blockSize}px`}),this.root.appendChild(this.block);let t=[],e=[];const s=s=>{if(!this.tableMainBlot)return;const o=Ie(this.tableMainBlot)?-1:1,n=(s.clientX-this.startX)*o,l=s.clientY-this.startY,r=Math.floor(n/t.length),a=Math.floor(l/e.length);for(const{blot:e,width:s}of t)e.width=Math.max(s+r,i.colMinWidthPx);for(const{blot:t,height:s}of e)t.setHeight(`${Math.max(s+a,i.rowMinHeightPx)}px`)},o=()=>{t=[],e=[],document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",o)};this.block.addEventListener("mousedown",(i=>{this.tableMainBlot&&!this.isTableOutofEditor()&&(this.startX=i.clientX,this.startY=i.clientY,t=this.tableMainBlot.getCols().map((t=>({blot:t,width:t.width}))),e=this.tableMainBlot.getRows().map((t=>({blot:t,height:t.domNode.getBoundingClientRect().height}))),document.addEventListener("mousemove",s),document.addEventListener("mouseup",o))})),this.block.addEventListener("dragstart",(t=>t.preventDefault())),this.resizeobserver.observe(this.tableMainBlot.domNode),Ht.call(this,this.quill.root,(()=>this.update())),Ht.call(this,this.tableWrapperBlot.domNode,(()=>this.update()))}isTableOutofEditor(){if(!this.tableMainBlot||!this.tableWrapperBlot||this.tableMainBlot.full)return!1;const t=this.tableMainBlot.domNode.getBoundingClientRect(),e=this.tableWrapperBlot.domNode.getBoundingClientRect();if(t.width>e.width){for(const s of this.tableMainBlot.getCols())s.width=Math.floor(s.width/t.width*e.width);return this.tableMainBlot.colWidthFillTable(),!0}return!1}update(){if(!(this.block&&this.root&&this.tableMainBlot&&this.tableWrapperBlot))return!1;const t=this.tableMainBlot.domNode.getBoundingClientRect(),e=this.tableWrapperBlot.domNode.getBoundingClientRect(),s=this.quill.root.getBoundingClientRect(),{scrollTop:i,scrollLeft:o}=this.tableWrapperBlot.domNode,n=2*this.options.blockSize,l=Math.min(t.width,e.width)+n,r=Math.min(t.height,e.height)+n;Object.assign(this.root.style,{width:`${l}px`,height:`${r}px`,left:t.x-s.x-this.options.blockSize+"px",top:t.y-s.y-this.options.blockSize+"px"});const a={left:t.width+n-o+"px",top:r-i+"px"};Ie(this.tableMainBlot)?(this.root.classList.add(this.bem.is("align-right")),a.left=`${this.options.blockSize+-1*o}px`):this.root.classList.remove(this.bem.is("align-right")),Object.assign(this.block.style,a)}show(){this.root&&(this.root.classList.remove(this.bem.is("hidden")),this.update())}hide(){this.root&&this.root.classList.add(this.bem.is("hidden"))}destroy(){this.hide(),this.root&&this.root.remove(),Dt.call(this)}},t.TableRowFormat=de,t.TableSelection=class{table;quill;options;boundary=null;startScrollX=0;startScrollY=0;selectedTableScrollX=0;selectedTableScrollY=0;selectedEditorScrollX=0;selectedEditorScrollY=0;selectedTds=[];cellSelectWrap;cellSelect;dragging=!1;scrollHandler=[];selectingHandler=this.mouseDownHandler.bind(this);tableMenu;resizeObserver;bem=l("selection");constructor(t,e,s,i={}){this.table=e,this.quill=s,this.options=this.resolveOptions(i),this.cellSelectWrap=t.addContainer(this.bem.b()),this.cellSelect=this.helpLinesInitial(),this.resizeObserver=new ResizeObserver((()=>this.hide())),this.resizeObserver.observe(this.table),this.resizeObserver.observe(this.quill.root),this.quill.root.addEventListener("mousedown",this.selectingHandler,!1),this.options.tableMenu&&(this.tableMenu=new this.options.tableMenu(t,s,this.options.tableMenuOptions))}resolveOptions(t){return Object.assign({selectColor:"#0589f3",tableMenuOptions:{}},t)}helpLinesInitial(){const t=document.createElement("div");return t.classList.add(this.bem.be("line")),Object.assign(t.style,{"border-color":this.options.selectColor}),this.cellSelectWrap.appendChild(t),t}computeSelectedTds(t,s){const i=e.find(this.table);if(!i)return[];const o=new Set(i.descendants(ue).map(((t,e)=>(t.index=e,t)))),{x:n,y:l}=this.getTableViewScroll(),{x:r,y:a}=this.getQuillViewScroll();this.selectedTableScrollX=n,this.selectedTableScrollY=l,this.selectedEditorScrollX=r,this.selectedEditorScrollY=a;const c=this.table.getBoundingClientRect(),d=t.x-n+this.startScrollX,h=t.y-l+this.startScrollY;let u={x:Math.max(c.left,Math.min(s.x,d)),y:Math.max(c.top,Math.min(s.y,h)),x1:Math.min(c.right,Math.max(s.x,d)),y1:Math.min(c.bottom,Math.max(s.y,h))};const b=new Set;let p=!0;for(;p;){p=!1;for(const t of o){t.__rect||(t.__rect=t.domNode.getBoundingClientRect());const{x:e,y:s,right:i,bottom:n}=t.__rect;if(Bt(u,{x:e,y:s,x1:i,y1:n},2)){b.add(t),o.delete(t),u={x:Math.min(u.x,e),y:Math.min(u.y,s),x1:Math.max(u.x1,i),y1:Math.max(u.y1,n)},p=!0;break}if(e>u.x1&&s>u.y1)break}}for(const t of[...b,...o])delete t.__rect;return this.boundary=function(t,e){const s=e.getBoundingClientRect();return{x:t.x-s.x-e.scrollLeft,y:t.y-s.y-e.scrollTop,x1:t.x-s.x-e.scrollLeft+t.width,y1:t.y-s.y-e.scrollTop+t.height,width:t.width,height:t.height}}({...u,width:u.x1-u.x,height:u.y1-u.y},this.quill.root),Array.from(b).sort(((t,e)=>t.index-e.index)).map((t=>(delete t.index,t.getCellInner())))}mouseDownHandler(t){const{button:e,target:s,clientX:i,clientY:o}=t,n=s.closest(".ql-table");if(0!==e||!n)return;const l=n.dataset.tableId,r={x:i,y:o},{x:a,y:c}=this.getTableViewScroll();this.startScrollX=a,this.startScrollY=c,this.selectedTds=this.computeSelectedTds(r,r),this.show(),this.tableMenu&&this.tableMenu.hide();const d=t=>{const{button:e,target:s,clientX:i,clientY:o}=t,n=s.closest(".ql-table");if(0!==e||!n||n.dataset.tableId!==l)return;this.dragging=!0;const a={x:i,y:o};this.selectedTds=this.computeSelectedTds(r,a),this.selectedTds.length>1&&this.quill.blur(),this.update()},h=()=>{document.body.removeEventListener("mousemove",d,!1),document.body.removeEventListener("mouseup",h,!1),this.dragging=!1,this.startScrollX=0,this.startScrollY=0,this.tableMenu&&this.tableMenu.update()};document.body.addEventListener("mousemove",d,!1),document.body.addEventListener("mouseup",h,!1)}update(){if(0===this.selectedTds.length||!this.boundary)return;const{x:t,y:e}=this.getQuillViewScroll(),{x:s,y:i}=this.getTableViewScroll(),o=this.table.parentElement.getBoundingClientRect(),n=this.quill.root.getBoundingClientRect(),l=o.x-n.x,r=o.y-n.y;Object.assign(this.cellSelect.style,{left:2*this.selectedEditorScrollX-t+this.boundary.x+this.selectedTableScrollX-s-l+"px",top:2*this.selectedEditorScrollY-e+this.boundary.y+this.selectedTableScrollY-i-r+"px",width:`${this.boundary.width}px`,height:`${this.boundary.height}px`}),Object.assign(this.cellSelectWrap.style,{left:`${l}px`,top:`${r}px`,width:`${o.width+2}px`,height:`${o.height+2}px`}),!this.dragging&&this.tableMenu&&this.tableMenu.update()}getQuillViewScroll(){return{x:this.quill.root.scrollLeft,y:this.quill.root.scrollTop}}getTableViewScroll(){return{x:this.table.parentElement.scrollLeft,y:this.table.parentElement.scrollTop}}show(){Dt.call(this),Object.assign(this.cellSelectWrap.style,{display:"block"}),this.update(),Ht.call(this,this.quill.root,(()=>{this.update()})),Ht.call(this,this.table.parentElement,(()=>{this.update()}))}hide(){this.boundary=null,this.selectedTds=[],this.cellSelectWrap&&Object.assign(this.cellSelectWrap.style,{display:"none"}),this.tableMenu&&this.tableMenu.hide(),Dt.call(this)}destroy(){return this.resizeObserver.disconnect(),this.hide(),this.cellSelectWrap.remove(),this.tableMenu&&this.tableMenu.destroy(),Dt.call(this),this.quill.root.removeEventListener("mousedown",this.selectingHandler,!1),null}},t.TableUp=Oe,t.TableVirtualScrollbar=class{tableModule;table;quill;scrollbarContainer;scrollbar;bem=l("scrollbar");constructor(t,e,s){this.tableModule=t,this.table=e,this.quill=s,this.scrollbarContainer=this.tableModule.addContainer(this.bem.be("container")),this.scrollbar=[new Ne(s,!0,e,this.scrollbarContainer),new Ne(s,!1,e,this.scrollbarContainer)];for(const t of this.scrollbar)this.scrollbarContainer.appendChild(t.scrollbar)}hide(){for(const t of this.scrollbar)t.hideScrollbar()}show(){for(const t of this.scrollbar)t.showScrollbar()}update(){for(const t of this.scrollbar)t.calculateSize(),t.setScrollbarPosition()}destroy(){this.scrollbarContainer.remove();for(const t of this.scrollbar)t.destroy();return null}},t.TableWrapperFormat=ge,t.blotName=s,t.default=Oe,t.defaultCustomSelect=function(t,e){return C({onSelect:(s,i)=>{t.insertTable(s,i),e&&e.close()},customBtn:t.options.customBtn,texts:t.options.texts})},t.findParentBlot=Ot,t.findParentBlots=At,t.isTableAlignRight=Ie,t.randomId=kt,t.tableCantInsert=ke,t.tableUpEvent=o,t.tableUpSize=i,t.updateTableConstants=function(t){ke.delete(s.tableCellInner),Object.assign(s,t.blotName||{}),Object.assign(i,t.tableUpSize||{}),Object.assign(o,t.tableUpEvent||{}),Oe.toolName=s.tableWrapper,Xt.blotName=s.container,ge.blotName=s.tableWrapper,me.blotName=s.tableMain,fe.blotName=s.tableColgroup,pe.blotName=s.tableCol,he.blotName=s.tableBody,de.blotName=s.tableRow,ue.blotName=s.tableCell,ce.blotName=s.tableCellInner},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.js.map
