(function(e,t){typeof exports==`object`&&typeof module<`u`?t(exports,require(`quill`)):typeof define==`function`&&define.amd?define([`exports`,`quill`],t):(e=typeof globalThis<`u`?globalThis:e||self,t(e.TableUp={},e.Quill))})(this,function(exports,t){Object.defineProperty(exports,`__esModule`,{value:!0});var n=Object.create,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,o=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,c=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),l=(e,t,n,o)=>{if(t&&typeof t==`object`||typeof t==`function`)for(var c=a(t),l=0,u=c.length,d;l<u;l++)d=c[l],!s.call(e,d)&&d!==n&&r(e,d,{get:(e=>t[e]).bind(null,d),enumerable:!(o=i(t,d))||o.enumerable});return e},u=(e,t,i)=>(i=e==null?{}:n(o(e)),l(t||!e||!e.__esModule?r(i,`default`,{value:e,enumerable:!0}):i,e));t=u(t);let d={container:`table-up-container`,tableCaption:`table-up-caption`,tableWrapper:`table-up`,tableMain:`table-up-main`,tableColgroup:`table-up-colgroup`,tableCol:`table-up-col`,tableBody:`table-up-body`,tableRow:`table-up-row`,tableCell:`table-up-cell`,tableCellInner:`table-up-cell-inner`},f={colMinWidthPre:5,colMinWidthPx:40,colDefaultWidth:100,rowMinHeightPx:36},p={AFTER_TABLE_RESIZE:`after-table-resize`},m={moduleName:`table-up`},h=[[`rgb(255, 255, 255)`,`rgb(0, 0, 0)`,`rgb(72, 83, 104)`,`rgb(41, 114, 244)`,`rgb(0, 163, 245)`,`rgb(49, 155, 98)`,`rgb(222, 60, 54)`,`rgb(248, 136, 37)`,`rgb(245, 196, 0)`,`rgb(153, 56, 215)`],[`rgb(242, 242, 242)`,`rgb(127, 127, 127)`,`rgb(243, 245, 247)`,`rgb(229, 239, 255)`,`rgb(229, 246, 255)`,`rgb(234, 250, 241)`,`rgb(254, 233, 232)`,`rgb(254, 243, 235)`,`rgb(254, 249, 227)`,`rgb(253, 235, 255)`],[`rgb(216, 216, 216)`,`rgb(89, 89, 89)`,`rgb(197, 202, 211)`,`rgb(199, 220, 255)`,`rgb(199, 236, 255)`,`rgb(195, 234, 213)`,`rgb(255, 201, 199)`,`rgb(255, 220, 196)`,`rgb(255, 238, 173)`,`rgb(242, 199, 255)`],[`rgb(191, 191, 191)`,`rgb(63, 63, 63)`,`rgb(128, 139, 158)`,`rgb(153, 190, 255)`,`rgb(153, 221, 255)`,`rgb(152, 215, 182)`,`rgb(255, 156, 153)`,`rgb(255, 186, 132)`,`rgb(255, 226, 112)`,`rgb(213, 142, 255)`],[`rgb(165, 165, 165)`,`rgb(38, 38, 38)`,`rgb(53, 59, 69)`,`rgb(20, 80, 184)`,`rgb(18, 116, 165)`,`rgb(39, 124, 79)`,`rgb(158, 30, 26)`,`rgb(184, 96, 20)`,`rgb(163, 130, 0)`,`rgb(94, 34, 129)`],[`rgb(147, 147, 147)`,`rgb(13, 13, 13)`,`rgb(36, 39, 46)`,`rgb(12, 48, 110)`,`rgb(10, 65, 92)`,`rgb(24, 78, 50)`,`rgb(88, 17, 14)`,`rgb(92, 48, 10)`,`rgb(102, 82, 0)`,`rgb(59, 21, 81)`]],g=`table-up`,_=new Set([d.tableCellInner]),v=e=>_.has(e.statics.blotName);function y(e){return e&&e.parent?v(e.parent)?!0:y(e.parent):!1}function b(e,t=g){let n=t?`${t}-`:``;return{b:()=>`${n}${e}`,be:t=>t?`${n}${e}__${t}`:``,bm:t=>t?`${n}${e}--${t}`:``,bem:(t,r)=>t&&r?`${n}${e}__${t}--${r}`:``,ns:e=>e?`${n}${e}`:``,bs:t=>t?`${n}${e}-${t}`:``,cv:e=>e?`--${n}${e}`:``,is:e=>`is-${e}`}}function x(e,t){let n=e.parent;for(;n&&n.statics.blotName!==t&&n!==e.scroll;)n=n.parent;if(n===e.scroll)throw Error(`${e.statics.blotName} must be a child of ${t}`);return n}function S(e,t){let n=Array(t.length),r=new Map(t.map((e,t)=>[e,t])),i=e.parent;for(;i&&i!==e.scroll&&r.size!==0;){if(r.has(i.statics.blotName)){let e=r.get(i.statics.blotName);n[e]=i,r.delete(i.statics.blotName)}i=i.parent}if(r.size>0)throw Error(`${e.statics.blotName} must be a child of ${Array.from(r.keys()).join(`, `)}`);return n}function C(e){let t=new Map,n=e;for(;n&&n.statics.blotName!==`scroll`;)t.set(n.statics.blotName,n),n=n.parent;return t}function w(e,t){let n=[],r=e.children.iterator(),i=null;for(;i=r();)i instanceof t&&n.push(i);return n}function T(e,t,n){for(let r of Object.getOwnPropertyNames(t)){if(n&&n.test(r))continue;Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}return e}function E(e,t){let n=class extends e{constructor(...e){super(...e)}};for(let e of t)T(n.prototype,e.prototype,/^constructor$/);return n}function D(e,t){return e.prototype instanceof t}function O(e,t){return e=Math.min(t,Math.max(0,Number.parseFloat(`${e}`))),Math.abs(e-t)<1e-6?1:e%t/Number.parseFloat(t)}function ee(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b)),a:Math.min(1,Math.max(0,e.a))}}function te(e){e=e.startsWith(`#`)?e.slice(1):e;let t=Number.parseInt(e.slice(0,2),16),n=Number.parseInt(e.slice(2,4),16),r=Number.parseInt(e.slice(4,6),16),i=Number((Number.parseInt(e.slice(6,8)||`ff`,16)/255).toFixed(2));return{r:t,g:n,b:r,a:i}}function ne(e){let{r:t,g:n,b:r,a:i}=e;t=O(t,255),n=O(n,255),r=O(r,255);let a=Math.max(t,n,r),o=Math.min(t,n,r),s,c=a,l=a-o,u=a===0?0:l/a;if(a===o)s=0;else{switch(a){case t:s=(n-r)/l+(n<r?6:0);break;case n:s=(r-t)/l+2;break;case r:s=(t-n)/l+4;break}s/=6}return{h:s*360,s:u*100,b:c*100,a:i}}function re(e){let{h:t,s:n,b:r,a:i}=e;t=O(t,360)*6,n=O(n,100),r=O(r,100);let a=Math.floor(t),o=t-a,s=r*(1-n),c=r*(1-o*n),l=r*(1-(1-o)*n),u=a%6,d=[r,c,s,s,l,r][u],f=[l,r,r,c,s,s][u],p=[s,s,l,r,r,c][u];return{r:Math.round(d*255),g:Math.round(f*255),b:Math.round(p*255),a:i}}function ie(e){let t=[e.r.toString(16),e.g.toString(16),e.b.toString(16),Math.round(e.a*255).toString(16)];for(let e in t)t[e].length===1&&(t[e]=`0${t[e]}`);return t.join(``)}let ae=e=>ie(re(e)),oe=e=>typeof e==`function`,k=Array.isArray,A=e=>typeof e==`string`,se=e=>typeof e==`number`,j=e=>typeof e==`object`&&!!e,ce=e=>!Number.isNaN(e)&&Number(e)>0;function M(e){let{type:t=`default`,content:n}=e||{},r=b(`button`),i=document.createElement(`button`);return i.classList.add(r.b(),t),n&&(A(n)?i.textContent=n:i.appendChild(n)),i}function le(e={}){let t=230,n=150,r=10,i=ne(te(e.color||`#ff0000`)),a=b(`color-picker`),o=document.createElement(`div`);o.classList.add(a.b());let s=document.createElement(`div`);s.classList.add(a.be(`content`));let c=document.createElement(`div`);c.classList.add(a.be(`selector`));let l=document.createElement(`div`);l.classList.add(a.be(`background`)),c.appendChild(l);let u=document.createElement(`div`);u.classList.add(a.be(`background-handle`)),l.appendChild(u);let d=document.createElement(`div`);d.classList.add(a.be(`alpha`));let f=document.createElement(`div`);f.classList.add(a.be(`alpha-bg`));let p=document.createElement(`div`);p.classList.add(a.be(`alpha-handle`)),d.appendChild(f),d.appendChild(p);let m=document.createElement(`div`);m.classList.add(a.be(`hue`));let h=document.createElement(`div`);h.classList.add(a.be(`hue-handle`)),m.appendChild(h);let g=document.createElement(`div`);g.classList.add(a.be(`action`));let[_,v,y,x]=[`r`,`g`,`b`,`a`].map(e=>{let t=document.createElement(`div`);t.classList.add(a.be(`action-item`),e);let n=document.createElement(`label`);n.textContent=e.toUpperCase();let r=document.createElement(`input`);return r.classList.add(a.be(`input`)),r.addEventListener(`input`,()=>{r.value=r.value.replaceAll(/[^0-9]/g,``)}),r.addEventListener(`change`,()=>{let t=Math.round(Number(r.value));e===`a`&&(t/=100);let n=ee(ne(Object.assign({},re(i),{[e]:t})));se(n),A()}),t.appendChild(n),t.appendChild(r),g.appendChild(t),r});s.appendChild(m),s.appendChild(c),s.appendChild(d),o.appendChild(s),o.appendChild(g);let S=!1,C=!1,w=!1;function T(){let e=ae(i);for(let[t,n]of[_,v,y].entries())n.value=String(Number.parseInt(e[t*2]+e[t*2+1],16));x.value=String((i.a*100).toFixed(0))}function E(){Object.assign(u.style,{left:`${Math.floor(t*i.s/100)}px`,top:`${Math.floor(n*(100-i.b)/100)}px`})}function D(){c.style.backgroundColor=`#${ie(re({h:i.h,s:100,b:100,a:1}))}`}function O(){h.style.top=`${Math.floor(n-n*i.h/360)}px`}function oe(){p.style.left=`${i.a*100}%`}function k(){let{r:e,g:t,b:n}=re(i);f.style.background=`linear-gradient(to right, rgba(${e}, ${t}, ${n}, 0) 0%, rgba(${e}, ${t}, ${n}, 1) 100%)`}function A(){E(),D(),O(),oe(),k(),T()}function se(t){i=ee(Object.assign({},i,t)),T(),e.onChange&&e.onChange(`#${ae(i)}`)}function j(e){let r=c.getBoundingClientRect(),i=r.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),a=r.left+document.body.scrollLeft,o=Math.floor(100*Math.max(0,Math.min(t,e.pageX-a))/t),s=Math.floor(100*(n-Math.max(0,Math.min(n,e.pageY-i)))/n);se({s:o,b:s}),A()}function ce(e){let t=m.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0);se({h:Math.floor(360*(n-Math.max(0,Math.min(n,e.pageY-t)))/n)}),A()}function M(e){let{pageX:t}=e,n=d.getBoundingClientRect(),i=t-n.left;i=Math.max(r/2,i),i=Math.min(i,n.width-r/2),se({a:Math.round((i-10/2)/(n.width-10)*100)/100}),A()}function le(e){S&&(e.preventDefault(),j(e)),C&&(e.preventDefault(),ce(e)),w&&(e.preventDefault(),M(e))}function ue(){document.removeEventListener(`mousemove`,le),document.removeEventListener(`mouseup`,ue),S=!1}function de(e){document.addEventListener(`mousemove`,le),document.addEventListener(`mouseup`,ue),S=!0,j(e)}c.addEventListener(`mousedown`,de);function fe(){document.removeEventListener(`mousemove`,le),document.removeEventListener(`mouseup`,fe),C=!1}function pe(e){document.addEventListener(`mousemove`,le),document.addEventListener(`mouseup`,fe),C=!0,ce(e)}m.addEventListener(`mousedown`,pe);function N(){document.removeEventListener(`mousemove`,le),document.removeEventListener(`mouseup`,N),w=!1}function me(e){document.addEventListener(`mousemove`,le),document.addEventListener(`mouseup`,N),w=!0,M(e)}return d.addEventListener(`mousedown`,me),A(),o}let ue=8e3;function de({child:e,target:t=document.body,beforeClose:n=()=>{}}={}){let r=b(`dialog`),i=t,a=document.createElement(`div`);a.classList.add(r.b()),a.style.zIndex=String(ue);let o=document.createElement(`div`);if(o.classList.add(r.be(`overlay`)),a.appendChild(o),e){let t=document.createElement(`div`);t.classList.add(r.be(`content`)),t.appendChild(e),o.appendChild(t),t.addEventListener(`click`,e=>{e.stopPropagation()})}let s=getComputedStyle(i).overflow;i.style.overflow=`hidden`,i.appendChild(a);let c=()=>{n(),a.remove(),i.style.overflow=s};return a.addEventListener(`click`,c),ue+=1,{dialog:a,close:c}}function fe(e,t){let n=b(`input`);t.type||(t.type=`text`),t.value||(t.value=``);let r=document.createElement(`div`);if(r.classList.add(n.be(`item`)),e){let t=document.createElement(`span`);t.classList.add(n.be(`label`)),t.textContent=e,r.appendChild(t)}let i=document.createElement(`div`);i.classList.add(n.be(`input`));let a=document.createElement(`input`);for(let e in t)a.setAttribute(e,t[e]);(t.max||t.min)&&a.addEventListener(`blur`,()=>{t.max&&t.max<=Number(a.value)&&(a.value=String(t.max)),t.min&&t.min>=Number(a.value)&&(a.value=String(t.min))}),i.appendChild(a),r.appendChild(i),a.addEventListener(`focus`,()=>{i.classList.add(`focus`)}),a.addEventListener(`blur`,()=>{i.classList.remove(`focus`)});let o=e=>{let t;i.classList.contains(`error`)?t=i.querySelector(`.${n.be(`error-tip`)}`):(t=document.createElement(`span`),t.classList.add(n.be(`error-tip`)),i.appendChild(t)),t.textContent=e,i.classList.add(`error`);let r=()=>{i.classList.remove(`error`),t.remove()};return{removeError:r}};return{item:r,input:a,errorTip:o}}function pe(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function N(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function o(e){pe(a,r,i,o,s,`next`,e)}function s(e){pe(a,r,i,o,s,`throw`,e)}o(void 0)})}}function me(){return he.apply(this,arguments)}function he(){return he=N(function*(e={}){let t=b(`creator`),n=document.createElement(`div`);n.classList.add(t.b());let r=document.createElement(`div`);r.classList.add(t.be(`input`));let{item:i,input:a,errorTip:o}=fe(e.rowText||`Row`,{type:`number`,value:String(e.row||``),max:99}),{item:s,input:c,errorTip:l}=fe(e.colText||`Column`,{type:`number`,value:String(e.col||``),max:99});r.appendChild(i),r.appendChild(s),n.appendChild(r);let u=document.createElement(`div`);u.classList.add(t.be(`control`));let d=M({type:`confirm`,content:e.confirmText||`Confirm`}),f=M({type:`default`,content:e.cancelText||`Cancel`});u.appendChild(d),u.appendChild(f),n.appendChild(u);let p=(t=Number(a.value),n=Number(c.value))=>{if(Number.isNaN(t)||t<=0){o(e.notPositiveNumberError||`Please enter a positive integer`);return}if(Number.isNaN(n)||n<=0){l(e.notPositiveNumberError||`Please enter a positive integer`);return}return{row:t,col:n}},m=e=>{e.key===`Escape`&&(close(),document.removeEventListener(`keydown`,m))};return new Promise((e,t)=>{let{close:r}=de({child:n,beforeClose:t});a.focus();for(let t of[a,c])t.addEventListener(`keydown`,t=>{if(t.key===`Enter`){let t=p();t&&(e(t),r())}});d.addEventListener(`click`,N(function*(){let t=p();t&&(e(t),r())})),document.addEventListener(`keydown`,m),f.addEventListener(`click`,r)})}),he.apply(this,arguments)}function ge(e={}){let t=b(`select-box`),n=document.createElement(`div`);n.classList.add(t.b());let r=document.createElement(`div`);r.classList.add(t.be(`block`));for(let n=0;n<(e.row||8);n++)for(let i=0;i<(e.col||8);i++){let e=document.createElement(`div`);e.classList.add(t.be(`item`)),e.dataset.row=String(n+1),e.dataset.col=String(i+1),r.appendChild(e)}let i=()=>{let{row:e,col:t}=n.dataset;for(let e of Array.from(r.querySelectorAll(`.active`)))e.classList.remove(`active`);if(!e||!t)return;let i=Array.from(r.children);for(let n=0;n<i.length;n++){let{row:r,col:a}=i[n].dataset;if(r>e&&a>t)return;r<=e&&a<=t?i[n].classList.add(`active`):i[n].classList.remove(`active`)}};if(r.addEventListener(`mousemove`,e=>{if(!e.target)return;let{row:t,col:r}=e.target.dataset;!t||!r||(n.dataset.row=t,n.dataset.col=r,i())}),r.addEventListener(`mouseleave`,()=>{n.removeAttribute(`data-row`),n.removeAttribute(`data-col`),i()}),r.addEventListener(`click`,()=>{let{row:t,col:r}=n.dataset;!t||!r||e.onSelect&&e.onSelect(Number(t),Number(r))}),n.appendChild(r),e.customBtn){let r=e.texts||{},i=document.createElement(`div`);i.classList.add(t.be(`custom`)),i.textContent=r.customBtnText||`Custom`,i.addEventListener(`click`,N(function*(){let t=yield me(r);t&&e.onSelect&&e.onSelect(t.row,t.col)})),n.appendChild(i)}return n}function _e(e){"@babel/helpers - typeof";return _e=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},_e(e)}function ve(e,t){if(_e(e)!=`object`||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||`default`);if(_e(r)!=`object`)return r;throw TypeError(`@@toPrimitive must return a primitive value.`)}return(t===`string`?String:Number)(e)}function ye(e){var t=ve(e,`string`);return _e(t)==`symbol`?t:t+``}function P(e,t,n){return(t=ye(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?be(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let xe=Math.min,Se=Math.max,Ce=Math.round,we=Math.floor,I=e=>({x:e,y:e}),Te={left:`right`,right:`left`,bottom:`top`,top:`bottom`},Ee={start:`end`,end:`start`};function De(e,t,n){return Se(e,xe(t,n))}function Oe(e,t){return typeof e==`function`?e(t):e}function L(e){return e.split(`-`)[0]}function ke(e){return e.split(`-`)[1]}function Ae(e){return e===`x`?`y`:`x`}function je(e){return e===`y`?`height`:`width`}function Me(e){return[`top`,`bottom`].includes(L(e))?`y`:`x`}function Ne(e){return Ae(Me(e))}function Pe(e,t,n){n===void 0&&(n=!1);let r=ke(e),i=Ne(e),a=je(i),o=i===`x`?r===(n?`end`:`start`)?`right`:`left`:r===`start`?`bottom`:`top`;return t.reference[a]>t.floating[a]&&(o=ze(o)),[o,ze(o)]}function Fe(e){let t=ze(e);return[Ie(e),t,Ie(t)]}function Ie(e){return e.replace(/start|end/g,e=>Ee[e])}function Le(e,t,n){let r=[`left`,`right`],i=[`right`,`left`],a=[`top`,`bottom`],o=[`bottom`,`top`];switch(e){case`top`:case`bottom`:return n?t?i:r:t?r:i;case`left`:case`right`:return t?a:o;default:return[]}}function Re(e,t,n,r){let i=ke(e),a=Le(L(e),n===`start`,r);return i&&(a=a.map(e=>e+`-`+i),t&&(a=a.concat(a.map(Ie)))),a}function ze(e){return e.replace(/left|right|bottom|top/g,e=>Te[e])}function Be(e){return F({top:0,right:0,bottom:0,left:0},e)}function Ve(e){return typeof e==`number`?{top:e,right:e,bottom:e,left:e}:Be(e)}function He(e){let{x:t,y:n,width:r,height:i}=e;return{width:r,height:i,top:n,left:t,right:t+r,bottom:n+i,x:t,y:n}}function Ue(e,t){if(e==null)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}function R(e,t){if(e==null)return{};var n,r,i=Ue(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let We=[`crossAxis`,`alignment`,`allowedPlacements`,`autoAlignment`],Ge=[`mainAxis`,`crossAxis`,`fallbackPlacements`,`fallbackStrategy`,`fallbackAxisSideDirection`,`flipAlignment`],Ke=[`strategy`],qe=[`mainAxis`,`crossAxis`,`limiter`],Je=[`apply`];function Ye(e,t,n){let{reference:r,floating:i}=e,a=Me(t),o=Ne(t),s=je(o),c=L(t),l=a===`y`,u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,f=r[s]/2-i[s]/2,p;switch(c){case`top`:p={x:u,y:r.y-i.height};break;case`bottom`:p={x:u,y:r.y+r.height};break;case`right`:p={x:r.x+r.width,y:d};break;case`left`:p={x:r.x-i.width,y:d};break;default:p={x:r.x,y:r.y}}switch(ke(t)){case`start`:p[o]-=f*(n&&l?-1:1);break;case`end`:p[o]+=f*(n&&l?-1:1);break}return p}let Xe=function(){var e=N(function*(e,t,n){let{placement:r=`bottom`,strategy:i=`absolute`,middleware:a=[],platform:o}=n,s=a.filter(Boolean),c=yield o.isRTL==null?void 0:o.isRTL(t),l=yield o.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:d}=Ye(l,r,c),f=r,p={},m=0;for(let n=0;n<s.length;n++){let{name:a,fn:h}=s[n],{x:g,y:_,data:v,reset:y}=yield h({x:u,y:d,initialPlacement:r,placement:f,strategy:i,middlewareData:p,rects:l,platform:o,elements:{reference:e,floating:t}});u=g==null?u:g,d=_==null?d:_,p=F(F({},p),{},{[a]:F(F({},p[a]),v)}),y&&m<=50&&(m++,typeof y==`object`&&(y.placement&&(f=y.placement),y.rects&&(l=y.rects===!0?yield o.getElementRects({reference:e,floating:t,strategy:i}):y.rects),{x:u,y:d}=Ye(l,f,c)),n=-1)}return{x:u,y:d,placement:f,strategy:i,middlewareData:p}});return function(t,n,r){return e.apply(this,arguments)}}();function Ze(e,t){return Qe.apply(this,arguments)}function Qe(){return Qe=N(function*(e,t){var n;t===void 0&&(t={});let{x:r,y:i,platform:a,rects:o,elements:s,strategy:c}=e,{boundary:l=`clippingAncestors`,rootBoundary:u=`viewport`,elementContext:d=`floating`,altBoundary:f=!1,padding:p=0}=Oe(t,e),m=Ve(p),h=d===`floating`?`reference`:`floating`,g=s[f?h:d],_=He(yield a.getClippingRect({element:(n=yield a.isElement==null?void 0:a.isElement(g))==null||n?g:g.contextElement||(yield a.getDocumentElement==null?void 0:a.getDocumentElement(s.floating)),boundary:l,rootBoundary:u,strategy:c})),v=d===`floating`?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,y=yield a.getOffsetParent==null?void 0:a.getOffsetParent(s.floating),b=(yield a.isElement==null?void 0:a.isElement(y))&&(yield a.getScale==null?void 0:a.getScale(y))||{x:1,y:1},x=He(a.convertOffsetParentRelativeRectToViewportRelativeRect?yield a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:v,offsetParent:y,strategy:c}):v);return{top:(_.top-x.top+m.top)/b.y,bottom:(x.bottom-_.bottom+m.bottom)/b.y,left:(_.left-x.left+m.left)/b.x,right:(x.right-_.right+m.right)/b.x}}),Qe.apply(this,arguments)}let z=function(e){return e===void 0&&(e={}),{name:`flip`,options:e,fn(t){return N(function*(){var n,r;let{placement:i,middlewareData:a,rects:o,initialPlacement:s,platform:c,elements:l}=t,u=Oe(e,t),{mainAxis:d=!0,crossAxis:f=!0,fallbackPlacements:p,fallbackStrategy:m=`bestFit`,fallbackAxisSideDirection:h=`none`,flipAlignment:g=!0}=u,_=R(u,Ge);if((n=a.arrow)!=null&&n.alignmentOffset)return{};let v=L(i),y=Me(s),b=L(s)===s,x=yield c.isRTL==null?void 0:c.isRTL(l.floating),S=p||(b||!g?[ze(s)]:Fe(s)),C=h!==`none`;!p&&C&&S.push(...Re(s,g,h,x));let w=[s,...S],T=yield Ze(t,_),E=[],D=((r=a.flip)==null?void 0:r.overflows)||[];if(d&&E.push(T[v]),f){let e=Pe(i,o,x);E.push(T[e[0]],T[e[1]])}if(D=[...D,{placement:i,overflows:E}],!E.every(e=>e<=0)){var O,ee;let e=(((O=a.flip)==null?void 0:O.index)||0)+1,t=w[e];if(t){let n=f===`alignment`?y!==Me(t):!1;if(!n||D.every(e=>e.overflows[0]>0&&Me(e.placement)===y))return{data:{index:e,overflows:D},reset:{placement:t}}}let n=(ee=D.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])==null?void 0:ee.placement;if(!n)switch(m){case`bestFit`:{var te;let e=(te=D.filter(e=>{if(C){let t=Me(e.placement);return t===y||t===`y`}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])==null?void 0:te[0];e&&(n=e);break}case`initialPlacement`:n=s;break}if(i!==n)return{reset:{placement:n}}}return{}})()}}};function $e(e,t){return et.apply(this,arguments)}function et(){return et=N(function*(e,t){let{placement:n,platform:r,elements:i}=e,a=yield r.isRTL==null?void 0:r.isRTL(i.floating),o=L(n),s=ke(n),c=Me(n)===`y`,l=[`left`,`top`].includes(o)?-1:1,u=a&&c?-1:1,d=Oe(t,e),{mainAxis:f,crossAxis:p,alignmentAxis:m}=typeof d==`number`?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return s&&typeof m==`number`&&(p=s===`end`?m*-1:m),c?{x:p*u,y:f*l}:{x:f*l,y:p*u}}),et.apply(this,arguments)}let tt=function(e){return e===void 0&&(e=0),{name:`offset`,options:e,fn(t){return N(function*(){var n,r;let{x:i,y:a,placement:o,middlewareData:s}=t,c=yield $e(t,e);return o===((n=s.offset)==null?void 0:n.placement)&&(r=s.arrow)!=null&&r.alignmentOffset?{}:{x:i+c.x,y:a+c.y,data:F(F({},c),{},{placement:o})}})()}}},nt=function(e){return e===void 0&&(e={}),{name:`shift`,options:e,fn(t){return N(function*(){let{x:n,y:r,placement:i}=t,a=Oe(e,t),{mainAxis:o=!0,crossAxis:s=!1,limiter:c={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}}}=a,l=R(a,qe),u={x:n,y:r},d=yield Ze(t,l),f=Me(L(i)),p=Ae(f),m=u[p],h=u[f];if(o){let e=p===`y`?`top`:`left`,t=p===`y`?`bottom`:`right`,n=m+d[e],r=m-d[t];m=De(n,m,r)}if(s){let e=f===`y`?`top`:`left`,t=f===`y`?`bottom`:`right`,n=h+d[e],r=h-d[t];h=De(n,h,r)}let g=c.fn(F(F({},t),{},{[p]:m,[f]:h}));return F(F({},g),{},{data:{x:g.x-n,y:g.y-r,enabled:{[p]:o,[f]:s}}})})()}}},rt=function(e){return e===void 0&&(e={}),{options:e,fn(t){let{x:n,y:r,placement:i,rects:a,middlewareData:o}=t,{offset:s=0,mainAxis:c=!0,crossAxis:l=!0}=Oe(e,t),u={x:n,y:r},d=Me(i),f=Ae(d),p=u[f],m=u[d],h=Oe(s,t),g=typeof h==`number`?{mainAxis:h,crossAxis:0}:F({mainAxis:0,crossAxis:0},h);if(c){let e=f===`y`?`height`:`width`,t=a.reference[f]-a.floating[e]+g.mainAxis,n=a.reference[f]+a.reference[e]-g.mainAxis;p<t?p=t:p>n&&(p=n)}if(l){var _,v;let e=f===`y`?`width`:`height`,t=[`top`,`left`].includes(L(i)),n=a.reference[d]-a.floating[e]+(t&&((_=o.offset)==null?void 0:_[d])||0)+(t?0:g.crossAxis),r=a.reference[d]+a.reference[e]+(t?0:((v=o.offset)==null?void 0:v[d])||0)-(t?g.crossAxis:0);m<n?m=n:m>r&&(m=r)}return{[f]:p,[d]:m}}}};function B(){return typeof window<`u`}function it(e){return ot(e)?(e.nodeName||``).toLowerCase():`#document`}function V(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function at(e){var t;return(t=(ot(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function ot(e){return B()?e instanceof Node||e instanceof V(e).Node:!1}function st(e){return B()?e instanceof Element||e instanceof V(e).Element:!1}function H(e){return B()?e instanceof HTMLElement||e instanceof V(e).HTMLElement:!1}function ct(e){return!B()||typeof ShadowRoot>`u`?!1:e instanceof ShadowRoot||e instanceof V(e).ShadowRoot}function lt(e){let{overflow:t,overflowX:n,overflowY:r,display:i}=U(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&![`inline`,`contents`].includes(i)}function ut(e){return[`table`,`td`,`th`].includes(it(e))}function dt(e){return[`:popover-open`,`:modal`].some(t=>{try{return e.matches(t)}catch(e){return!1}})}function ft(e){let t=mt(),n=st(e)?U(e):e;return[`transform`,`translate`,`scale`,`rotate`,`perspective`].some(e=>n[e]?n[e]!==`none`:!1)||(n.containerType?n.containerType!==`normal`:!1)||!t&&(n.backdropFilter?n.backdropFilter!==`none`:!1)||!t&&(n.filter?n.filter!==`none`:!1)||[`transform`,`translate`,`scale`,`rotate`,`perspective`,`filter`].some(e=>(n.willChange||``).includes(e))||[`paint`,`layout`,`strict`,`content`].some(e=>(n.contain||``).includes(e))}function pt(e){let t=_t(e);for(;H(t)&&!ht(t);){if(ft(t))return t;if(dt(t))return null;t=_t(t)}return null}function mt(){return typeof CSS>`u`||!CSS.supports?!1:CSS.supports(`-webkit-backdrop-filter`,`none`)}function ht(e){return[`html`,`body`,`#document`].includes(it(e))}function U(e){return V(e).getComputedStyle(e)}function gt(e){return st(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function _t(e){if(it(e)===`html`)return e;let t=e.assignedSlot||e.parentNode||ct(e)&&e.host||at(e);return ct(t)?t.host:t}function vt(e){let t=_t(e);return ht(t)?e.ownerDocument?e.ownerDocument.body:e.body:H(t)&&lt(t)?t:vt(t)}function yt(e,t,n){var r;t===void 0&&(t=[]),n===void 0&&(n=!0);let i=vt(e),a=i===((r=e.ownerDocument)==null?void 0:r.body),o=V(i);if(a){let e=bt(o);return t.concat(o,o.visualViewport||[],lt(i)?i:[],e&&n?yt(e):[])}return t.concat(i,yt(i,[],n))}function bt(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function xt(e){let t=U(e),n=parseFloat(t.width)||0,r=parseFloat(t.height)||0,i=H(e),a=i?e.offsetWidth:n,o=i?e.offsetHeight:r,s=Ce(n)!==a||Ce(r)!==o;return s&&(n=a,r=o),{width:n,height:r,$:s}}function St(e){return st(e)?e:e.contextElement}function Ct(e){let t=St(e);if(!H(t))return I(1);let n=t.getBoundingClientRect(),{width:r,height:i,$:a}=xt(t),o=(a?Ce(n.width):n.width)/r,s=(a?Ce(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!s||!Number.isFinite(s))&&(s=1),{x:o,y:s}}let wt=I(0);function Tt(e){let t=V(e);return!mt()||!t.visualViewport?wt:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Et(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==V(e)?!1:t}function Dt(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);let i=e.getBoundingClientRect(),a=St(e),o=I(1);t&&(r?st(r)&&(o=Ct(r)):o=Ct(e));let s=Et(a,n,r)?Tt(a):I(0),c=(i.left+s.x)/o.x,l=(i.top+s.y)/o.y,u=i.width/o.x,d=i.height/o.y;if(a){let e=V(a),t=r&&st(r)?V(r):r,n=e,i=bt(n);for(;i&&r&&t!==n;){let e=Ct(i),t=i.getBoundingClientRect(),r=U(i),a=t.left+(i.clientLeft+parseFloat(r.paddingLeft))*e.x,o=t.top+(i.clientTop+parseFloat(r.paddingTop))*e.y;c*=e.x,l*=e.y,u*=e.x,d*=e.y,c+=a,l+=o,n=V(i),i=bt(n)}}return He({width:u,height:d,x:c,y:l})}function Ot(e,t){let n=gt(e).scrollLeft;return t?t.left+n:Dt(at(e)).left+n}function kt(e,t,n){n===void 0&&(n=!1);let r=e.getBoundingClientRect(),i=r.left+t.scrollLeft-(n?0:Ot(e,r)),a=r.top+t.scrollTop;return{x:i,y:a}}function At(e){let{elements:t,rect:n,offsetParent:r,strategy:i}=e,a=i===`fixed`,o=at(r),s=t?dt(t.floating):!1;if(r===o||s&&a)return n;let c={scrollLeft:0,scrollTop:0},l=I(1),u=I(0),d=H(r);if((d||!d&&!a)&&((it(r)!==`body`||lt(o))&&(c=gt(r)),H(r))){let e=Dt(r);l=Ct(r),u.x=e.x+r.clientLeft,u.y=e.y+r.clientTop}let f=o&&!d&&!a?kt(o,c,!0):I(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+u.x+f.x,y:n.y*l.y-c.scrollTop*l.y+u.y+f.y}}function jt(e){return Array.from(e.getClientRects())}function Mt(e){let t=at(e),n=gt(e),r=e.ownerDocument.body,i=Se(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),a=Se(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight),o=-n.scrollLeft+Ot(e),s=-n.scrollTop;return U(r).direction===`rtl`&&(o+=Se(t.clientWidth,r.clientWidth)-i),{width:i,height:a,x:o,y:s}}function Nt(e,t){let n=V(e),r=at(e),i=n.visualViewport,a=r.clientWidth,o=r.clientHeight,s=0,c=0;if(i){a=i.width,o=i.height;let e=mt();(!e||e&&t===`fixed`)&&(s=i.offsetLeft,c=i.offsetTop)}return{width:a,height:o,x:s,y:c}}function Pt(e,t){let n=Dt(e,!0,t===`fixed`),r=n.top+e.clientTop,i=n.left+e.clientLeft,a=H(e)?Ct(e):I(1),o=e.clientWidth*a.x,s=e.clientHeight*a.y,c=i*a.x,l=r*a.y;return{width:o,height:s,x:c,y:l}}function Ft(e,t,n){let r;if(t===`viewport`)r=Nt(e,n);else if(t===`document`)r=Mt(at(e));else if(st(t))r=Pt(t,n);else{let n=Tt(e);r={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return He(r)}function It(e,t){let n=_t(e);return n===t||!st(n)||ht(n)?!1:U(n).position===`fixed`||It(n,t)}function Lt(e,t){let n=t.get(e);if(n)return n;let r=yt(e,[],!1).filter(e=>st(e)&&it(e)!==`body`),i=null,a=U(e).position===`fixed`,o=a?_t(e):e;for(;st(o)&&!ht(o);){let t=U(o),n=ft(o);!n&&t.position===`fixed`&&(i=null);let s=a?!n&&!i:!n&&t.position===`static`&&!!i&&[`absolute`,`fixed`].includes(i.position)||lt(o)&&!n&&It(e,o);s?r=r.filter(e=>e!==o):i=t,o=_t(o)}return t.set(e,r),r}function Rt(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e,a=n===`clippingAncestors`?dt(t)?[]:Lt(t,this._c):[].concat(n),o=[...a,r],s=o[0],c=o.reduce((e,n)=>{let r=Ft(t,n,i);return e.top=Se(r.top,e.top),e.right=xe(r.right,e.right),e.bottom=xe(r.bottom,e.bottom),e.left=Se(r.left,e.left),e},Ft(t,s,i));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function zt(e){let{width:t,height:n}=xt(e);return{width:t,height:n}}function Bt(e,t,n){let r=H(t),i=at(t),a=n===`fixed`,o=Dt(e,!0,a,t),s={scrollLeft:0,scrollTop:0},c=I(0);function l(){c.x=Ot(i)}if(r||!r&&!a)if((it(t)!==`body`||lt(i))&&(s=gt(t)),r){let e=Dt(t,!0,a,t);c.x=e.x+t.clientLeft,c.y=e.y+t.clientTop}else i&&l();a&&!r&&i&&l();let u=i&&!r&&!a?kt(i,s):I(0),d=o.left+s.scrollLeft-c.x-u.x,f=o.top+s.scrollTop-c.y-u.y;return{x:d,y:f,width:o.width,height:o.height}}function Vt(e){return U(e).position===`static`}function Ht(e,t){if(!H(e)||U(e).position===`fixed`)return null;if(t)return t(e);let n=e.offsetParent;return at(e)===n&&(n=n.ownerDocument.body),n}function Ut(e,t){let n=V(e);if(dt(e))return n;if(!H(e)){let t=_t(e);for(;t&&!ht(t);){if(st(t)&&!Vt(t))return t;t=_t(t)}return n}let r=Ht(e,t);for(;r&&ut(r)&&Vt(r);)r=Ht(r,t);return r&&ht(r)&&Vt(r)&&!ft(r)?n:r||pt(e)||n}let Wt=function(){var e=N(function*(e){let t=this.getOffsetParent||Ut,n=this.getDimensions,r=yield n(e.floating);return{reference:Bt(e.reference,yield t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}});return function(t){return e.apply(this,arguments)}}();function W(e){return U(e).direction===`rtl`}let Gt={convertOffsetParentRelativeRectToViewportRelativeRect:At,getDocumentElement:at,getClippingRect:Rt,getOffsetParent:Ut,getElementRects:Wt,getClientRects:jt,getDimensions:zt,getScale:Ct,isElement:st,isRTL:W};function Kt(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function qt(e,t){let n=null,r,i=at(e);function a(){var e;clearTimeout(r),(e=n)==null||e.disconnect(),n=null}function o(s,c){s===void 0&&(s=!1),c===void 0&&(c=1),a();let l=e.getBoundingClientRect(),{left:u,top:d,width:f,height:p}=l;if(s||t(),!f||!p)return;let m=we(d),h=we(i.clientWidth-(u+f)),g=we(i.clientHeight-(d+p)),_=we(u),v=-m+`px `+-h+`px `+-g+`px `+-_+`px`,y={rootMargin:v,threshold:Se(0,xe(1,c))||1},b=!0;function x(t){let n=t[0].intersectionRatio;if(n!==c){if(!b)return o();n?o(!1,n):r=setTimeout(()=>{o(!1,1e-7)},1e3)}n===1&&!Kt(l,e.getBoundingClientRect())&&o(),b=!1}try{n=new IntersectionObserver(x,F(F({},y),{},{root:i.ownerDocument}))}catch(e){n=new IntersectionObserver(x,y)}n.observe(e)}return o(!0),a}function Jt(e,t,n,r){r===void 0&&(r={});let{ancestorScroll:i=!0,ancestorResize:a=!0,elementResize:o=typeof ResizeObserver==`function`,layoutShift:s=typeof IntersectionObserver==`function`,animationFrame:c=!1}=r,l=St(e),u=i||a?[...l?yt(l):[],...yt(t)]:[];u.forEach(e=>{i&&e.addEventListener(`scroll`,n,{passive:!0}),a&&e.addEventListener(`resize`,n)});let d=l&&s?qt(l,n):null,f=-1,p=null;o&&(p=new ResizeObserver(e=>{let[r]=e;r&&r.target===l&&p&&(p.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var e;(e=p)==null||e.observe(t)})),n()}),l&&!c&&p.observe(l),p.observe(t));let m,h=c?Dt(e):null;c&&g();function g(){let t=Dt(e);h&&!Kt(h,t)&&n(),h=t,m=requestAnimationFrame(g)}return n(),()=>{var e;u.forEach(e=>{i&&e.removeEventListener(`scroll`,n),a&&e.removeEventListener(`resize`,n)}),d?.(),(e=p)==null||e.disconnect(),p=null,c&&cancelAnimationFrame(m)}}let Yt=tt,Xt=nt,Zt=z,Qt=rt,$t=(e,t,n)=>{let r=new Map,i=F({platform:Gt},n),a=F(F({},i.platform),{},{_c:r});return Xe(e,t,F(F({},i),{},{platform:a}))};function en(e,t,n,r,i){return i&&clearTimeout(i),e.addEventListener(`transitionend`,n,r),setTimeout(()=>{n()},t)}let tn=4,nn;function rn(e,t={}){let{msg:n=``,delay:r=150,content:i,direction:a=`bottom`,type:o=`hover`,container:s,onOpen:c,onClose:l,closed:u,onDestroy:d}=t,f=b(`tooltip`);if(n||i){nn||(nn=document.createElement(`div`),document.body.appendChild(nn));let t=s||nn,p=document.createElement(`div`);p.classList.add(f.b(),`hidden`,`transparent`),i?p.appendChild(i):n&&(p.textContent=n);let m,h,g,_=()=>{g&&g(),$t(e,p,{placement:a,middleware:[Zt(),Xt({limiter:Qt()}),Yt(tn)]}).then(({x:e,y:t})=>{Object.assign(p.style,{left:`${e}px`,top:`${t}px`})})},v=()=>{p.classList.add(`hidden`),t.contains(p)&&t.removeChild(p),g&&g(),u&&u()},y=(n=!1)=>{h&&clearTimeout(h),m=setTimeout(()=>{if(c){let e=c(n);if(!n&&e)return}t.appendChild(p),p.removeEventListener(`transitionend`,v),p.classList.remove(`hidden`),g=Jt(e,p,_),p.classList.remove(`transparent`)},r)},b=(e=!1)=>{m&&clearTimeout(m),h=setTimeout(()=>{if(l){let t=l(e);if(!e&&t)return}en(p,150,v,{once:!0}),p.classList.add(`transparent`)},r)},x=()=>{let t=[e,p],n=b.bind(void 0,!1),r=y.bind(void 0,!1),i=()=>{for(let e of t)e.addEventListener(`mouseenter`,r),e.addEventListener(`mouseleave`,n)};return{prepare:i,show:y,hide:b,destroy:()=>{for(let e of t)e.removeEventListener(`mouseenter`,r),e.removeEventListener(`mouseleave`,n)}}},S=()=>{let t=e=>{e.stopPropagation(),b(!1)},n=e=>{e.stopPropagation(),y(),document.removeEventListener(`click`,t),document.addEventListener(`click`,t,{once:!0})};return{prepare:()=>{p.addEventListener(`click`,e=>e.stopPropagation()),e.addEventListener(`click`,n)},show:y,hide:(e=!1)=>{b(e),document.removeEventListener(`click`,t)},destroy:()=>{e.removeEventListener(`click`,n),document.removeEventListener(`click`,t)}}},C={hover:x,click:S},{prepare:w,show:T,hide:E,destroy:D}=C[o]();w();let O=()=>{E(!0),d&&d(),D(),g&&g(),p.remove()};return{show:T,hide:E,destroy:O}}return null}function an(e,t,n=0,r=!0){let{x:i,y:a,x1:o,y1:s}=e,{x:c,y:l,x1:u,y1:d}=t,f,p;return r?(f=o<c+n||i-n>u,p=s<l+n||a-n>d):(f=o<=c+n||i-n>=u,p=s<=l+n||a-n>=d),!(f||p)}function on(e,t){let n=t.getBoundingClientRect();return{x:e.x-n.x-t.scrollLeft,y:e.y-n.y-t.scrollTop,x1:e.x-n.x-t.scrollLeft+e.width,y1:e.y-n.y-t.scrollTop+e.height,width:e.width,height:e.height}}let sn=8;function cn(e){let{left:t,top:n,width:r,height:i}=e,{clientWidth:a,clientHeight:o}=document.documentElement,s=!1,c=!1;return t+r>a?(t=a-r-sn,s=!0):t<0&&(t=sn,s=!0),n+i>o?(n=o-i-sn,c=!0):n<0&&(n=sn,c=!0),{left:t,top:n,leftLimited:s,topLimited:c}}function ln(e,t={}){let n=Symbol(`ignoreFirstBind`),r=new Set,i=new ResizeObserver(r=>{t.ignoreFirstBind&&r.some(e=>{let t=e.target,r=t[n];return t[n]=!0,!r})||e(r)}),a=i.observe;i.observe=(e,t)=>{r.add(e),a.call(i,e,t)};let o=i.unobserve;i.unobserve=e=>{r.has(e)&&(r.delete(e),e[n]=void 0),o.call(i,e)};let s=i.disconnect;return i.disconnect=()=>{for(let e of r.values())e[n]=void 0;s.call(i)},i}function un(e,t){e.addEventListener(`scroll`,t),this.scrollHandler.push([e,t])}function dn(){for(let e=0;e<this.scrollHandler.length;e++){let[t,n]=this.scrollHandler[e];t.removeEventListener(`scroll`,n)}this.scrollHandler=[]}function fn(e){return{y:e.scrollTop,x:e.scrollLeft}}function pn(e){let t={},n=e.trim().split(`;`);for(let e=0;e<n.length;e++){let r=n[e].trim();if(!r)continue;let i=r.indexOf(`:`);if(i===-1)continue;let a=r.slice(0,Math.max(0,i)).trim(),o=r.slice(Math.max(0,i+1)).trim();t[gn(a)]=o}return t}function mn(e){return Object.entries(e).map(([e,t])=>`${hn(e)}: ${t};`).join(` `)}function hn(e){let t=e.replaceAll(RegExp(`([A-Z])`,`g`),` $1`).trim();return t.split(` `).join(`-`).toLowerCase()}function gn(e){return e.replaceAll(RegExp(`-(\\w)`,`g`),(e,t)=>t.toUpperCase())}let G=()=>Math.random().toString(36).slice(2);function _n(e,t){let n;return function(...r){n&&clearTimeout(n),n=setTimeout(()=>{e.apply(this,r)},t)}}let vn=t.default.import(`parchment`),yn=t.default.import(`blots/container`),bn=t.default.import(`blots/block`),xn=t.default.import(`blots/block/embed`);var K=class e extends yn{static create(e){let t=document.createElement(this.tagName);return this.className&&t.classList.add(this.className),t}optimize(e){if(this.children.length===0)if(this.statics.defaultChild!=null){let e=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(e)}else this.remove();this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}enforceAllowedChildren(){this.children.forEach(t=>{let n=this.statics.allowedChildren.some(e=>t instanceof e);n||(t.statics.scope===vn.Scope.BLOCK_BLOT?(t.parent instanceof e?(t.next!=null&&t.parent.splitAfter(t),t.prev!=null&&t.parent.splitAfter(t.prev)):(t.next!=null&&this.splitAfter(t),t.prev!=null&&this.splitAfter(t.prev)),t.parent.unwrap()):t instanceof vn.ParentBlot?t.unwrap():t.remove())})}};P(K,`tagName`,void 0),P(K,`blotName`,d.container),P(K,`scope`,vn.Scope.BLOCK_BLOT),P(K,`allowedChildren`,[bn,xn,yn]),P(K,`requiredContainer`,void 0),P(K,`defaultChild`,void 0);let Sn=e=>ce(e)?e:1,Cn=t.default.import(`blots/block`),wn=t.default.import(`blots/block/embed`);var q=class extends K{static isAllowStyle(e){let t=gn(e);for(let e of this.allowStyle)if(t.startsWith(gn(e)))return!0;return!1}static create(e){let{tableId:t,rowId:n,colId:r,rowspan:i,colspan:a,style:o,emptyRow:s}=e,c=super.create();c.dataset.tableId=t,c.dataset.rowId=n,c.dataset.colId=r,c.dataset.rowspan=String(Sn(i)),c.dataset.colspan=String(Sn(a)),o&&(c.dataset.style=o);try{s&&(c.dataset.emptyRow=JSON.stringify(s))}catch(e){}return c}static formats(e){let{tableId:t,rowId:n,colId:r,rowspan:i,colspan:a,style:o,emptyRow:s}=e.dataset,c={tableId:String(t),rowId:String(n),colId:String(r),rowspan:Number(Sn(i)),colspan:Number(Sn(a))};o&&(c.style=o);try{s&&(c.emptyRow=JSON.parse(s))}catch(e){}return c}constructor(e,t,n){super(e,t),t.setAttribute(`contenteditable`,String(e.isEnabled()))}setFormatValue(e,t,n=!1){if(n){if(!this.statics.isAllowStyle(e))return;this.parent&&this.parent.statics.blotName===d.tableCell&&this.parent.setFormatValue(e,t)}else{if(!this.statics.allowDataAttrs.has(e))return;let n=`data-${e}`;t?this.domNode.setAttribute(n,t):this.domNode.removeAttribute(n),this.parent&&this.parent.statics.blotName===d.tableCell&&this.parent.setFormatValue(e,t)}let r=this.descendants(Cn,0);for(let e of r)e.cache={}}get tableId(){return this.domNode.dataset.tableId}get rowId(){return this.domNode.dataset.rowId}set rowId(e){this.setFormatValue(`row-id`,e)}get colId(){return this.domNode.dataset.colId}set colId(e){this.setFormatValue(`col-id`,e)}get rowspan(){return Number(this.domNode.dataset.rowspan)}set rowspan(e){this.setFormatValue(`rowspan`,e)}get colspan(){return Number(this.domNode.dataset.colspan)}set colspan(e){this.setFormatValue(`colspan`,e)}get emptyRow(){try{return JSON.parse(this.domNode.dataset.emptyRow)}catch(e){return[]}}set emptyRow(e){if(this.emptyRow.toString()!==e.toString())try{e.length>0?this.setFormatValue(`empty-row`,JSON.stringify(e),!1):this.setFormatValue(`empty-row`,null,!1)}catch(e){this.setFormatValue(`empty-row`,null,!1)}}getColumnIndex(){let e=x(this,d.tableMain);return e.getColIds().indexOf(this.colId)}setStyleByString(e){let t=pn(e);for(let[e,n]of Object.entries(t))this.setFormatValue(e,n,!0)}formatAt(e,t,n,r){this.children.length===0&&(this.appendChild(this.scroll.create(this.statics.defaultChild.blotName)),t+=1),super.formatAt(e,t,n,r),r&&r.style&&this.setStyleByString(r.style)}insertAt(e,t,n){let[r]=this.children.find(e);if(!r&&this.statics.defaultChild){let e=this.scroll.create(this.statics.defaultChild.blotName||`block`);this.appendChild(e)}super.insertAt(e,t,n)}formats(){let e=this.statics.formats(this.domNode);return{[this.statics.blotName]:e}}checkMerge(){let{colId:e,rowId:t,colspan:n,rowspan:r}=this,i=this.next;return i!==null&&i.statics.blotName===this.statics.blotName&&i.rowId===t&&i.colId===e&&i.colspan===n&&i.rowspan===r}optimize(){let e=this.parent,t=this.statics.formats(this.domNode);if(this.prev&&this.prev instanceof wn){let e=this.prev;if(this.insertBefore(e,this.children.head),this.length()<=1){let t=this.scroll.create(`block`);this.insertBefore(t,e.next)}}let n=e!==null&&e.statics.blotName!==d.tableCell;if(n&&(this.wrap(d.tableCell,t),this.children.length===0)){let e=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(e)}this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove()),this.uiNode!=null&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length===0?this.remove():this.domNode.dataset.style&&n&&e.domNode.style.cssText!==this.domNode.dataset.style&&this.setStyleByString(this.domNode.dataset.style)}insertBefore(e,t){if(e.statics.blotName===this.statics.blotName){let n=e,r=this.statics.formats(n.domNode),i=this.statics.formats(this.domNode),a=Object.entries(i).every(([e,t])=>String(t)===String(r[e]));if(a){let e=this.split(t?t.offset():0);return this.parent.insertBefore(n,e)}else{let[e,a]=S(this,[d.tableRow,d.tableCell]);if(t){let n=t.offset(),r=this.length();if(n+1<r){let t=this.scroll.create(d.tableCellInner,i);this.children.forEachAt(n+1,this.length(),e=>{t.appendChild(e)}),e.insertBefore(t.wrap(d.tableCell,i),a.next)}}if(this.rowId!==n.rowId){if(t){let n=t.offset(e);e.split(n)}else if(a.next){let t=a.next.offset(e);e.split(t)}let i=this.scroll.create(d.tableRow,r),o=this.scroll.create(d.tableCell,r);return o.appendChild(n),i.appendChild(o),e.parent.insertBefore(i,e.next)}return e.insertBefore(n.wrap(d.tableCell,r),t?a:a.next)}}else if(e.statics.blotName===d.tableCol){try{let t=x(this,d.tableBody),n=this.offset(t),r=t.split(n);t.parent.insertBefore(e,r),e.optimize({})}catch(e){console.warn(`TableCellInner not in TableBody`)}return}super.insertBefore(e,t)}};P(q,`blotName`,d.tableCellInner),P(q,`tagName`,`div`),P(q,`className`,`ql-table-cell-inner`),P(q,`allowDataAttrs`,new Set([`table-id`,`row-id`,`col-id`,`rowspan`,`colspan`,`empty-row`])),P(q,`defaultChild`,Cn),P(q,`allowStyle`,new Set([`background-color`,`border`,`height`]));var J=class extends K{static create(e){let t=super.create();return t.dataset.tableId=e.tableId,t.dataset.rowId=e.rowId,t}get rowId(){return this.domNode.dataset.rowId}get tableId(){return this.domNode.dataset.tableId}setHeight(e){this.foreachCellInner(t=>{t.setFormatValue(`height`,e,!0)})}getCellByColId(e,t){let n=x(this,d.tableMain),r=n.getColIds(),i=r.indexOf(e),a=this.children.iterator(),o=null;for(;o=a();){if(o.colId===e)return o;let t=r.indexOf(o.colId);if(t<i&&t+o.colspan>i)return o}return this[t]&&this[t].statics.blotName===d.tableRow?this[t].getCellByColId(e,t):null}insertCell(e,t){let n=[],r=this.children.iterator(),i=0,a;for(;(a=r())&&(i+=a.colspan,!(i>e));)if(a.rowspan!==1)for(let e=0;e<a.rowspan-1;e++)n[e]=(n[e]||0)+a.colspan;if(a&&i-a.colspan<e){let e=a.getCellInner();e.colspan+=1,a.rowspan!==1&&(n.skipRowNum=a.rowspan-1)}else{let e=this.scroll.create(d.tableCell,t),n=this.scroll.create(d.tableCellInner,t),r=this.scroll.create(`block`);r.appendChild(this.scroll.create(`break`)),n.appendChild(r),e.appendChild(n),this.insertBefore(e,a)}return n}getCellByColumIndex(e){let t=[],n=null,r=0;if(e<0)return[n,r,t];let i=this.children.iterator();for(;n=i();){if(r+=n.colspan,n.rowspan!==1)for(let e=0;e<n.rowspan-1;e++)t[e]=(t[e]||0)+n.colspan;if(r>e)break}return[n,r,t]}removeCell(e){if(e<0)return[];let t=this.getCellByColumIndex(e),[n,r]=t,i=t[2];if(!n)return i;if(r-n.colspan<e||n.colspan>1){let[t]=n.descendants(q);if(n.colspan!==1&&e===r-n.colspan){let e=x(this,d.tableMain),n=e.getColIds();t.colId=n[n.indexOf(t.colId)+1]}n.rowspan!==1&&(i.skipRowNum=n.rowspan-1),--t.colspan}else n.remove();return i}foreachCellInner(e){let t=this.children.iterator(),n=0,r;for(;r=t();){let[t]=r.descendants(q);if(e(t,n++))break}}checkMerge(){let e=this.next;return e!==null&&e.statics.blotName===this.statics.blotName&&e.rowId===this.rowId}optimize(e){let t=this.parent,{tableId:n}=this;t!==null&&t.statics.blotName!==d.tableBody&&this.wrap(d.tableBody,n),this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName),this.enforceAllowedChildren(),this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};P(J,`blotName`,d.tableRow),P(J,`tagName`,`tr`),P(J,`className`,`ql-table-row`);var Tn=class extends K{static create(e){let t=super.create();return t.dataset.tableId=e,t}get tableId(){return this.domNode.dataset.tableId}insertRow(e){let t=x(this,d.tableMain);if(!t)return;let n=t.getColIds(),r=this.descendants(J),i=new Set(n),a=0;for(let t of r){if(a===e)break;t.foreachCellInner(t=>{if(a+t.rowspan>e&&(t.rowspan+=1,i.delete(t.colId),t.colspan!==1)){let e=n.indexOf(t.colId);for(let r=0;r<t.colspan-1;r++)i.delete(n[e+r+1])}}),a+=1}let o=t.tableId,s=G(),c=this.scroll.create(d.tableRow,{tableId:o,rowId:s});for(let e of i){let t=this.scroll.create(`break`),n=t.wrap(`block`),r=n.wrap(d.tableCellInner,{tableId:o,rowId:s,colId:e,rowspan:1,colspan:1}),i=r.wrap(d.tableCell,{tableId:o,rowId:s,colId:e,rowspan:1,colspan:1});c.appendChild(i)}this.insertBefore(c,r[e]||null)}checkMerge(){let e=this.next;return e!==null&&e.statics.blotName===this.statics.blotName&&e.tableId===this.tableId}optimize(e){let t=this.parent;if(t!==null&&t.statics.blotName!==d.tableMain){let{tableId:e}=this;this.wrap(d.tableMain,{tableId:e})}super.optimize(e)}};P(Tn,`blotName`,d.tableBody),P(Tn,`tagName`,`tbody`);let En=t.default.import(`parchment`),Dn=t.default.import(`blots/block`),On=t.default.import(`blots/container`);var kn=class extends Dn{replaceWith(e,t){let n=A(e)?this.scroll.create(e,t):e;if(n instanceof En.ParentBlot)if(n.statics.blotName===d.tableCellInner){let e=this.parent;if(e.statics.blotName===d.tableCellInner){if(e!=null&&e.insertBefore(n,this.prev?null:this.next),e.statics.blotName===d.tableCellInner){let e=this;for(;e;){let t=e.next;n.appendChild(e),e=t}}else n.appendChild(this);if(e&&e.length()===0){e.remove(),e.parent.statics.blotName===d.tableCell&&e.parent.length()===0&&e.parent.remove();let t=e.parent.parent;t.statics.blotName===d.tableRow&&t.children.length===0&&t.remove()}}else e instanceof On?e.parent.insertBefore(n,e):e!=null&&e.insertBefore(n,this.next),n.appendChild(this);return n}else this.moveChildren(n);return this.parent!=null&&(this.parent.insertBefore(n,this.next),this.remove()),this.attributes.copy(n),n}format(e,t){if(e===d.tableCellInner&&this.parent.statics.blotName===e&&!t)try{let e=x(this,d.tableCellInner);e.unwrap()}catch(e){console.error(`unwrap TableCellInner error`)}else super.format(e,t)}},Y=(e=>(e[e.TYPE=3]=`TYPE`,e[e.LEVEL=12]=`LEVEL`,e[e.ATTRIBUTE=13]=`ATTRIBUTE`,e[e.BLOT=14]=`BLOT`,e[e.INLINE=7]=`INLINE`,e[e.BLOCK=11]=`BLOCK`,e[e.BLOCK_BLOT=10]=`BLOCK_BLOT`,e[e.INLINE_BLOT=6]=`INLINE_BLOT`,e[e.BLOCK_ATTRIBUTE=9]=`BLOCK_ATTRIBUTE`,e[e.INLINE_ATTRIBUTE=5]=`INLINE_ATTRIBUTE`,e[e.ANY=15]=`ANY`,e))(Y||{}),An=class{constructor(e,t,n={}){this.attrName=e,this.keyName=t;let r=Y.TYPE&Y.ATTRIBUTE;this.scope=n.scope==null?Y.ATTRIBUTE:n.scope&Y.LEVEL|r,n.whitelist!=null&&(this.whitelist=n.whitelist)}static keys(e){return Array.from(e.attributes).map(e=>e.name)}add(e,t){return this.canAdd(e,t)?(e.setAttribute(this.keyName,t),!0):!1}canAdd(e,t){return this.whitelist==null?!0:typeof t==`string`?this.whitelist.indexOf(t.replace(/["']/g,``))>-1:this.whitelist.indexOf(t)>-1}remove(e){e.removeAttribute(this.keyName)}value(e){let t=e.getAttribute(this.keyName);return this.canAdd(e,t)&&t?t:``}},jn=class extends Error{constructor(e){e=`[Parchment] `+e,super(e),this.message=e,this.name=this.constructor.name}};let Mn=class e{constructor(){this.attributes={},this.classes={},this.tags={},this.types={}}static find(e,t=!1){if(e==null)return null;if(this.blots.has(e))return this.blots.get(e)||null;if(t){let n=null;try{n=e.parentNode}catch(e){return null}return this.find(n,t)}return null}create(t,n,r){let i=this.query(n);if(i==null)throw new jn(`Unable to create ${n} blot`);let a=i,o=n instanceof Node||n.nodeType===Node.TEXT_NODE?n:a.create(r),s=new a(t,o,r);return e.blots.set(s.domNode,s),s}find(t,n=!1){return e.find(t,n)}query(e,t=Y.ANY){let n;return typeof e==`string`?n=this.types[e]||this.attributes[e]:e instanceof Text||e.nodeType===Node.TEXT_NODE?n=this.types.text:typeof e==`number`?e&Y.LEVEL&Y.BLOCK?n=this.types.block:e&Y.LEVEL&Y.INLINE&&(n=this.types.inline):e instanceof Element&&((e.getAttribute(`class`)||``).split(/\s+/).some(e=>(n=this.classes[e],!!n)),n=n||this.tags[e.tagName]),n==null?null:`scope`in n&&t&Y.LEVEL&n.scope&&t&Y.TYPE&n.scope?n:null}register(...e){return e.map(e=>{let t=`blotName`in e,n=`attrName`in e;if(!t&&!n)throw new jn(`Invalid definition`);if(t&&e.blotName===`abstract`)throw new jn(`Cannot register abstract class`);let r=t?e.blotName:n?e.attrName:void 0;return this.types[r]=e,n?typeof e.keyName==`string`&&(this.attributes[e.keyName]=e):t&&(e.className&&(this.classes[e.className]=e),e.tagName&&(Array.isArray(e.tagName)?e.tagName=e.tagName.map(e=>e.toUpperCase()):e.tagName=e.tagName.toUpperCase(),(Array.isArray(e.tagName)?e.tagName:[e.tagName]).forEach(t=>{(this.tags[t]==null||e.className==null)&&(this.tags[t]=e)}))),e})}};Mn.blots=new WeakMap;let Nn=Mn;function Pn(e,t){return(e.getAttribute(`class`)||``).split(/\s+/).filter(e=>e.indexOf(`${t}-`)===0)}var Fn=class extends An{static keys(e){return(e.getAttribute(`class`)||``).split(/\s+/).map(e=>e.split(`-`).slice(0,-1).join(`-`))}add(e,t){return this.canAdd(e,t)?(this.remove(e),e.classList.add(`${this.keyName}-${t}`),!0):!1}remove(e){Pn(e,this.keyName).forEach(t=>{e.classList.remove(t)}),e.classList.length===0&&e.removeAttribute(`class`)}value(e){let t=(Pn(e,this.keyName)[0]||``).slice(this.keyName.length+1);return this.canAdd(e,t)?t:``}};let In=Fn;function Ln(e){let t=e.split(`-`),n=t.slice(1).map(e=>e[0].toUpperCase()+e.slice(1)).join(``);return t[0]+n}var Rn=class extends An{static keys(e){return(e.getAttribute(`style`)||``).split(`;`).map(e=>e.split(`:`)[0].trim())}add(e,t){return this.canAdd(e,t)?(e.style[Ln(this.keyName)]=t,!0):!1}remove(e){e.style[Ln(this.keyName)]=``,e.getAttribute(`style`)||e.removeAttribute(`style`)}value(e){let t=e.style[Ln(this.keyName)];return this.canAdd(e,t)?t:``}};let zn=Rn;var Bn=class{constructor(e){this.attributes={},this.domNode=e,this.build()}attribute(e,t){t?e.add(this.domNode,t)&&(e.value(this.domNode)==null?delete this.attributes[e.attrName]:this.attributes[e.attrName]=e):(e.remove(this.domNode),delete this.attributes[e.attrName])}build(){this.attributes={};let e=Nn.find(this.domNode);if(e==null)return;let t=An.keys(this.domNode),n=In.keys(this.domNode),r=zn.keys(this.domNode);t.concat(n).concat(r).forEach(t=>{let n=e.scroll.query(t,Y.ATTRIBUTE);n instanceof An&&(this.attributes[n.attrName]=n)})}copy(e){Object.keys(this.attributes).forEach(t=>{let n=this.attributes[t].value(this.domNode);e.format(t,n)})}move(e){this.copy(e),Object.keys(this.attributes).forEach(e=>{this.attributes[e].remove(this.domNode)}),this.attributes={}}values(){return Object.keys(this.attributes).reduce((e,t)=>(e[t]=this.attributes[t].value(this.domNode),e),{})}};let Vn=Bn,Hn=class{constructor(e,t){this.scroll=e,this.domNode=t,Nn.blots.set(t,this),this.prev=null,this.next=null}static create(e){if(this.tagName==null)throw new jn(`Blot definition missing tagName`);let t,n;return Array.isArray(this.tagName)?(typeof e==`string`?(n=e.toUpperCase(),parseInt(n,10).toString()===n&&(n=parseInt(n,10))):typeof e==`number`&&(n=e),t=typeof n==`number`?document.createElement(this.tagName[n-1]):n&&this.tagName.indexOf(n)>-1?document.createElement(n):document.createElement(this.tagName[0])):t=document.createElement(this.tagName),this.className&&t.classList.add(this.className),t}get statics(){return this.constructor}attach(){}clone(){let e=this.domNode.cloneNode(!1);return this.scroll.create(e)}detach(){this.parent!=null&&this.parent.removeChild(this),Nn.blots.delete(this.domNode)}deleteAt(e,t){this.isolate(e,t).remove()}formatAt(e,t,n,r){let i=this.isolate(e,t);if(this.scroll.query(n,Y.BLOT)!=null&&r)i.wrap(n,r);else if(this.scroll.query(n,Y.ATTRIBUTE)!=null){let e=this.scroll.create(this.statics.scope);i.wrap(e),e.format(n,r)}}insertAt(e,t,n){let r=n==null?this.scroll.create(`text`,t):this.scroll.create(t,n),i=this.split(e);this.parent.insertBefore(r,i||void 0)}isolate(e,t){let n=this.split(e);if(n==null)throw Error(`Attempt to isolate at end`);return n.split(t),n}length(){return 1}offset(e=this.parent){return this.parent==null||this===e?0:this.parent.children.offset(this)+this.parent.offset(e)}optimize(e){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}remove(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}replaceWith(e,t){let n=typeof e==`string`?this.scroll.create(e,t):e;return this.parent!=null&&(this.parent.insertBefore(n,this.next||void 0),this.remove()),n}split(e,t){return e===0?this:this.next}update(e,t){}wrap(e,t){let n=typeof e==`string`?this.scroll.create(e,t):e;if(this.parent!=null&&this.parent.insertBefore(n,this.next||void 0),typeof n.appendChild!=`function`)throw new jn(`Cannot wrap ${e}`);return n.appendChild(this),n}};Hn.blotName=`abstract`;let Un=Hn,Wn=class extends Un{static value(e){return!0}index(e,t){return this.domNode===e||this.domNode.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(t,1):-1}position(e,t){let n=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return e>0&&(n+=1),[this.parent.domNode,n]}value(){return{[this.statics.blotName]:this.statics.value(this.domNode)||!0}}};Wn.scope=Y.INLINE_BLOT;let Gn=Wn,Kn=Gn;var qn=class{constructor(){this.head=null,this.tail=null,this.length=0}append(...e){if(this.insertBefore(e[0],null),e.length>1){let t=e.slice(1);this.append(...t)}}at(e){let t=this.iterator(),n=t();for(;n&&e>0;)--e,n=t();return n}contains(e){let t=this.iterator(),n=t();for(;n;){if(n===e)return!0;n=t()}return!1}indexOf(e){let t=this.iterator(),n=t(),r=0;for(;n;){if(n===e)return r;r+=1,n=t()}return-1}insertBefore(e,t){e!=null&&(this.remove(e),e.next=t,t==null?this.tail==null?(e.prev=null,this.head=this.tail=e):(this.tail.next=e,e.prev=this.tail,this.tail=e):(e.prev=t.prev,t.prev!=null&&(t.prev.next=e),t.prev=e,t===this.head&&(this.head=e)),this.length+=1)}offset(e){let t=0,n=this.head;for(;n!=null;){if(n===e)return t;t+=n.length(),n=n.next}return-1}remove(e){this.contains(e)&&(e.prev!=null&&(e.prev.next=e.next),e.next!=null&&(e.next.prev=e.prev),e===this.head&&(this.head=e.next),e===this.tail&&(this.tail=e.prev),--this.length)}iterator(e=this.head){return()=>{let t=e;return e!=null&&(e=e.next),t}}find(e,t=!1){let n=this.iterator(),r=n();for(;r;){let i=r.length();if(e<i||t&&e===i&&(r.next==null||r.next.length()!==0))return[r,e];e-=i,r=n()}return[null,0]}forEach(e){let t=this.iterator(),n=t();for(;n;)e(n),n=t()}forEachAt(e,t,n){if(t<=0)return;let[r,i]=this.find(e),a=e-i,o=this.iterator(r),s=o();for(;s&&a<e+t;){let r=s.length();e>a?n(s,e-a,Math.min(t,a+r-e)):n(s,0,Math.min(r,e+t-a)),a+=r,s=o()}}map(e){return this.reduce((t,n)=>(t.push(e(n)),t),[])}reduce(e,t){let n=this.iterator(),r=n();for(;r;)t=e(t,r),r=n();return t}};function Jn(e,t){let n=t.find(e);if(n)return n;try{return t.create(e)}catch(n){let r=t.create(Y.INLINE);return Array.from(e.childNodes).forEach(e=>{r.domNode.appendChild(e)}),e.parentNode&&e.parentNode.replaceChild(r.domNode,e),r.attach(),r}}let Yn=class e extends Un{constructor(e,t){super(e,t),this.uiNode=null,this.build()}appendChild(e){this.insertBefore(e)}attach(){super.attach(),this.children.forEach(e=>{e.attach()})}attachUI(t){this.uiNode!=null&&this.uiNode.remove(),this.uiNode=t,e.uiClass&&this.uiNode.classList.add(e.uiClass),this.uiNode.setAttribute(`contenteditable`,`false`),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}build(){this.children=new qn,Array.from(this.domNode.childNodes).filter(e=>e!==this.uiNode).reverse().forEach(e=>{try{let t=Jn(e,this.scroll);this.insertBefore(t,this.children.head||void 0)}catch(e){if(e instanceof jn)return;throw e}})}deleteAt(e,t){if(e===0&&t===this.length())return this.remove();this.children.forEachAt(e,t,(e,t,n)=>{e.deleteAt(t,n)})}descendant(t,n=0){let[r,i]=this.children.find(n);return t.blotName==null&&t(r)||t.blotName!=null&&r instanceof t?[r,i]:r instanceof e?r.descendant(t,i):[null,-1]}descendants(t,n=0,r=Number.MAX_VALUE){let i=[],a=r;return this.children.forEachAt(n,r,(n,r,o)=>{(t.blotName==null&&t(n)||t.blotName!=null&&n instanceof t)&&i.push(n),n instanceof e&&(i=i.concat(n.descendants(t,r,a))),a-=o}),i}detach(){this.children.forEach(e=>{e.detach()}),super.detach()}enforceAllowedChildren(){let t=!1;this.children.forEach(n=>{t||this.statics.allowedChildren.some(e=>n instanceof e)||(n.statics.scope===Y.BLOCK_BLOT?(n.next!=null&&this.splitAfter(n),n.prev!=null&&this.splitAfter(n.prev),n.parent.unwrap(),t=!0):n instanceof e?n.unwrap():n.remove())})}formatAt(e,t,n,r){this.children.forEachAt(e,t,(e,t,i)=>{e.formatAt(t,i,n,r)})}insertAt(e,t,n){let[r,i]=this.children.find(e);if(r)r.insertAt(i,t,n);else{let e=n==null?this.scroll.create(`text`,t):this.scroll.create(t,n);this.appendChild(e)}}insertBefore(e,t){e.parent!=null&&e.parent.children.remove(e);let n=null;this.children.insertBefore(e,t||null),e.parent=this,t!=null&&(n=t.domNode),(this.domNode.parentNode!==e.domNode||this.domNode.nextSibling!==n)&&this.domNode.insertBefore(e.domNode,n),e.attach()}length(){return this.children.reduce((e,t)=>e+t.length(),0)}moveChildren(e,t){this.children.forEach(n=>{e.insertBefore(n,t)})}optimize(e){if(super.optimize(e),this.enforceAllowedChildren(),this.uiNode!=null&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length===0)if(this.statics.defaultChild!=null){let e=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(e)}else this.remove()}path(t,n=!1){let[r,i]=this.children.find(t,n),a=[[this,t]];return r instanceof e?a.concat(r.path(i,n)):(r!=null&&a.push([r,i]),a)}removeChild(e){this.children.remove(e)}replaceWith(t,n){let r=typeof t==`string`?this.scroll.create(t,n):t;return r instanceof e&&this.moveChildren(r),super.replaceWith(r)}split(e,t=!1){if(!t){if(e===0)return this;if(e===this.length())return this.next}let n=this.clone();return this.parent&&this.parent.insertBefore(n,this.next||void 0),this.children.forEachAt(e,this.length(),(e,r,i)=>{let a=e.split(r,t);a!=null&&n.appendChild(a)}),n}splitAfter(e){let t=this.clone();for(;e.next!=null;)t.appendChild(e.next);return this.parent&&this.parent.insertBefore(t,this.next||void 0),t}unwrap(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}update(e,t){let n=[],r=[];e.forEach(e=>{e.target===this.domNode&&e.type===`childList`&&(n.push(...e.addedNodes),r.push(...e.removedNodes))}),r.forEach(e=>{if(e.parentNode!=null&&e.tagName!==`IFRAME`&&document.body.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)return;let t=this.scroll.find(e);t!=null&&(t.domNode.parentNode==null||t.domNode.parentNode===this.domNode)&&t.detach()}),n.filter(e=>e.parentNode===this.domNode&&e!==this.uiNode).sort((e,t)=>e===t?0:e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1).forEach(e=>{let t=null;e.nextSibling!=null&&(t=this.scroll.find(e.nextSibling));let n=Jn(e,this.scroll);(n.next!==t||n.next==null)&&(n.parent!=null&&n.parent.removeChild(this),this.insertBefore(n,t||void 0))}),this.enforceAllowedChildren()}};Yn.uiClass=``;let Xn=Yn,Zn=Xn;function Qn(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(e[n]!==t[n])return!1;return!0}let $n=class e extends Zn{static create(e){return super.create(e)}static formats(t,n){let r=n.query(e.blotName);if(!(r!=null&&t.tagName===r.tagName)){if(typeof this.tagName==`string`)return!0;if(Array.isArray(this.tagName))return t.tagName.toLowerCase()}}constructor(e,t){super(e,t),this.attributes=new Vn(this.domNode)}format(t,n){if(t===this.statics.blotName&&!n)this.children.forEach(t=>{t instanceof e||(t=t.wrap(e.blotName,!0)),this.attributes.copy(t)}),this.unwrap();else{let e=this.scroll.query(t,Y.INLINE);if(e==null)return;e instanceof An?this.attributes.attribute(e,n):n&&(t!==this.statics.blotName||this.formats()[t]!==n)&&this.replaceWith(t,n)}}formats(){let e=this.attributes.values(),t=this.statics.formats(this.domNode,this.scroll);return t!=null&&(e[this.statics.blotName]=t),e}formatAt(e,t,n,r){this.formats()[n]!=null||this.scroll.query(n,Y.ATTRIBUTE)?this.isolate(e,t).format(n,r):super.formatAt(e,t,n,r)}optimize(t){super.optimize(t);let n=this.formats();if(Object.keys(n).length===0)return this.unwrap();let r=this.next;r instanceof e&&r.prev===this&&Qn(n,r.formats())&&(r.moveChildren(this),r.remove())}replaceWith(e,t){let n=super.replaceWith(e,t);return this.attributes.copy(n),n}update(e,t){super.update(e,t),e.some(e=>e.target===this.domNode&&e.type===`attributes`)&&this.attributes.build()}wrap(t,n){let r=super.wrap(t,n);return r instanceof e&&this.attributes.move(r),r}};$n.allowedChildren=[$n,Kn],$n.blotName=`inline`,$n.scope=Y.INLINE_BLOT,$n.tagName=`SPAN`;let er=$n,tr=er,nr=class e extends Zn{static create(e){return super.create(e)}static formats(t,n){let r=n.query(e.blotName);if(!(r!=null&&t.tagName===r.tagName)){if(typeof this.tagName==`string`)return!0;if(Array.isArray(this.tagName))return t.tagName.toLowerCase()}}constructor(e,t){super(e,t),this.attributes=new Vn(this.domNode)}format(t,n){let r=this.scroll.query(t,Y.BLOCK);r!=null&&(r instanceof An?this.attributes.attribute(r,n):t===this.statics.blotName&&!n?this.replaceWith(e.blotName):n&&(t!==this.statics.blotName||this.formats()[t]!==n)&&this.replaceWith(t,n))}formats(){let e=this.attributes.values(),t=this.statics.formats(this.domNode,this.scroll);return t!=null&&(e[this.statics.blotName]=t),e}formatAt(e,t,n,r){this.scroll.query(n,Y.BLOCK)==null?super.formatAt(e,t,n,r):this.format(n,r)}insertAt(e,t,n){if(n==null||this.scroll.query(t,Y.INLINE)!=null)super.insertAt(e,t,n);else{let r=this.split(e);if(r!=null){let e=this.scroll.create(t,n);r.parent.insertBefore(e,r)}else throw Error(`Attempt to insertAt after block boundaries`)}}replaceWith(e,t){let n=super.replaceWith(e,t);return this.attributes.copy(n),n}update(e,t){super.update(e,t),e.some(e=>e.target===this.domNode&&e.type===`attributes`)&&this.attributes.build()}};nr.blotName=`block`,nr.scope=Y.BLOCK_BLOT,nr.tagName=`P`,nr.allowedChildren=[tr,nr,Kn];let rr=nr,ir=rr,ar=class extends Zn{checkMerge(){return this.next!==null&&this.next.statics.blotName===this.statics.blotName}deleteAt(e,t){super.deleteAt(e,t),this.enforceAllowedChildren()}formatAt(e,t,n,r){super.formatAt(e,t,n,r),this.enforceAllowedChildren()}insertAt(e,t,n){super.insertAt(e,t,n),this.enforceAllowedChildren()}optimize(e){super.optimize(e),this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};ar.blotName=`container`,ar.scope=Y.BLOCK_BLOT;let or=ar,sr=or;var cr=class extends Kn{static formats(e,t){}format(e,t){super.formatAt(0,this.length(),e,t)}formatAt(e,t,n,r){e===0&&t===this.length()?this.format(n,r):super.formatAt(e,t,n,r)}formats(){return this.statics.formats(this.domNode,this.scroll)}};let lr=cr,ur={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},dr=100,fr=class extends Zn{constructor(e,t){super(null,t),this.registry=e,this.scroll=this,this.build(),this.observer=new MutationObserver(e=>{this.update(e)}),this.observer.observe(this.domNode,ur),this.attach()}create(e,t){return this.registry.create(this,e,t)}find(e,t=!1){let n=this.registry.find(e,t);return n?n.scroll===this?n:t?this.find(n.scroll.domNode.parentNode,!0):null:null}query(e,t=Y.ANY){return this.registry.query(e,t)}register(...e){return this.registry.register(...e)}build(){this.scroll!=null&&super.build()}detach(){super.detach(),this.observer.disconnect()}deleteAt(e,t){this.update(),e===0&&t===this.length()?this.children.forEach(e=>{e.remove()}):super.deleteAt(e,t)}formatAt(e,t,n,r){this.update(),super.formatAt(e,t,n,r)}insertAt(e,t,n){this.update(),super.insertAt(e,t,n)}optimize(e=[],t={}){super.optimize(t);let n=t.mutationsMap||new WeakMap,r=Array.from(this.observer.takeRecords());for(;r.length>0;)e.push(r.pop());let i=(e,t=!0)=>{e==null||e===this||e.domNode.parentNode!=null&&(n.has(e.domNode)||n.set(e.domNode,[]),t&&i(e.parent))},a=e=>{n.has(e.domNode)&&(e instanceof Zn&&e.children.forEach(a),n.delete(e.domNode),e.optimize(t))},o=e;for(let t=0;o.length>0;t+=1){if(t>=dr)throw Error(`[Parchment] Maximum optimize iterations reached`);for(o.forEach(e=>{let t=this.find(e.target,!0);t!=null&&(t.domNode===e.target&&(e.type===`childList`?(i(this.find(e.previousSibling,!1)),Array.from(e.addedNodes).forEach(e=>{let t=this.find(e,!1);i(t,!1),t instanceof Zn&&t.children.forEach(e=>{i(e,!1)})})):e.type===`attributes`&&i(t.prev)),i(t))}),this.children.forEach(a),o=Array.from(this.observer.takeRecords()),r=o.slice();r.length>0;)e.push(r.pop())}}update(e,t={}){e=e||this.observer.takeRecords();let n=new WeakMap;e.map(e=>{let t=this.find(e.target,!0);return t==null?null:n.has(t.domNode)?(n.get(t.domNode).push(e),null):(n.set(t.domNode,[e]),t)}).forEach(e=>{e!=null&&e!==this&&n.has(e.domNode)&&e.update(n.get(e.domNode)||[],t)}),t.mutationsMap=n,n.has(this.domNode)&&super.update(n.get(this.domNode),t),this.optimize(e,t)}};fr.blotName=`scroll`,fr.defaultChild=ir,fr.allowedChildren=[ir,sr],fr.scope=Y.BLOCK_BLOT,fr.tagName=`DIV`;let pr=fr,mr=pr,hr=class e extends Kn{static create(e){return document.createTextNode(e)}static value(e){return e.data}constructor(e,t){super(e,t),this.text=this.statics.value(this.domNode)}deleteAt(e,t){this.domNode.data=this.text=this.text.slice(0,e)+this.text.slice(e+t)}index(e,t){return this.domNode===e?t:-1}insertAt(e,t,n){n==null?(this.text=this.text.slice(0,e)+t+this.text.slice(e),this.domNode.data=this.text):super.insertAt(e,t,n)}length(){return this.text.length}optimize(t){super.optimize(t),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof e&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}position(e,t=!1){return[this.domNode,e]}split(e,t=!1){if(!t){if(e===0)return this;if(e===this.length())return this.next}let n=this.scroll.create(this.domNode.splitText(e));return this.parent.insertBefore(n,this.next||void 0),this.text=this.statics.value(this.domNode),n}update(e,t){e.some(e=>e.type===`characterData`&&e.target===this.domNode)&&(this.text=this.statics.value(this.domNode))}value(){return this.text}};hr.blotName=`text`,hr.scope=Y.INLINE_BLOT;let gr=hr,_r=gr;var vr=c((exports,t)=>{var n=-1,r=1,i=0;function a(e,t,n,r,a){if(e===t)return e?[[i,e]]:[];if(n!=null){var s=D(e,t,n);if(s)return s}var c=l(e,t),u=e.substring(0,c);e=e.substring(c),t=t.substring(c),c=d(e,t);var f=e.substring(e.length-c);e=e.substring(0,e.length-c),t=t.substring(0,t.length-c);var m=o(e,t);return u&&m.unshift([i,u]),f&&m.push([i,f]),b(m,a),r&&p(m),m}function o(e,t){var o;if(!e)return[[r,t]];if(!t)return[[n,e]];var c=e.length>t.length?e:t,l=e.length>t.length?t:e,u=c.indexOf(l);if(u!==-1)return o=[[r,c.substring(0,u)],[i,l],[r,c.substring(u+l.length)]],e.length>t.length&&(o[0][0]=o[2][0]=n),o;if(l.length===1)return[[n,e],[r,t]];var d=f(e,t);if(d){var p=d[0],m=d[1],h=d[2],g=d[3],_=d[4],v=a(p,h),y=a(m,g);return v.concat([[i,_]],y)}return s(e,t)}function s(e,t){for(var i=e.length,a=t.length,o=Math.ceil((i+a)/2),s=o,l=2*o,u=Array(l),d=Array(l),f=0;f<l;f++)u[f]=-1,d[f]=-1;u[s+1]=0,d[s+1]=0;for(var p=i-a,m=p%2!=0,h=0,g=0,_=0,v=0,y=0;y<o;y++){for(var b=-y+h;b<=y-g;b+=2){var x=s+b,S;S=b===-y||b!==y&&u[x-1]<u[x+1]?u[x+1]:u[x-1]+1;for(var C=S-b;S<i&&C<a&&e.charAt(S)===t.charAt(C);)S++,C++;if(u[x]=S,S>i)g+=2;else if(C>a)h+=2;else if(m){var w=s+p-b;if(w>=0&&w<l&&d[w]!==-1){var T=i-d[w];if(S>=T)return c(e,t,S,C)}}}for(var E=-y+_;E<=y-v;E+=2){var w=s+E,T;T=E===-y||E!==y&&d[w-1]<d[w+1]?d[w+1]:d[w-1]+1;for(var D=T-E;T<i&&D<a&&e.charAt(i-T-1)===t.charAt(a-D-1);)T++,D++;if(d[w]=T,T>i)v+=2;else if(D>a)_+=2;else if(!m){var x=s+p-E;if(x>=0&&x<l&&u[x]!==-1){var S=u[x],C=s+S-x;if(T=i-T,S>=T)return c(e,t,S,C)}}}}return[[n,e],[r,t]]}function c(e,t,n,r){var i=e.substring(0,n),o=t.substring(0,r),s=e.substring(n),c=t.substring(r),l=a(i,o),u=a(s,c);return l.concat(u)}function l(e,t){if(!e||!t||e.charAt(0)!==t.charAt(0))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,a=0;n<i;)e.substring(a,i)==t.substring(a,i)?(n=i,a=n):r=i,i=Math.floor((r-n)/2+n);return x(e.charCodeAt(i-1))&&i--,i}function u(e,t){var n=e.length,r=t.length;if(n==0||r==0)return 0;n>r?e=e.substring(n-r):n<r&&(t=t.substring(0,n));var i=Math.min(n,r);if(e==t)return i;for(var a=0,o=1;;){var s=e.substring(i-o),c=t.indexOf(s);if(c==-1)return a;o+=c,(c==0||e.substring(i-o)==t.substring(0,o))&&(a=o,o++)}}function d(e,t){if(!e||!t||e.slice(-1)!==t.slice(-1))return 0;for(var n=0,r=Math.min(e.length,t.length),i=r,a=0;n<i;)e.substring(e.length-i,e.length-a)==t.substring(t.length-i,t.length-a)?(n=i,a=n):r=i,i=Math.floor((r-n)/2+n);return S(e.charCodeAt(e.length-i))&&i--,i}function f(e,t){var n=e.length>t.length?e:t,r=e.length>t.length?t:e;if(n.length<4||r.length*2<n.length)return null;function i(e,t,n){for(var r=e.substring(n,n+Math.floor(e.length/4)),i=-1,a=``,o,s,c,u;(i=t.indexOf(r,i+1))!==-1;){var f=l(e.substring(n),t.substring(i)),p=d(e.substring(0,n),t.substring(0,i));a.length<p+f&&(a=t.substring(i-p,i)+t.substring(i,i+f),o=e.substring(0,n-p),s=e.substring(n+f),c=t.substring(0,i-p),u=t.substring(i+f))}return a.length*2>=e.length?[o,s,c,u,a]:null}var a=i(n,r,Math.ceil(n.length/4)),o=i(n,r,Math.ceil(n.length/2)),s;if(!a&&!o)return null;s=o?a&&a[4].length>o[4].length?a:o:a;var c,u,f,p;e.length>t.length?(c=s[0],u=s[1],f=s[2],p=s[3]):(f=s[0],p=s[1],c=s[2],u=s[3]);var m=s[4];return[c,u,f,p,m]}function p(e){for(var t=!1,a=[],o=0,s=null,c=0,l=0,d=0,f=0,p=0;c<e.length;)e[c][0]==i?(a[o++]=c,l=f,d=p,f=0,p=0,s=e[c][1]):(e[c][0]==r?f+=e[c][1].length:p+=e[c][1].length,s&&s.length<=Math.max(l,d)&&s.length<=Math.max(f,p)&&(e.splice(a[o-1],0,[n,s]),e[a[o-1]+1][0]=r,o--,o--,c=o>0?a[o-1]:-1,l=0,d=0,f=0,p=0,s=null,t=!0)),c++;for(t&&b(e),y(e),c=1;c<e.length;){if(e[c-1][0]==n&&e[c][0]==r){var m=e[c-1][1],h=e[c][1],g=u(m,h),_=u(h,m);g>=_?(g>=m.length/2||g>=h.length/2)&&(e.splice(c,0,[i,h.substring(0,g)]),e[c-1][1]=m.substring(0,m.length-g),e[c+1][1]=h.substring(g),c++):(_>=m.length/2||_>=h.length/2)&&(e.splice(c,0,[i,m.substring(0,_)]),e[c-1][0]=r,e[c-1][1]=h.substring(0,h.length-_),e[c+1][0]=n,e[c+1][1]=m.substring(_),c++),c++}c++}}var m=/[^a-zA-Z0-9]/,h=/\s/,g=/[\r\n]/,_=/\n\r?\n$/,v=/^\r?\n\r?\n/;function y(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),r=t.charAt(0),i=n.match(m),a=r.match(m),o=i&&n.match(h),s=a&&r.match(h),c=o&&n.match(g),l=s&&r.match(g),u=c&&e.match(_),d=l&&t.match(v);return u||d?5:c||l?4:i&&!o&&s?3:o||s?2:i||a?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==i&&e[n+1][0]==i){var r=e[n-1][1],a=e[n][1],o=e[n+1][1],s=d(r,a);if(s){var c=a.substring(a.length-s);r=r.substring(0,r.length-s),a=c+a.substring(0,a.length-s),o=c+o}for(var l=r,u=a,f=o,p=t(r,a)+t(a,o);a.charAt(0)===o.charAt(0);){r+=a.charAt(0),a=a.substring(1)+o.charAt(0),o=o.substring(1);var y=t(r,a)+t(a,o);y>=p&&(p=y,l=r,u=a,f=o)}e[n-1][1]!=l&&(l?e[n-1][1]=l:(e.splice(n-1,1),n--),e[n][1]=u,f?e[n+1][1]=f:(e.splice(n+1,1),n--))}n++}}function b(e,t){e.push([i,``]);for(var a=0,o=0,s=0,c=``,u=``,f;a<e.length;){if(a<e.length-1&&!e[a][1]){e.splice(a,1);continue}switch(e[a][0]){case r:s++,u+=e[a][1],a++;break;case n:o++,c+=e[a][1],a++;break;case i:var p=a-s-o-1;if(t){if(p>=0&&w(e[p][1])){var m=e[p][1].slice(-1);if(e[p][1]=e[p][1].slice(0,-1),c=m+c,u=m+u,!e[p][1]){e.splice(p,1),a--;var h=p-1;e[h]&&e[h][0]===r&&(s++,u=e[h][1]+u,h--),e[h]&&e[h][0]===n&&(o++,c=e[h][1]+c,h--),p=h}}if(C(e[a][1])){var m=e[a][1].charAt(0);e[a][1]=e[a][1].slice(1),c+=m,u+=m}}if(a<e.length-1&&!e[a][1]){e.splice(a,1);break}if(c.length>0||u.length>0){c.length>0&&u.length>0&&(f=l(u,c),f!==0&&(p>=0?e[p][1]+=u.substring(0,f):(e.splice(0,0,[i,u.substring(0,f)]),a++),u=u.substring(f),c=c.substring(f)),f=d(u,c),f!==0&&(e[a][1]=u.substring(u.length-f)+e[a][1],u=u.substring(0,u.length-f),c=c.substring(0,c.length-f)));var g=s+o;c.length===0&&u.length===0?(e.splice(a-g,g),a-=g):c.length===0?(e.splice(a-g,g,[r,u]),a=a-g+1):u.length===0?(e.splice(a-g,g,[n,c]),a=a-g+1):(e.splice(a-g,g,[n,c],[r,u]),a=a-g+2)}a!==0&&e[a-1][0]===i?(e[a-1][1]+=e[a][1],e.splice(a,1)):a++,s=0,o=0,c=``,u=``;break}}e[e.length-1][1]===``&&e.pop();var _=!1;for(a=1;a<e.length-1;)e[a-1][0]===i&&e[a+1][0]===i&&(e[a][1].substring(e[a][1].length-e[a-1][1].length)===e[a-1][1]?(e[a][1]=e[a-1][1]+e[a][1].substring(0,e[a][1].length-e[a-1][1].length),e[a+1][1]=e[a-1][1]+e[a+1][1],e.splice(a-1,1),_=!0):e[a][1].substring(0,e[a+1][1].length)==e[a+1][1]&&(e[a-1][1]+=e[a+1][1],e[a][1]=e[a][1].substring(e[a+1][1].length)+e[a+1][1],e.splice(a+1,1),_=!0)),a++;_&&b(e,t)}function x(e){return e>=55296&&e<=56319}function S(e){return e>=56320&&e<=57343}function C(e){return S(e.charCodeAt(0))}function w(e){return x(e.charCodeAt(e.length-1))}function T(e){for(var t=[],n=0;n<e.length;n++)e[n][1].length>0&&t.push(e[n]);return t}function E(e,t,a,o){return w(e)||C(o)?null:T([[i,e],[n,t],[r,a],[i,o]])}function D(e,t,n){var r=typeof n==`number`?{index:n,length:0}:n.oldRange,i=typeof n==`number`?null:n.newRange,a=e.length,o=t.length;if(r.length===0&&(i===null||i.length===0)){var s=r.index,c=e.slice(0,s),l=e.slice(s),u=i?i.index:null;editBefore:{var d=s+o-a;if(u!==null&&u!==d||d<0||d>o)break editBefore;var f=t.slice(0,d),p=t.slice(d);if(p!==l)break editBefore;var m=Math.min(s,d),h=c.slice(0,m),g=f.slice(0,m);if(h!==g)break editBefore;var _=c.slice(m),v=f.slice(m);return E(h,_,v,l)}editAfter:{if(u!==null&&u!==s)break editAfter;var y=s,f=t.slice(0,y),p=t.slice(y);if(f!==c)break editAfter;var b=Math.min(a-y,o-y),x=l.slice(l.length-b),S=p.slice(p.length-b);if(x!==S)break editAfter;var _=l.slice(0,l.length-b),v=p.slice(0,p.length-b);return E(c,_,v,x)}}if(r.length>0&&i&&i.length===0)replaceRange:{var h=e.slice(0,r.index),x=e.slice(r.index+r.length),m=h.length,b=x.length;if(o<m+b)break replaceRange;var g=t.slice(0,m),S=t.slice(o-b);if(h!==g||x!==S)break replaceRange;var _=e.slice(m,a-b),v=t.slice(m,o-b);return E(h,_,v,x)}return null}function O(e,t,n,r){return a(e,t,n,r,!0)}O.INSERT=r,O.DELETE=n,O.EQUAL=i,t.exports=O}),yr=c((exports,t)=>{var n=200,r=`__lodash_hash_undefined__`,i=9007199254740991,a=`[object Arguments]`,o=`[object Array]`,s=`[object Boolean]`,c=`[object Date]`,l=`[object Error]`,u=`[object Function]`,d=`[object GeneratorFunction]`,f=`[object Map]`,p=`[object Number]`,m=`[object Object]`,h=`[object Promise]`,g=`[object RegExp]`,_=`[object Set]`,v=`[object String]`,y=`[object Symbol]`,b=`[object WeakMap]`,x=`[object ArrayBuffer]`,S=`[object DataView]`,C=`[object Float32Array]`,w=`[object Float64Array]`,T=`[object Int8Array]`,E=`[object Int16Array]`,D=`[object Int32Array]`,O=`[object Uint8Array]`,ee=`[object Uint8ClampedArray]`,te=`[object Uint16Array]`,ne=`[object Uint32Array]`,re=/[\\^$.*+?()[\]{}|]/g,ie=/\w*$/,ae=/^\[object .+?Constructor\]$/,oe=/^(?:0|[1-9]\d*)$/,k={};k[a]=k[o]=k[x]=k[S]=k[s]=k[c]=k[C]=k[w]=k[T]=k[E]=k[D]=k[f]=k[p]=k[m]=k[g]=k[_]=k[v]=k[y]=k[O]=k[ee]=k[te]=k[ne]=!0,k[l]=k[u]=k[b]=!1;var A=typeof global==`object`&&global&&global.Object===Object&&global,se=typeof self==`object`&&self&&self.Object===Object&&self,j=A||se||Function(`return this`)(),ce=typeof exports==`object`&&exports&&!exports.nodeType&&exports,M=ce&&typeof t==`object`&&t&&!t.nodeType&&t,le=M&&M.exports===ce;function ue(e,t){return e.set(t[0],t[1]),e}function de(e,t){return e.add(t),e}function fe(e,t){for(var n=-1,r=e?e.length:0;++n<r&&t(e[n],n,e)!==!1;);return e}function pe(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function N(e,t,n,r){var i=-1,a=e?e.length:0;for(r&&a&&(n=e[++i]);++i<a;)n=t(n,e[i],i,e);return n}function me(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function he(e,t){return e==null?void 0:e[t]}function ge(e){var t=!1;if(e!=null&&typeof e.toString!=`function`)try{t=!!(e+``)}catch(e){}return t}function _e(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function ve(e,t){return function(n){return e(t(n))}}function ye(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var P=Array.prototype,be=Function.prototype,F=Object.prototype,xe=j[`__core-js_shared__`],Se=function(){var e=/[^.]+$/.exec(xe&&xe.keys&&xe.keys.IE_PROTO||``);return e?`Symbol(src)_1.`+e:``}(),Ce=be.toString,we=F.hasOwnProperty,I=F.toString,Te=RegExp(`^`+Ce.call(we).replace(re,`\\$&`).replace(RegExp(`hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])`,`g`),`$1.*?`)+`$`),Ee=le?j.Buffer:void 0,De=j.Symbol,Oe=j.Uint8Array,L=ve(Object.getPrototypeOf,Object),ke=Object.create,Ae=F.propertyIsEnumerable,je=P.splice,Me=Object.getOwnPropertySymbols,Ne=Ee?Ee.isBuffer:void 0,Pe=ve(Object.keys,Object),Fe=Ft(j,`DataView`),Ie=Ft(j,`Map`),Le=Ft(j,`Promise`),Re=Ft(j,`Set`),ze=Ft(j,`WeakMap`),Be=Ft(Object,`create`),Ve=W(Fe),He=W(Ie),Ue=W(Le),R=W(Re),We=W(ze),Ge=De?De.prototype:void 0,Ke=Ge?Ge.valueOf:void 0;function qe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Je(){this.__data__=Be?Be(null):{}}function Ye(e){return this.has(e)&&delete this.__data__[e]}function Xe(e){var t=this.__data__;if(Be){var n=t[e];return n===r?void 0:n}return we.call(t,e)?t[e]:void 0}function Ze(e){var t=this.__data__;return Be?t[e]!==void 0:we.call(t,e)}function Qe(e,t){var n=this.__data__;return n[e]=Be&&t===void 0?r:t,this}qe.prototype.clear=Je,qe.prototype.delete=Ye,qe.prototype.get=Xe,qe.prototype.has=Ze,qe.prototype.set=Qe;function z(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function $e(){this.__data__=[]}function et(e){var t=this.__data__,n=ht(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():je.call(t,n,1),!0}function tt(e){var t=this.__data__,n=ht(t,e);return n<0?void 0:t[n][1]}function nt(e){return ht(this.__data__,e)>-1}function rt(e,t){var n=this.__data__,r=ht(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}z.prototype.clear=$e,z.prototype.delete=et,z.prototype.get=tt,z.prototype.has=nt,z.prototype.set=rt;function B(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function it(){this.__data__={hash:new qe,map:new(Ie||z),string:new qe}}function V(e){return Pt(this,e).delete(e)}function at(e){return Pt(this,e).get(e)}function ot(e){return Pt(this,e).has(e)}function st(e,t){return Pt(this,e).set(e,t),this}B.prototype.clear=it,B.prototype.delete=V,B.prototype.get=at,B.prototype.has=ot,B.prototype.set=st;function H(e){this.__data__=new z(e)}function ct(){this.__data__=new z}function lt(e){return this.__data__.delete(e)}function ut(e){return this.__data__.get(e)}function dt(e){return this.__data__.has(e)}function ft(e,t){var r=this.__data__;if(r instanceof z){var i=r.__data__;if(!Ie||i.length<n-1)return i.push([e,t]),this;r=this.__data__=new B(i)}return r.set(e,t),this}H.prototype.clear=ct,H.prototype.delete=lt,H.prototype.get=ut,H.prototype.has=dt,H.prototype.set=ft;function pt(e,t){var n=Jt(e)||qt(e)?me(e.length,String):[],r=n.length,i=!!r;for(var a in e)(t||we.call(e,a))&&!(i&&(a==`length`||Vt(a,r)))&&n.push(a);return n}function mt(e,t,n){var r=e[t];(!(we.call(e,t)&&Kt(r,n))||n===void 0&&!(t in e))&&(e[t]=n)}function ht(e,t){for(var n=e.length;n--;)if(Kt(e[n][0],t))return n;return-1}function U(e,t){return e&&jt(t,nn(t),e)}function gt(e,t,n,r,i,o,s){var c;if(r&&(c=o?r(e,i,o,s):r(e)),c!==void 0)return c;if(!en(e))return e;var l=Jt(e);if(l){if(c=Rt(e),!t)return At(e,c)}else{var f=Lt(e),p=f==u||f==d;if(Zt(e))return St(e,t);if(f==m||f==a||p&&!o){if(ge(e))return o?e:{};if(c=zt(p?{}:e),!t)return Mt(e,U(c,e))}else{if(!k[f])return o?e:{};c=Bt(e,f,gt,t)}}s||(s=new H);var h=s.get(e);if(h)return h;if(s.set(e,c),!l)var g=n?Nt(e):nn(e);return fe(g||e,function(i,a){g&&(a=i,i=e[a]),mt(c,a,gt(i,t,n,r,a,e,s))}),c}function _t(e){return en(e)?ke(e):{}}function vt(e,t,n){var r=t(e);return Jt(e)?r:pe(r,n(e))}function yt(e){return I.call(e)}function bt(e){if(!en(e)||Ut(e))return!1;var t=Qt(e)||ge(e)?Te:ae;return t.test(W(e))}function xt(e){if(!Wt(e))return Pe(e);var t=[];for(var n in Object(e))we.call(e,n)&&n!=`constructor`&&t.push(n);return t}function St(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}function Ct(e){var t=new e.constructor(e.byteLength);return new Oe(t).set(new Oe(e)),t}function wt(e,t){var n=t?Ct(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Tt(e,t,n){var r=t?n(_e(e),!0):_e(e);return N(r,ue,new e.constructor)}function Et(e){var t=new e.constructor(e.source,ie.exec(e));return t.lastIndex=e.lastIndex,t}function Dt(e,t,n){var r=t?n(ye(e),!0):ye(e);return N(r,de,new e.constructor)}function Ot(e){return Ke?Object(Ke.call(e)):{}}function kt(e,t){var n=t?Ct(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function At(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}function jt(e,t,n,r){n||(n={});for(var i=-1,a=t.length;++i<a;){var o=t[i],s=r?r(n[o],e[o],o,n,e):void 0;mt(n,o,s===void 0?e[o]:s)}return n}function Mt(e,t){return jt(e,It(e),t)}function Nt(e){return vt(e,nn,It)}function Pt(e,t){var n=e.__data__;return Ht(t)?n[typeof t==`string`?`string`:`hash`]:n.map}function Ft(e,t){var n=he(e,t);return bt(n)?n:void 0}var It=Me?ve(Me,Object):rn,Lt=yt;(Fe&&Lt(new Fe(new ArrayBuffer(1)))!=S||Ie&&Lt(new Ie)!=f||Le&&Lt(Le.resolve())!=h||Re&&Lt(new Re)!=_||ze&&Lt(new ze)!=b)&&(Lt=function(e){var t=I.call(e),n=t==m?e.constructor:void 0,r=n?W(n):void 0;if(r)switch(r){case Ve:return S;case He:return f;case Ue:return h;case R:return _;case We:return b}return t});function Rt(e){var t=e.length,n=e.constructor(t);return t&&typeof e[0]==`string`&&we.call(e,`index`)&&(n.index=e.index,n.input=e.input),n}function zt(e){return typeof e.constructor==`function`&&!Wt(e)?_t(L(e)):{}}function Bt(e,t,n,r){var i=e.constructor;switch(t){case x:return Ct(e);case s:case c:return new i(+e);case S:return wt(e,r);case C:case w:case T:case E:case D:case O:case ee:case te:case ne:return kt(e,r);case f:return Tt(e,r,n);case p:case v:return new i(e);case g:return Et(e);case _:return Dt(e,r,n);case y:return Ot(e)}}function Vt(e,t){return t=t==null?i:t,!!t&&(typeof e==`number`||oe.test(e))&&e>-1&&e%1==0&&e<t}function Ht(e){var t=typeof e;return t==`string`||t==`number`||t==`symbol`||t==`boolean`?e!==`__proto__`:e===null}function Ut(e){return!!Se&&Se in e}function Wt(e){var t=e&&e.constructor,n=typeof t==`function`&&t.prototype||F;return e===n}function W(e){if(e!=null){try{return Ce.call(e)}catch(e){}try{return e+``}catch(e){}}return``}function Gt(e){return gt(e,!0,!0)}function Kt(e,t){return e===t||e!==e&&t!==t}function qt(e){return Xt(e)&&we.call(e,`callee`)&&(!Ae.call(e,`callee`)||I.call(e)==a)}var Jt=Array.isArray;function Yt(e){return e!=null&&$t(e.length)&&!Qt(e)}function Xt(e){return tn(e)&&Yt(e)}var Zt=Ne||an;function Qt(e){var t=en(e)?I.call(e):``;return t==u||t==d}function $t(e){return typeof e==`number`&&e>-1&&e%1==0&&e<=i}function en(e){var t=typeof e;return!!e&&(t==`object`||t==`function`)}function tn(e){return!!e&&typeof e==`object`}function nn(e){return Yt(e)?pt(e):xt(e)}function rn(){return[]}function an(){return!1}t.exports=Gt}),br=c((exports,t)=>{var n=200,r=`__lodash_hash_undefined__`,i=1,a=2,o=9007199254740991,s=`[object Arguments]`,c=`[object Array]`,l=`[object AsyncFunction]`,u=`[object Boolean]`,d=`[object Date]`,f=`[object Error]`,p=`[object Function]`,m=`[object GeneratorFunction]`,h=`[object Map]`,g=`[object Number]`,_=`[object Null]`,v=`[object Object]`,y=`[object Promise]`,b=`[object Proxy]`,x=`[object RegExp]`,S=`[object Set]`,C=`[object String]`,w=`[object Symbol]`,T=`[object Undefined]`,E=`[object WeakMap]`,D=`[object ArrayBuffer]`,O=`[object DataView]`,ee=`[object Float32Array]`,te=`[object Float64Array]`,ne=`[object Int8Array]`,re=`[object Int16Array]`,ie=`[object Int32Array]`,ae=`[object Uint8Array]`,oe=`[object Uint8ClampedArray]`,k=`[object Uint16Array]`,A=`[object Uint32Array]`,se=/[\\^$.*+?()[\]{}|]/g,j=/^\[object .+?Constructor\]$/,ce=/^(?:0|[1-9]\d*)$/,M={};M[ee]=M[te]=M[ne]=M[re]=M[ie]=M[ae]=M[oe]=M[k]=M[A]=!0,M[s]=M[c]=M[D]=M[u]=M[O]=M[d]=M[f]=M[p]=M[h]=M[g]=M[v]=M[x]=M[S]=M[C]=M[E]=!1;var le=typeof global==`object`&&global&&global.Object===Object&&global,ue=typeof self==`object`&&self&&self.Object===Object&&self,de=le||ue||Function(`return this`)(),fe=typeof exports==`object`&&exports&&!exports.nodeType&&exports,pe=fe&&typeof t==`object`&&t&&!t.nodeType&&t,N=pe&&pe.exports===fe,me=N&&le.process,he=function(){try{return me&&me.binding&&me.binding(`util`)}catch(e){}}(),ge=he&&he.isTypedArray;function _e(e,t){for(var n=-1,r=e==null?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}function ve(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function ye(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function P(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function be(e){return function(t){return e(t)}}function F(e,t){return e.has(t)}function xe(e,t){return e==null?void 0:e[t]}function Se(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function Ce(e,t){return function(n){return e(t(n))}}function we(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var I=Array.prototype,Te=Function.prototype,Ee=Object.prototype,De=de[`__core-js_shared__`],Oe=Te.toString,L=Ee.hasOwnProperty,ke=function(){var e=/[^.]+$/.exec(De&&De.keys&&De.keys.IE_PROTO||``);return e?`Symbol(src)_1.`+e:``}(),Ae=Ee.toString,je=RegExp(`^`+Oe.call(L).replace(se,`\\$&`).replace(RegExp(`hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])`,`g`),`$1.*?`)+`$`),Me=N?de.Buffer:void 0,Ne=de.Symbol,Pe=de.Uint8Array,Fe=Ee.propertyIsEnumerable,Ie=I.splice,Le=Ne?Ne.toStringTag:void 0,Re=Object.getOwnPropertySymbols,ze=Me?Me.isBuffer:void 0,Be=Ce(Object.keys,Object),Ve=It(de,`DataView`),He=It(de,`Map`),Ue=It(de,`Promise`),R=It(de,`Set`),We=It(de,`WeakMap`),Ge=It(Object,`create`),Ke=W(Ve),qe=W(He),Je=W(Ue),Ye=W(R),Xe=W(We),Ze=Ne?Ne.prototype:void 0,Qe=Ze?Ze.valueOf:void 0;function z(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function $e(){this.__data__=Ge?Ge(null):{},this.size=0}function et(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function tt(e){var t=this.__data__;if(Ge){var n=t[e];return n===r?void 0:n}return L.call(t,e)?t[e]:void 0}function nt(e){var t=this.__data__;return Ge?t[e]!==void 0:L.call(t,e)}function rt(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ge&&t===void 0?r:t,this}z.prototype.clear=$e,z.prototype.delete=et,z.prototype.get=tt,z.prototype.has=nt,z.prototype.set=rt;function B(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function it(){this.__data__=[],this.size=0}function V(e){var t=this.__data__,n=St(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():Ie.call(t,n,1),--this.size,!0}function at(e){var t=this.__data__,n=St(t,e);return n<0?void 0:t[n][1]}function ot(e){return St(this.__data__,e)>-1}function st(e,t){var n=this.__data__,r=St(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}B.prototype.clear=it,B.prototype.delete=V,B.prototype.get=at,B.prototype.has=ot,B.prototype.set=st;function H(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ct(){this.size=0,this.__data__={hash:new z,map:new(He||B),string:new z}}function lt(e){var t=Ft(this,e).delete(e);return this.size-=t?1:0,t}function ut(e){return Ft(this,e).get(e)}function dt(e){return Ft(this,e).has(e)}function ft(e,t){var n=Ft(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}H.prototype.clear=ct,H.prototype.delete=lt,H.prototype.get=ut,H.prototype.has=dt,H.prototype.set=ft;function pt(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new H;++t<n;)this.add(e[t])}function mt(e){return this.__data__.set(e,r),this}function ht(e){return this.__data__.has(e)}pt.prototype.add=pt.prototype.push=mt,pt.prototype.has=ht;function U(e){var t=this.__data__=new B(e);this.size=t.size}function gt(){this.__data__=new B,this.size=0}function _t(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function vt(e){return this.__data__.get(e)}function yt(e){return this.__data__.has(e)}function bt(e,t){var r=this.__data__;if(r instanceof B){var i=r.__data__;if(!He||i.length<n-1)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new H(i)}return r.set(e,t),this.size=r.size,this}U.prototype.clear=gt,U.prototype.delete=_t,U.prototype.get=vt,U.prototype.has=yt,U.prototype.set=bt;function xt(e,t){var n=qt(e),r=!n&&Kt(e),i=!n&&!r&&Yt(e),a=!n&&!r&&!i&&tn(e),o=n||r||i||a,s=o?P(e.length,String):[],c=s.length;for(var l in e)(t||L.call(e,l))&&!(o&&(l==`length`||i&&(l==`offset`||l==`parent`)||a&&(l==`buffer`||l==`byteLength`||l==`byteOffset`)||Bt(l,c)))&&s.push(l);return s}function St(e,t){for(var n=e.length;n--;)if(Gt(e[n][0],t))return n;return-1}function Ct(e,t,n){var r=t(e);return qt(e)?r:ve(r,n(e))}function wt(e){return e==null?e===void 0?T:_:Le&&Le in Object(e)?Lt(e):Wt(e)}function Tt(e){return en(e)&&wt(e)==s}function Et(e,t,n,r,i){return e===t?!0:e==null||t==null||!en(e)&&!en(t)?e!==e&&t!==t:Dt(e,t,n,r,Et,i)}function Dt(e,t,n,r,a,o){var l=qt(e),u=qt(t),d=l?c:zt(e),f=u?c:zt(t);d=d==s?v:d,f=f==s?v:f;var p=d==v,m=f==v,h=d==f;if(h&&Yt(e)){if(!Yt(t))return!1;l=!0,p=!1}if(h&&!p)return o||(o=new U),l||tn(e)?jt(e,t,n,r,a,o):Mt(e,t,d,n,r,a,o);if(!(n&i)){var g=p&&L.call(e,`__wrapped__`),_=m&&L.call(t,`__wrapped__`);if(g||_){var y=g?e.value():e,b=_?t.value():t;return o||(o=new U),a(y,b,n,r,o)}}return h?(o||(o=new U),Nt(e,t,n,r,a,o)):!1}function Ot(e){if(!$t(e)||Ht(e))return!1;var t=Zt(e)?je:j;return t.test(W(e))}function kt(e){return en(e)&&Qt(e.length)&&!!M[wt(e)]}function At(e){if(!Ut(e))return Be(e);var t=[];for(var n in Object(e))L.call(e,n)&&n!=`constructor`&&t.push(n);return t}function jt(e,t,n,r,o,s){var c=n&i,l=e.length,u=t.length;if(l!=u&&!(c&&u>l))return!1;var d=s.get(e);if(d&&s.get(t))return d==t;var f=-1,p=!0,m=n&a?new pt:void 0;for(s.set(e,t),s.set(t,e);++f<l;){var h=e[f],g=t[f];if(r)var _=c?r(g,h,f,t,e,s):r(h,g,f,e,t,s);if(_!==void 0){if(_)continue;p=!1;break}if(m){if(!ye(t,function(e,t){if(!F(m,t)&&(h===e||o(h,e,n,r,s)))return m.push(t)})){p=!1;break}}else if(!(h===g||o(h,g,n,r,s))){p=!1;break}}return s.delete(e),s.delete(t),p}function Mt(e,t,n,r,o,s,c){switch(n){case O:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case D:return!(e.byteLength!=t.byteLength||!s(new Pe(e),new Pe(t)));case u:case d:case g:return Gt(+e,+t);case f:return e.name==t.name&&e.message==t.message;case x:case C:return e==t+``;case h:var l=Se;case S:var p=r&i;if(l||(l=we),e.size!=t.size&&!p)return!1;var m=c.get(e);if(m)return m==t;r|=a,c.set(e,t);var _=jt(l(e),l(t),r,o,s,c);return c.delete(e),_;case w:if(Qe)return Qe.call(e)==Qe.call(t)}return!1}function Nt(e,t,n,r,a,o){var s=n&i,c=Pt(e),l=c.length,u=Pt(t),d=u.length;if(l!=d&&!s)return!1;for(var f=l;f--;){var p=c[f];if(!(s?p in t:L.call(t,p)))return!1}var m=o.get(e);if(m&&o.get(t))return m==t;var h=!0;o.set(e,t),o.set(t,e);for(var g=s;++f<l;){p=c[f];var _=e[p],v=t[p];if(r)var y=s?r(v,_,p,t,e,o):r(_,v,p,e,t,o);if(!(y===void 0?_===v||a(_,v,n,r,o):y)){h=!1;break}g||(g=p==`constructor`)}if(h&&!g){var b=e.constructor,x=t.constructor;b!=x&&`constructor`in e&&`constructor`in t&&!(typeof b==`function`&&b instanceof b&&typeof x==`function`&&x instanceof x)&&(h=!1)}return o.delete(e),o.delete(t),h}function Pt(e){return Ct(e,nn,Rt)}function Ft(e,t){var n=e.__data__;return Vt(t)?n[typeof t==`string`?`string`:`hash`]:n.map}function It(e,t){var n=xe(e,t);return Ot(n)?n:void 0}function Lt(e){var t=L.call(e,Le),n=e[Le];try{e[Le]=void 0;var r=!0}catch(e){}var i=Ae.call(e);return r&&(t?e[Le]=n:delete e[Le]),i}var Rt=Re?function(e){return e==null?[]:(e=Object(e),_e(Re(e),function(t){return Fe.call(e,t)}))}:rn,zt=wt;(Ve&&zt(new Ve(new ArrayBuffer(1)))!=O||He&&zt(new He)!=h||Ue&&zt(Ue.resolve())!=y||R&&zt(new R)!=S||We&&zt(new We)!=E)&&(zt=function(e){var t=wt(e),n=t==v?e.constructor:void 0,r=n?W(n):``;if(r)switch(r){case Ke:return O;case qe:return h;case Je:return y;case Ye:return S;case Xe:return E}return t});function Bt(e,t){return t=t==null?o:t,!!t&&(typeof e==`number`||ce.test(e))&&e>-1&&e%1==0&&e<t}function Vt(e){var t=typeof e;return t==`string`||t==`number`||t==`symbol`||t==`boolean`?e!==`__proto__`:e===null}function Ht(e){return!!ke&&ke in e}function Ut(e){var t=e&&e.constructor,n=typeof t==`function`&&t.prototype||Ee;return e===n}function Wt(e){return Ae.call(e)}function W(e){if(e!=null){try{return Oe.call(e)}catch(e){}try{return e+``}catch(e){}}return``}function Gt(e,t){return e===t||e!==e&&t!==t}var Kt=Tt(function(){return arguments}())?Tt:function(e){return en(e)&&L.call(e,`callee`)&&!Fe.call(e,`callee`)},qt=Array.isArray;function Jt(e){return e!=null&&Qt(e.length)&&!Zt(e)}var Yt=ze||an;function Xt(e,t){return Et(e,t)}function Zt(e){if(!$t(e))return!1;var t=wt(e);return t==p||t==m||t==l||t==b}function Qt(e){return typeof e==`number`&&e>-1&&e%1==0&&e<=o}function $t(e){var t=typeof e;return e!=null&&(t==`object`||t==`function`)}function en(e){return typeof e==`object`&&!!e}var tn=ge?be(ge):kt;function nn(e){return Jt(e)?xt(e):At(e)}function rn(){return[]}function an(){return!1}t.exports=Xt}),xr=c(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});let t=yr(),n=br();var r;(function(e){function r(e={},n={},r=!1){typeof e!=`object`&&(e={}),typeof n!=`object`&&(n={});let i=t(n);for(let t in r||(i=Object.keys(i).reduce((e,t)=>(i[t]!=null&&(e[t]=i[t]),e),{})),e)e[t]!==void 0&&n[t]===void 0&&(i[t]=e[t]);return Object.keys(i).length>0?i:void 0}e.compose=r;function i(e={},t={}){typeof e!=`object`&&(e={}),typeof t!=`object`&&(t={});let r=Object.keys(e).concat(Object.keys(t)).reduce((r,i)=>(n(e[i],t[i])||(r[i]=t[i]===void 0?null:t[i]),r),{});return Object.keys(r).length>0?r:void 0}e.diff=i;function a(e={},t={}){e=e||{};let n=Object.keys(t).reduce((n,r)=>(t[r]!==e[r]&&e[r]!==void 0&&(n[r]=t[r]),n),{});return Object.keys(e).reduce((n,r)=>(e[r]!==t[r]&&t[r]===void 0&&(n[r]=null),n),n)}e.invert=a;function o(e,t,n=!1){if(typeof e!=`object`)return t;if(typeof t!=`object`)return;if(!n)return t;let r=Object.keys(t).reduce((n,r)=>(e[r]===void 0&&(n[r]=t[r]),n),{});return Object.keys(r).length>0?r:void 0}e.transform=o})(r||(r={})),exports.default=r}),Sr=c(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t;(function(e){function t(e){return typeof e.delete==`number`?e.delete:typeof e.retain==`number`?e.retain:typeof e.retain==`object`&&e.retain!==null?1:typeof e.insert==`string`?e.insert.length:1}e.length=t})(t||(t={})),exports.default=t}),Cr=c(exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});let t=Sr();var n=class{constructor(e){this.ops=e,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(e){e||(e=1/0);let n=this.ops[this.index];if(n){let r=this.offset,i=t.default.length(n);if(e>=i-r?(e=i-r,this.index+=1,this.offset=0):this.offset+=e,typeof n.delete==`number`)return{delete:e};{let t={};return n.attributes&&(t.attributes=n.attributes),typeof n.retain==`number`?t.retain=e:typeof n.retain==`object`&&n.retain!==null?t.retain=n.retain:typeof n.insert==`string`?t.insert=n.insert.substr(r,e):t.insert=n.insert,t}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?t.default.length(this.ops[this.index])-this.offset:1/0}peekType(){let e=this.ops[this.index];return e?typeof e.delete==`number`?`delete`:typeof e.retain==`number`||typeof e.retain==`object`&&e.retain!==null?`retain`:`insert`:`retain`}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{let e=this.offset,t=this.index,n=this.next(),r=this.ops.slice(this.index);return this.offset=e,this.index=t,[n].concat(r)}}else return[]}};exports.default=n}),wr=c((exports,t)=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.AttributeMap=exports.OpIterator=exports.Op=void 0;let n=vr(),r=yr(),i=br(),a=xr();exports.AttributeMap=a.default;let o=Sr();exports.Op=o.default;let s=Cr();exports.OpIterator=s.default;let c=`\0`,l=(e,t)=>{if(typeof e!=`object`||!e)throw Error(`cannot retain a ${typeof e}`);if(typeof t!=`object`||!t)throw Error(`cannot retain a ${typeof t}`);let n=Object.keys(e)[0];if(!n||n!==Object.keys(t)[0])throw Error(`embed types not matched: ${n} != ${Object.keys(t)[0]}`);return[n,e[n],t[n]]};var u=class e{constructor(e){Array.isArray(e)?this.ops=e:e!=null&&Array.isArray(e.ops)?this.ops=e.ops:this.ops=[]}static registerEmbed(e,t){this.handlers[e]=t}static unregisterEmbed(e){delete this.handlers[e]}static getHandler(e){let t=this.handlers[e];if(!t)throw Error(`no handlers for embed type "${e}"`);return t}insert(e,t){let n={};return typeof e==`string`&&e.length===0?this:(n.insert=e,typeof t==`object`&&t&&Object.keys(t).length>0&&(n.attributes=t),this.push(n))}delete(e){return e<=0?this:this.push({delete:e})}retain(e,t){if(typeof e==`number`&&e<=0)return this;let n={retain:e};return typeof t==`object`&&t&&Object.keys(t).length>0&&(n.attributes=t),this.push(n)}push(e){let t=this.ops.length,n=this.ops[t-1];if(e=r(e),typeof n==`object`){if(typeof e.delete==`number`&&typeof n.delete==`number`)return this.ops[t-1]={delete:n.delete+e.delete},this;if(typeof n.delete==`number`&&e.insert!=null&&(--t,n=this.ops[t-1],typeof n!=`object`))return this.ops.unshift(e),this;if(i(e.attributes,n.attributes)){if(typeof e.insert==`string`&&typeof n.insert==`string`)return this.ops[t-1]={insert:n.insert+e.insert},typeof e.attributes==`object`&&(this.ops[t-1].attributes=e.attributes),this;if(typeof e.retain==`number`&&typeof n.retain==`number`)return this.ops[t-1]={retain:n.retain+e.retain},typeof e.attributes==`object`&&(this.ops[t-1].attributes=e.attributes),this}}return t===this.ops.length?this.ops.push(e):this.ops.splice(t,0,e),this}chop(){let e=this.ops[this.ops.length-1];return e&&typeof e.retain==`number`&&!e.attributes&&this.ops.pop(),this}filter(e){return this.ops.filter(e)}forEach(e){this.ops.forEach(e)}map(e){return this.ops.map(e)}partition(e){let t=[],n=[];return this.forEach(r=>{let i=e(r)?t:n;i.push(r)}),[t,n]}reduce(e,t){return this.ops.reduce(e,t)}changeLength(){return this.reduce((e,t)=>t.insert?e+o.default.length(t):t.delete?e-t.delete:e,0)}length(){return this.reduce((e,t)=>e+o.default.length(t),0)}slice(t=0,n=1/0){let r=[],i=new s.default(this.ops),a=0;for(;a<n&&i.hasNext();){let e;a<t?e=i.next(t-a):(e=i.next(n-a),r.push(e)),a+=o.default.length(e)}return new e(r)}compose(t){let n=new s.default(this.ops),r=new s.default(t.ops),o=[],c=r.peek();if(c!=null&&typeof c.retain==`number`&&c.attributes==null){let e=c.retain;for(;n.peekType()===`insert`&&n.peekLength()<=e;)e-=n.peekLength(),o.push(n.next());c.retain-e>0&&r.next(c.retain-e)}let u=new e(o);for(;n.hasNext()||r.hasNext();)if(r.peekType()===`insert`)u.push(r.next());else if(n.peekType()===`delete`)u.push(n.next());else{let t=Math.min(n.peekLength(),r.peekLength()),o=n.next(t),s=r.next(t);if(s.retain){let c={};if(typeof o.retain==`number`)c.retain=typeof s.retain==`number`?t:s.retain;else if(typeof s.retain==`number`)o.retain==null?c.insert=o.insert:c.retain=o.retain;else{let t=o.retain==null?`insert`:`retain`,[n,r,i]=l(o[t],s.retain),a=e.getHandler(n);c[t]={[n]:a.compose(r,i,t===`retain`)}}let d=a.default.compose(o.attributes,s.attributes,typeof o.retain==`number`);if(d&&(c.attributes=d),u.push(c),!r.hasNext()&&i(u.ops[u.ops.length-1],c)){let t=new e(n.rest());return u.concat(t).chop()}}else typeof s.delete==`number`&&(typeof o.retain==`number`||typeof o.retain==`object`&&o.retain!==null)&&u.push(s)}return u.chop()}concat(t){let n=new e(this.ops.slice());return t.ops.length>0&&(n.push(t.ops[0]),n.ops=n.ops.concat(t.ops.slice(1))),n}diff(t,r){if(this.ops===t.ops)return new e;let o=[this,t].map(e=>e.map(n=>{if(n.insert!=null)return typeof n.insert==`string`?n.insert:c;let r=e===t?`on`:`with`;throw Error(`diff() called `+r+` non-document`)}).join(``)),l=new e,u=n(o[0],o[1],r,!0),d=new s.default(this.ops),f=new s.default(t.ops);return u.forEach(e=>{let t=e[1].length;for(;t>0;){let r=0;switch(e[0]){case n.INSERT:r=Math.min(f.peekLength(),t),l.push(f.next(r));break;case n.DELETE:r=Math.min(t,d.peekLength()),d.next(r),l.delete(r);break;case n.EQUAL:r=Math.min(d.peekLength(),f.peekLength(),t);let e=d.next(r),o=f.next(r);i(e.insert,o.insert)?l.retain(r,a.default.diff(e.attributes,o.attributes)):l.push(o).delete(r);break}t-=r}}),l.chop()}eachLine(t,n=`
`){let r=new s.default(this.ops),i=new e,a=0;for(;r.hasNext();){if(r.peekType()!==`insert`)return;let s=r.peek(),c=o.default.length(s)-r.peekLength(),l=typeof s.insert==`string`?s.insert.indexOf(n,c)-c:-1;if(l<0)i.push(r.next());else if(l>0)i.push(r.next(l));else{if(t(i,r.next(1).attributes||{},a)===!1)return;a+=1,i=new e}}i.length()>0&&t(i,{},a)}invert(t){let n=new e;return this.reduce((r,i)=>{if(i.insert)n.delete(o.default.length(i));else if(typeof i.retain==`number`&&i.attributes==null)return n.retain(i.retain),r+i.retain;else if(i.delete||typeof i.retain==`number`){let e=i.delete||i.retain,s=t.slice(r,r+e);return s.forEach(e=>{i.delete?n.push(e):i.retain&&i.attributes&&n.retain(o.default.length(e),a.default.invert(i.attributes,e.attributes))}),r+e}else if(typeof i.retain==`object`&&i.retain!==null){let o=t.slice(r,r+1),c=new s.default(o.ops).next(),[u,d,f]=l(i.retain,c.insert),p=e.getHandler(u);return n.retain({[u]:p.invert(d,f)},a.default.invert(i.attributes,c.attributes)),r+1}return r},0),n.chop()}transform(t,n=!1){if(n=!!n,typeof t==`number`)return this.transformPosition(t,n);let r=t,i=new s.default(this.ops),c=new s.default(r.ops),l=new e;for(;i.hasNext()||c.hasNext();)if(i.peekType()===`insert`&&(n||c.peekType()!==`insert`))l.retain(o.default.length(i.next()));else if(c.peekType()===`insert`)l.push(c.next());else{let t=Math.min(i.peekLength(),c.peekLength()),r=i.next(t),o=c.next(t);if(r.delete)continue;if(o.delete)l.push(o);else{let i=r.retain,s=o.retain,c=typeof s==`object`&&s?s:t;if(typeof i==`object`&&i&&typeof s==`object`&&s){let t=Object.keys(i)[0];if(t===Object.keys(s)[0]){let r=e.getHandler(t);r&&(c={[t]:r.transform(i[t],s[t],n)})}}l.retain(c,a.default.transform(r.attributes,o.attributes,n))}}return l.chop()}transformPosition(e,t=!1){t=!!t;let n=new s.default(this.ops),r=0;for(;n.hasNext()&&r<=e;){let i=n.peekLength(),a=n.peekType();if(n.next(),a===`delete`){e-=Math.min(i,e-r);continue}else a===`insert`&&(r<e||!t)&&(e+=i);r+=i}return e}};u.Op=o.default,u.OpIterator=s.default,u.AttributeMap=a.default,u.handlers={},exports.default=u,typeof t==`object`&&(t.exports=u,t.exports.default=u)}),Tr=class extends lr{static value(){}optimize(){(this.prev||this.next)&&this.remove()}length(){return 0}value(){return``}};Tr.blotName=`break`,Tr.tagName=`BR`;var Er=Tr,Dr=class extends _r{},Or,kr=class e extends tr{static compare(t,n){let r=e.order.indexOf(t),i=e.order.indexOf(n);return r>=0||i>=0?r-i:t===n?0:t<n?-1:1}formatAt(t,n,r,i){if(e.compare(this.statics.blotName,r)<0&&this.scroll.query(r,Y.BLOT)){let e=this.isolate(t,n);i&&e.wrap(r,i)}else super.formatAt(t,n,r,i)}optimize(t){if(super.optimize(t),this.parent instanceof e&&e.compare(this.statics.blotName,this.parent.statics.blotName)>0){let e=this.parent.isolate(this.offset(),this.length());this.moveChildren(e),e.wrap(this)}}};Or=kr,P(kr,`allowedChildren`,[Or,Er,lr,Dr]),P(kr,`order`,[`cursor`,`inline`,`link`,`underline`,`strike`,`italic`,`bold`,`script`,`code`]);var Ar=kr,jr=u(wr(),1);let Mr=1;var Nr=class extends ir{constructor(...e){super(...e),P(this,`cache`,{})}delta(){return this.cache.delta==null&&(this.cache.delta=Fr(this)),this.cache.delta}deleteAt(e,t){super.deleteAt(e,t),this.cache={}}formatAt(e,t,n,r){t<=0||(this.scroll.query(n,Y.BLOCK)?e+t===this.length()&&this.format(n,r):super.formatAt(e,Math.min(t,this.length()-e-1),n,r),this.cache={})}insertAt(e,t,n){if(n!=null){super.insertAt(e,t,n),this.cache={};return}if(t.length===0)return;let r=t.split(`
`),i=r.shift();i.length>0&&(e<this.length()-1||this.children.tail==null?super.insertAt(Math.min(e,this.length()-1),i):this.children.tail.insertAt(this.children.tail.length(),i),this.cache={});let a=this;r.reduce((e,t)=>(a=a.split(e,!0),a.insertAt(0,t),t.length),e+i.length)}insertBefore(e,t){let{head:n}=this.children;super.insertBefore(e,t),n instanceof Er&&n.remove(),this.cache={}}length(){return this.cache.length==null&&(this.cache.length=super.length()+Mr),this.cache.length}moveChildren(e,t){super.moveChildren(e,t),this.cache={}}optimize(e){super.optimize(e),this.cache={}}path(e){return super.path(e,!0)}removeChild(e){super.removeChild(e),this.cache={}}split(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(t&&(e===0||e>=this.length()-Mr)){let t=this.clone();return e===0?(this.parent.insertBefore(t,this),this):(this.parent.insertBefore(t,this.next),t)}let n=super.split(e,t);return this.cache={},n}};Nr.blotName=`block`,Nr.tagName=`P`,Nr.defaultChild=Er,Nr.allowedChildren=[Er,Ar,lr,Dr];var Pr=class extends lr{attach(){super.attach(),this.attributes=new Vn(this.domNode)}delta(){return new jr.default().insert(this.value(),F(F({},this.formats()),this.attributes.values()))}format(e,t){let n=this.scroll.query(e,Y.BLOCK_ATTRIBUTE);n!=null&&this.attributes.attribute(n,t)}formatAt(e,t,n,r){this.format(n,r)}insertAt(e,t,n){if(n!=null){super.insertAt(e,t,n);return}let r=t.split(`
`),i=r.pop(),a=r.map(e=>{let t=this.scroll.create(Nr.blotName);return t.insertAt(0,e),t}),o=this.split(e);a.forEach(e=>{this.parent.insertBefore(e,o)}),i&&this.parent.insertBefore(this.scroll.create(`text`,i),o)}};Pr.scope=Y.BLOCK_BLOT;function Fr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return e.descendants(Kn).reduce((e,n)=>n.length()===0?e:e.insert(n.value(),Ir(n,{},t)),new jr.default).insert(`
`,Ir(e))}function Ir(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return e==null||(`formats`in e&&typeof e.formats==`function`&&(t=F(F({},t),e.formats()),n&&delete t[`code-token`]),e.parent==null||e.parent.statics.blotName===`scroll`||e.parent.statics.scope!==e.statics.scope)?t:Ir(e.parent,t,n)}let Lr=t.default.import(`blots/block/embed`);var Rr=class extends Lr{delta(){let e=super.delta(),t=Ir(this);return t[d.tableCellInner]&&e.insert(`
`,{[d.tableCellInner]:t[d.tableCellInner]}),e}length(){let e=Ir(this);return e[d.tableCellInner]&&(!this.next||this.next.length()<=1)?super.length()+1:super.length()}};let zr=t.default.import(`parchment`),Br=t.default.import(`blots/scroll`);var Vr=class extends Br{enable(e=!0){let n=t.default.import(`formats/${d.tableCellInner}`),r=this.domNode.querySelectorAll(`.${n.className}`);for(let t of Array.from(r))t.setAttribute(`contenteditable`,String(!!e));let i=t.default.import(`formats/${d.tableCaption}`),a=this.domNode.querySelectorAll(`.${i.className}`);for(let t of Array.from(a))t.setAttribute(`contenteditable`,String(!!e));super.enable(e)}createBlock(e,t){let n,r={};if(e[d.tableCellInner])n=d.tableCellInner;else for(let[t,i]of Object.entries(e)){let e=this.query(t,zr.Scope.BLOCK&zr.Scope.BLOT)!=null;e?n=t:r[t]=i}n===d.tableCellInner&&(r=F({},e),delete r[n]);let i=this.create(n||this.statics.defaultChild.blotName,n?e[n]:void 0);this.insertBefore(i,t||void 0);let a=i.length();i instanceof q&&a===0&&(a+=1);for(let[e,t]of Object.entries(r))i.formatAt(0,a,e,t);return i}},Hr=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">\r
  <!-- Icon from Tabler Icons by Paweł Kuna - https://github.com/tabler/tabler-icons/blob/master/LICENSE -->\r
  <path\r
    fill="none"\r
    stroke="currentColor"\r
    stroke-linecap="round"\r
    stroke-linejoin="round"\r
    stroke-width="2"\r
    d="M7 3v18m3-15L7 3L4 6m16 12l-3 3l-3-3m3 3V3"\r
  />\r
</svg>\r
`;let Ur=t.default.import(`parchment`),Wr=t.default.import(`blots/inline`),Gr=t.default.import(`blots/text`);var Kr=class extends kn{static create(e){let{tableId:t}=e,n=super.create();return n.dataset.tableId=t,e.side===`bottom`&&(n.style.captionSide=`bottom`),n}static formats(e){let{tableId:t}=e.dataset,n={tableId:String(t),side:e.style.captionSide===`bottom`?`bottom`:`top`};return n}constructor(e,t,n){super(e,t),t.setAttribute(`contenteditable`,String(e.isEnabled())),this.attachUI(this.createUI()),this.domNode.addEventListener(`mouseenter`,()=>{this.scroll.isEnabled()&&(this.uiNode.style.display=`flex`)}),this.domNode.addEventListener(`mouseleave`,()=>{this.scroll.isEnabled()&&(this.uiNode.style.display=`none`)}),this.uiNode.style.display=`none`}createUI(){let e=document.createElement(`i`);return e.classList.add(`ql-table-caption--switch`),e.innerHTML=Hr,e.addEventListener(`click`,()=>{this.scroll.isEnabled()&&(this.side=this.side===`top`?`bottom`:`top`)}),e}get tableId(){return this.domNode.dataset.tableId}set side(e){this.domNode.style.captionSide=e===`bottom`?`bottom`:`top`}get side(){return this.domNode.style.captionSide===`bottom`?`bottom`:`top`}format(e,t){let n=this.scroll.query(e,Ur.Scope.BLOCK_BLOT);(!n||e===this.statics.blotName)&&super.format(e,t)}checkMerge(){let e=this.next;return e!==null&&e.statics.blotName===this.statics.blotName&&e.tableId===this.tableId}optimize(e){let t=this.parent;if(t!==null&&t.statics.blotName!==d.tableMain){let{tableId:e}=this;this.wrap(d.tableMain,{tableId:e})}this.children.length===0?this.remove():(super.optimize(e),this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove()))}};P(Kr,`blotName`,d.tableCaption),P(Kr,`tagName`,`caption`),P(Kr,`className`,`ql-table-caption`),P(Kr,`allowedChildren`,[Wr,Gr]);var X=class extends K{static isAllowStyle(e){let t=gn(e);for(let e of this.allowStyle)if(t.startsWith(gn(e)))return!0;return!1}static create(e){let{tableId:t,rowId:n,colId:r,rowspan:i,colspan:a,style:o,emptyRow:s}=e,c=super.create();c.dataset.tableId=t,c.dataset.rowId=n,c.dataset.colId=r,c.setAttribute(`rowspan`,String(Sn(i))),c.setAttribute(`colspan`,String(Sn(a))),o&&(c.style.cssText=o);try{s&&(c.dataset.emptyRow=JSON.stringify(s))}catch(e){}return c}static formats(e){let{tableId:t,rowId:n,colId:r,emptyRow:i}=e.dataset,a=Number(e.getAttribute(`rowspan`)),o=Number(e.getAttribute(`colspan`)),s={tableId:t,rowId:n,colId:r,rowspan:Sn(a),colspan:Sn(o)},c={};for(let t=0;t<e.style.length;t++){let n=e.style[t],r=e.style[n];this.isAllowStyle(String(n))&&![`initial`,`inherit`].includes(r)&&(c[n]=r)}let l=Object.entries(c);l.length>0&&(s.style=l.map(([e,t])=>`${e}: ${t}`).join(`;`));try{i&&(s.emptyRow=JSON.parse(i))}catch(e){}return s}setFormatValue(e,t){if(this.statics.allowAttrs.has(e)||this.statics.allowDataAttrs.has(e)){let n=e;this.statics.allowDataAttrs.has(e)&&(n=`data-${e}`),t?this.domNode.setAttribute(n,t):this.domNode.removeAttribute(n)}else this.statics.isAllowStyle(e)&&(Object.assign(this.domNode.style,{[e]:t}),e.startsWith(`border`)&&this.setStyleBoder(e,t));let n=this.children.head;this.domNode.style.cssText&&n&&n.statics.blotName===d.tableCellInner&&this.domNode.style.cssText!==n.domNode.dataset.style&&(n.domNode.dataset.style=this.domNode.style.cssText)}setStyleBoder(e,t){let n=t||null,r=![`left`,`right`,`top`,`bottom`].some(t=>e.includes(t))&&e.startsWith(`border-`);if(!r)return;let i=this.getNearByCell(`left`).map(e=>e.descendant(q,0)[0]).filter(Boolean);for(let t of i)t.setFormatValue(e.replace(`border-`,`border-right-`),n,!0);let a=this.getNearByCell(`top`).map(e=>e.descendant(q,0)[0]).filter(Boolean);for(let t of a)t.setFormatValue(e.replace(`border-`,`border-bottom-`),n,!0)}getNearByCell(e){let t=[];try{let e=x(this,d.tableMain);t.push(...e.getColIds())}catch(e){console.error(`Cell is not in table! ${e}`)}if(t.length===0)return[];if(e===`left`){let e=new Set,n=this.parent;for(let r=0;r<this.rowspan&&n instanceof J;r++){let r=n.children.iterator(),i=null;for(;i=r();){let n=t.indexOf(i.colId)+i.colspan;this.colId===t[n]&&e.add(i)}n=n.next}return Array.from(e)}else if(e===`top`){if(!(this.parent instanceof J)||!this.parent.prev)return[];let e=new Set,n=this.getColumnIndex(),r=n+this.colspan,i=new Set(t.filter((e,t)=>t>=n&&t<r)),a=1,o=this.parent.prev;for(;o;){let n=!1,r=o.children.iterator(),s=null,c=0;for(;s=r();)i.has(s.colId)&&s.rowspan>=a&&(e.add(s),i.delete(s.colId)),c+=s.colspan,s.rowspan>=a&&(n=!0);if(!n&&c===t.length)break;o=o.prev,a+=1}return Array.from(e)}return[]}get tableId(){return this.domNode.dataset.tableId}get rowId(){return this.domNode.dataset.rowId}get colId(){return this.domNode.dataset.colId}get rowspan(){return Number(this.domNode.getAttribute(`rowspan`))}get colspan(){return Number(this.domNode.getAttribute(`colspan`))}get emptyRow(){try{return JSON.parse(this.domNode.dataset.emptyRow)}catch(e){return[]}}getColumnIndex(){let e=x(this,d.tableMain);return e.getColIds().indexOf(this.colId)}getCellInner(){return this.children.head}checkMerge(){let{colId:e,rowId:t,colspan:n,rowspan:r}=this,i=this.next;return i!==null&&i.statics.blotName===this.statics.blotName&&i.rowId===t&&i.colId===e&&i.colspan===n&&i.rowspan===r}optimize(e){let t=this.parent,{tableId:n,rowId:r}=this;if(t!==null&&t.statics.blotName!==d.tableRow&&this.wrap(d.tableRow,{tableId:n,rowId:r}),this.emptyRow.length>0)for(let e of this.emptyRow)this.parent.parent.insertBefore(this.scroll.create(d.tableRow,{tableId:this.tableId,rowId:e}),this.parent.next);super.optimize(e)}};P(X,`blotName`,d.tableCell),P(X,`tagName`,`td`),P(X,`className`,`ql-table-cell`),P(X,`allowDataAttrs`,new Set([`table-id`,`row-id`,`col-id`,`empty-row`])),P(X,`allowAttrs`,new Set([`rowspan`,`colspan`])),P(X,`allowStyle`,new Set([`background-color`,`border`,`height`]));let qr=t.default.import(`blots/block/embed`);var Jr=class extends qr{static validWidth(e,t){let n=Number.parseFloat(String(e));return Number.isNaN(n)&&(n=f[t?`colMinWidthPre`:`colMinWidthPx`]),`${n}${t?`%`:`px`}`}static create(e){let{width:t,tableId:n,colId:r,full:i,align:a}=e,o=super.create();return o.setAttribute(`width`,this.validWidth(t,!!i)),i&&(o.dataset.full=String(i)),a&&a!==`left`&&(o.dataset.align=a),o.dataset.tableId=n,o.dataset.colId=r,o}static value(e){let{tableId:t,colId:n}=e.dataset,r=e.getAttribute(`width`)||String(f.colDefaultWidth),i=e.dataset.align,a=Object.hasOwn(e.dataset,`full`),o={tableId:String(t),colId:String(n),full:a,width:Number.parseFloat(r)};return i&&(o.align=i),o}get width(){let e=this.domNode.getAttribute(`width`);if(!e){if(e=this.domNode.getBoundingClientRect().width,this.full){let t=this.domNode.closest(`table`);return t?e/100*t.getBoundingClientRect().width:f[this.full?`colMinWidthPre`:`colMinWidthPx`]}return e}return Number.parseFloat(String(e))}set width(e){let t=Number.parseFloat(String(e));Number.isNaN(t)&&(t=f[this.full?`colMinWidthPre`:`colMinWidthPx`]),this.domNode.setAttribute(`width`,this.statics.validWidth(t,!!this.full))}get tableId(){return this.domNode.dataset.tableId}get colId(){return this.domNode.dataset.colId}get full(){return Object.hasOwn(this.domNode.dataset,`full`)}set full(e){e?this.domNode.dataset.full=`true`:this.domNode.removeAttribute(`data-full`)}get align(){return this.domNode.dataset.align||``}set align(e){e===`right`||e===`center`?this.domNode.dataset.align=e:this.domNode.removeAttribute(`data-align`)}checkMerge(){let e=this.next,{tableId:t,colId:n}=this;return e!==null&&e.statics.blotName===this.statics.blotName&&e.tableId===t&&e.colId===n}optimize(e){let t=this.parent;if(t!=null&&t.statics.blotName!==d.tableColgroup){let e=this.statics.value(this.domNode);this.wrap(d.tableColgroup,e)}let n=x(this,d.tableColgroup);n.align=this.align,this.next!=null&&this.checkMerge()&&this.next.remove(),super.optimize(e);try{let e=x(this,d.tableColgroup),t=!0;e.children.forEach(e=>{t&&(t=e.full)}),e.full=t}catch(e){}}insertAt(e,t,n){if(n!=null){super.insertAt(e,t,n);return}try{let e=t.split(`
`),n=e.pop(),r=x(this,d.tableColgroup),i=r.next,a=this.scroll,o=r.split(this.offset(r));if(i){let e=i.descendants(q);if(e.length>0){let t=e[0],n=q.formats(t.domNode),i=this.scroll.create(d.tableCellInner,n),s=i.wrap(d.tableCell,n),c=s.wrap(d.tableRow,n),l=c.wrap(d.tableBody,n.tableId);r.parent.insertBefore(l,o),a=i}}for(let t of e){let e=this.scroll.create(`block`);e.insertAt(0,t),a.appendChild(e)}if(n){let e=this.scroll.create(`block`);e.appendChild(this.scroll.create(`text`,n)),a.appendChild(e)}}catch(e){console.warn(`TableCol not in TableColgroup`)}}};P(Jr,`blotName`,d.tableCol),P(Jr,`tagName`,`col`);var Z=class extends K{static create(e){let t=super.create(),{tableId:n,full:r,align:i}=e;return t.dataset.tableId=n,i===`right`||i===`center`?t.dataset.align=i:t.removeAttribute(`date-align`),r&&(t.dataset.full=String(r)),t.setAttribute(`cellpadding`,`0`),t.setAttribute(`cellspacing`,`0`),t}constructor(e,t,n){super(e,t),this.scroll=e,this.updateAlign()}colWidthFillTable(){if(this.full){Object.assign(this.domNode.style,{width:null});return}let e=this.getCols();if(!e)return;let t=e.reduce((e,t)=>t.width+e,0);if(!(t===0||Number.isNaN(t)))return this.domNode.style.width=`${t}px`,t}get tableId(){return this.domNode.dataset.tableId}get full(){return Object.hasOwn(this.domNode.dataset,`full`)}set full(e){e?this.domNode.dataset.full=`true`:this.domNode.removeAttribute(`data-full`),this.colWidthFillTable()}get align(){return this.domNode.dataset.align||``}set align(e){e===`right`||e===`center`?this.domNode.dataset.align=e:this.domNode.removeAttribute(`data-align`),this.updateAlign()}setFull(){if(this.full)return;let e=this.getCols();if(e.length===0)return;let t=Math.floor(this.domNode.getBoundingClientRect().width);for(let n of e){let e=n.width/t*100;n.full=!0,n.width=e}}cancelFull(){if(!this.full)return;let e=this.getCols();if(e.length===0)return;let t=Math.floor(this.domNode.getBoundingClientRect().width);for(let n of e)n.full=!1,n.width=Math.max(n.width/100*t,f.colMinWidthPx)}updateAlign(){let e=this.align,t={marginLeft:null,marginRight:null};switch(e){case`center`:t.marginLeft=`auto`,t.marginRight=`auto`;break;case``:case`left`:t.marginRight=`auto`;break;case`right`:t.marginLeft=`auto`;break;default:break}Object.assign(this.domNode.style,t)}getRows(){return Array.from(this.domNode.querySelectorAll(`${J.tagName}`)).map(e=>this.scroll.find(e)).filter(Boolean)}getRowIds(){return this.getRows().map(e=>e.rowId)}getCols(){return this.descendants(Jr)}getColIds(){return this.getCols().map(e=>e.colId)}checkMerge(){let e=this.next;return e!==null&&e.statics.blotName===this.statics.blotName&&e.domNode.dataset.tableId===this.tableId}optimize(e){let t=this.parent;t!==null&&t.statics.blotName!==d.tableWrapper&&this.wrap(d.tableWrapper,this.tableId),super.optimize(e),this.mergeRow()}mergeRow(){if(!this.parent)return;let e=this.getRows(),t={};for(let n of e)t[n.rowId]||(t[n.rowId]=[]),t[n.rowId].push(n);for(let e of Object.values(t))for(let t=1;t<e.length;t++){let n=e[t];n.moveChildren(e[0]),n.remove()}}checkEmptyCol(e){if(e){let e=this.getRows().length,t=this.getCols(),n=this.descendants(q);for(let r of n)if(r.colspan>1&&r.rowspan>=e){let e=t.findIndex(e=>e.colId===r.colId),n=t[e];for(let i=e+1;i<e+r.colspan;i++)t[i].remove(),n.width+=t[i].width;r.colspan=1}}}checkEmptyRow(e){let t=this.getRows(),n=new Set(t.map(e=>e.rowId));for(let r=t.length-1;r>=0;r--){let i=t[r];if(e){if(i.children.length===0){for(let e=1,n=r-1;n>=0;n--,e++){let r=t[n];r.foreachCellInner(t=>{if(t.rowspan>e){--t.rowspan;let e=new Set(t.emptyRow);e.delete(i.rowId),t.emptyRow=Array.from(e)}})}i.remove()}}else{if(i.children.length===0&&i.prev){let e=i.prev;for(;e&&e.children.length===0;)e=e.prev;e.foreachCellInner(e=>{let t=new Set(e.emptyRow);t.has(i.rowId)||(e.emptyRow=[i.rowId,...t])})}i.foreachCellInner(e=>{for(let t of e.emptyRow)n.has(t)||i.parent.insertBefore(this.scroll.create(d.tableRow,{tableId:this.tableId,rowId:t}),i.next)})}}}sortMergeChildren(){let e={[d.tableCaption]:[],[d.tableColgroup]:[],[d.tableBody]:[]};this.children.forEach(t=>{e[t.statics.blotName]&&e[t.statics.blotName].push(t)});for(let t of Object.values(e))for(let e=1;e<t.length;e++)t[e].moveChildren(t[0]);let t=e[d.tableCaption][0],n=e[d.tableColgroup][0],r=e[d.tableBody][0],i=t&&this.children.head!==t,a=n&&t&&t.next!==n,o=n&&!t&&this.children.head!==n,s=r&&this.children.tail!==r;if(i||a||o||s){let e=this.clone();t&&e.appendChild(t),n&&e.appendChild(n),r&&e.appendChild(r),this.children.forEach(e=>e.remove()),e.moveChildren(this)}}};P(Z,`blotName`,d.tableMain),P(Z,`tagName`,`table`),P(Z,`className`,`ql-table`);var Yr=class extends K{static create(e){let t=super.create();return t.dataset.tableId=e.tableId,e.full&&(t.dataset.full=String(e.full)),e.align&&e.align!==`left`&&(t.dataset.align=e.align),t.setAttribute(`contenteditable`,`false`),t}get tableId(){return this.domNode.dataset.tableId}get full(){return Object.hasOwn(this.domNode.dataset,`full`)}set full(e){e?this.domNode.dataset.full=`true`:this.domNode.removeAttribute(`data-full`),this.parent&&this.parent instanceof Z&&(this.parent.full=e)}get align(){return this.domNode.dataset.align||``}set align(e){e===`right`||e===`center`?this.domNode.dataset.align=e:this.domNode.removeAttribute(`data-align`)}findCol(e){let t=this.children.iterator(),n=0,r;for(;(r=t())&&n!==e;)n++;return r}insertColByIndex(e,t){let n=this.parent;if(!(n instanceof Z))throw TypeError(`TableColgroupFormat should be child of TableFormat`);let r=this.findCol(e),i=this.scroll.create(d.tableCol,t);if(n.full){let e=this.children.iterator(),t;for(;t=e();)if(t.width-i.width>=f.colMinWidthPre){t.width-=i.width;break}}this.insertBefore(i,r)}removeColByIndex(e){let t=this.parent;if(!(t instanceof Z))throw TypeError(`TableColgroupFormat should be child of TableMainFormat`);let n=this.findCol(e);n&&(t.full&&(n.next?n.next.width+=n.width:n.prev&&(n.prev.width+=n.width)),n.remove(),t.colWidthFillTable())}checkMerge(){let e=this.next,t=this.parent;return t instanceof Z&&!t.full&&t.colWidthFillTable(),e!==null&&e.statics.blotName===this.statics.blotName&&e.tableId===this.tableId}optimize(e){let t=this.parent,{tableId:n,full:r,align:i}=this;t!=null&&t.statics.blotName!==d.tableMain&&this.wrap(d.tableMain,{tableId:n,full:r,align:i});let a=x(this,d.tableMain);a.align=i,super.optimize(e)}};P(Yr,`blotName`,d.tableColgroup),P(Yr,`tagName`,`colgroup`);let Xr=t.default.import(`parchment`);var Zr=class extends K{static create(e){let t=super.create();return t.dataset.tableId=e,t.addEventListener(`dragstart`,e=>{e.preventDefault(),e.stopPropagation()},!0),t.addEventListener(`drop`,e=>{e.preventDefault()}),t.addEventListener(`dragover`,e=>{e.preventDefault(),e.dataTransfer.dropEffect=`none`}),t.setAttribute(`contenteditable`,`false`),t}constructor(e,n,r){super(e,n),this.scroll=e,P(this,`insertLineAround`,()=>{(!this.prev||!this.isBlockLine(this.prev))&&this.parent.insertBefore(this.scroll.create(`block`),this),(!this.next||!this.isBlockLine(this.next))&&this.parent.insertBefore(this.scroll.create(`block`),this.next)}),this.scroll.emitter.on(t.default.events.TEXT_CHANGE,this.insertLineAround)}get tableId(){return this.domNode.dataset.tableId}checkMerge(){let e=this.next;return e!==null&&e.statics.blotName===this.statics.blotName&&e.tableId===this.tableId}deleteAt(e,t){super.deleteAt(e,t);let n=this.descendants(Tn),r=this.descendants(Yr);(n.length===0||r.length===0)&&this.remove()}remove(){super.remove(),this.scroll.emitter.off(t.default.events.TEXT_CHANGE,this.insertLineAround)}isBlockLine(e){return e instanceof Xr.BlockBlot||new Set([`list-container`,`code-block-container`]).has(e.statics.blotName)}};P(Zr,`blotName`,d.tableWrapper),P(Zr,`tagName`,`div`),P(Zr,`className`,`ql-table-wrapper`);function Qr(e){let[t]=w(e,Tn);return t?{body:t,rect:t.domNode.getBoundingClientRect()}:{body:null,rect:null}}var $r=class{constructor(e,n,r){this.tableModule=e,this.table=n,this.quill=r,P(this,`tableBlot`,void 0),P(this,`tableWrapperBlot`,void 0),P(this,`alignBox`,void 0),P(this,`cleanup`,void 0),P(this,`bem`,b(`align`)),P(this,`resizeObserver`,ln(()=>this.update(),{ignoreFirstBind:!0})),P(this,`updateWhenTextChange`,()=>{this.update()}),this.tableBlot=t.default.find(n),this.tableWrapperBlot=this.tableBlot.parent,this.alignBox=this.buildTool(),this.resizeObserver.observe(this.table),this.quill.on(t.default.events.TEXT_CHANGE,this.updateWhenTextChange),this.show()}buildTool(){let e=this.tableModule.addContainer(this.bem.b()),n=t.default.import(`ui/icons`),r={left:n.align[``],center:n.align.center,right:n.align.right};for(let[n,i]of Object.entries(r)){let r=document.createElement(`span`);r.dataset.align=n,r.classList.add(this.bem.be(`item`)),r.innerHTML=`<i class="icon">${i}</i>`,r.addEventListener(`click`,()=>{let e=r.dataset.align;e&&(this.setTableAlign(this.tableBlot,e),this.quill.once(t.default.events.SCROLL_OPTIMIZE,()=>{this.tableModule.tableSelection&&this.tableModule.tableSelection.hide(),this.tableModule.tableResize&&this.tableModule.tableResize.update(),this.tableModule.tableResizeScale&&this.tableModule.tableResizeScale.update(),this.tableModule.tableScrollbar&&this.tableModule.tableScrollbar.update()}))}),e.appendChild(r)}return this.cleanup||(this.cleanup=Jt(this.tableWrapperBlot.domNode,e,()=>this.update())),e}setTableAlign(e,t){let n=e.getCols();for(let e of n)e.align=t}show(){this.alignBox&&(this.alignBox.classList.add(this.bem.bm(`active`)),this.update())}hide(){this.alignBox&&(this.alignBox.classList.remove(this.bem.bm(`active`)),this.cleanup&&(this.cleanup(),this.cleanup=void 0))}update(){if(this.alignBox){if(this.tableBlot.full||this.tableBlot.domNode.offsetWidth>=this.quill.root.offsetWidth){this.hide();return}$t(this.tableWrapperBlot.domNode,this.alignBox,{placement:`top`,middleware:[Zt(),Xt({limiter:Qt()}),Yt(16)]}).then(({x:e,y:t})=>{Object.assign(this.alignBox.style,{left:`${e}px`,top:`${t}px`})})}}destroy(){this.hide(),this.resizeObserver.disconnect(),this.quill.off(t.default.events.TEXT_CHANGE,this.updateWhenTextChange),this.alignBox&&(this.alignBox.remove(),this.alignBox=void 0)}};let ei=[`style`],ti=[`attributes`],ni=[`attributes`],ri=[`background`],ii=t.default.import(`delta`),ai=t.default.import(`modules/clipboard`);function oi(e){let t=Number.parseFloat(e.getAttribute(`width`)||String(f.colDefaultWidth));if(Number.isNaN(t)){let n=e.style.width;t=n?Number.parseFloat(n):e.offsetWidth}return t}function si(e,t){let n=Array(t).fill(f.colDefaultWidth),r=Array.from(e.querySelectorAll(`tr`));for(let e of r){let r=Array.from(e.querySelectorAll(`td`));for(let[e,i]of r.entries())if(e<t){let t=oi(i);n[e]=t||n[e]}else break}return n}var ci=class extends ai{constructor(e,t){super(e,t),this.quill=e,P(this,`tableId`,G()),P(this,`rowId`,G()),P(this,`colIds`,[]),P(this,`rowspanCount`,[]),P(this,`cellCount`,0),P(this,`colCount`,0),this.addMatcher(`table`,this.matchTable.bind(this)),this.addMatcher(`tbody`,this.matchTbody.bind(this)),this.addMatcher(`colgroup`,this.matchColgroup.bind(this)),this.addMatcher(`col`,this.matchCol.bind(this)),this.addMatcher(`tr`,this.matchTr.bind(this)),this.addMatcher(`td`,this.matchTd.bind(this)),this.addMatcher(`th`,this.matchTd.bind(this)),this.addMatcher(`caption`,this.matchCaption.bind(this)),this.addMatcher(Node.ELEMENT_NODE,this.matchTdAttributor.bind(this))}matchTable(e,t){if(t.ops.length===0)return t;let n=[],r=[],i=-1;for(let e=0;e<t.ops.length;e++){let{attributes:a,insert:o}=t.ops[e];if(!j(o)&&a&&!a[d.tableCellInner]&&!a[d.tableCaption]){t.ops.splice(e,1),--e;continue}let s=a||{},c=d.tableCell,{table:l,[c]:u}=s,f=R(s,[`table`,c].map(ye)),p=j(o)&&o[d.tableCol];p?r.push({insert:o}):n.push({attributes:f,insert:o}),!(f!=null&&f[d.tableCellInner])&&!(f!=null&&f[d.tableCaption])&&!p&&A(o)&&o.trim().length>0&&(i=e)}let a=si(e,this.colIds.length),o=a.reduce((e,t,n)=>(r[n]?e.push(r[n]):e.push({insert:{[d.tableCol]:{tableId:this.tableId,colId:this.colIds[n],width:t,full:!1}}}),e),[]);return n.splice(i+1,0,...o),this.tableId=G(),this.colIds=[],this.rowspanCount=[],this.cellCount=0,this.colCount=0,new ii(n)}matchTbody(e,t){let n=e.style.backgroundColor;if(n)for(let e of t.ops){var r;if((r=e.attributes)!=null&&r[d.tableCellInner]){let t=e.attributes[d.tableCellInner],{style:r}=t,i=R(t,ei),a=pn(r||``);a.backgroundColor||(a.backgroundColor=n,e.attributes[d.tableCellInner]=F(F({},i),{},{style:mn(a)}))}}let i=[];for(let e=t.ops.length-1;e>=0;e--){let n=t.ops[e];n.attributes&&(n.attributes[d.tableCellInner]?n.attributes[d.tableCellInner].rowspan===1?i=[]:i.length>0&&(n.attributes[d.tableCellInner].emptyRow||(n.attributes[d.tableCellInner].emptyRow=[]),n.attributes[d.tableCellInner].emptyRow.push(...i)):(i=[],i.push(G())))}return t}matchColgroup(e,t){let n=[];for(let e=0;e<t.ops.length;e++){let r=t.ops[e];r&&j(r.insert)&&r.insert[d.tableCol]&&n.push(r)}return new ii(n)}matchCol(e,t){let n=Number(e.getAttribute(`span`)||1);Number.isNaN(n)&&(n=1);let r=new ii;for(let t=0;t<n;t++)this.colIds[this.colCount]=G(),r.insert({[d.tableCol]:Object.assign(Jr.value(e),{tableId:this.tableId,colId:this.colIds[this.colCount]})}),this.colCount+=1;return r}matchTr(e,t){this.rowId=G(),this.cellCount=0;for(let[e,t]of this.rowspanCount.entries())t.rowspan>0&&--t.rowspan,t.rowspan<=0&&(this.rowspanCount[e]={rowspan:0,colspan:0});for(let e of t.ops)if(e.attributes){let{background:t,[d.tableCellInner]:n}=e.attributes;if(n&&t){let{style:r=``}=n,i=pn(r);i.backgroundColor=t,e.attributes[d.tableCellInner].style=mn(i)}}return t}matchTd(e,t){let n=e,r=X.formats(n);if(!this.colIds[this.cellCount]||!this.rowspanCount[this.cellCount])for(let e=this.cellCount;e>=0;e--)this.colIds[e]||(this.colIds[e]=G()),this.rowspanCount[e]||(this.rowspanCount[e]={rowspan:0,colspan:0});for(let e=this.cellCount;e<this.rowspanCount.length;e++){let{rowspan:t,colspan:n}=this.rowspanCount[e];if(t===0)break;this.cellCount+=n}r.rowspan>1&&(this.rowspanCount[this.cellCount]={rowspan:r.rowspan,colspan:r.colspan});let i=this.colIds[this.cellCount];this.cellCount+=r.colspan;let a=Object.assign(r,{tableId:this.tableId,rowId:this.rowId,colId:i});n.style.border===`none`&&(a.style=a.style.replaceAll(RegExp(`border-(top|right|bottom|left)-style:none;?`,`g`),``));let o=[];for(let e of t.ops){let{attributes:t={}}=e,n=R(e,ti),r=d.tableCell,{[r]:i}=t,s=R(t,[r].map(ye));o.push(F(F({},n),{},{attributes:F(F({},s),{},{[d.tableCellInner]:a})}))}return(o.length<=0||!A(o[o.length-1].insert)||!o[o.length-1].insert.endsWith(`
`))&&o.push({insert:`
`,attributes:{[d.tableCellInner]:a}}),new ii(o)}matchTdAttributor(e,t){let n=e;if(n.tagName.toLocaleLowerCase()===`td`){let e=[];for(let n of t.ops){let{attributes:t}=n,r=R(n,ni),i=t==null?void 0:t[d.tableCellInner];if(t&&i&&i.style){let{background:n}=t,a=R(t,ri),o=document.createElement(`div`);o.style.background=n;let s=document.createElement(`div`);if(s.style.cssText=i.style,o.style.background===s.style.backgroundColor){e.push(F(F({},r),{},{attributes:F({},a)}));continue}}e.push(n)}return new ii(e)}return t}convert({html:e,text:t},n={}){let r=super.convert({html:e,text:t},n);if(n[d.tableCellInner])for(let e of r.ops){if(j(e.insert)&&e.insert[d.tableCol]){e.insert=``;continue}e.attributes||(e.attributes={}),e.attributes[d.tableCellInner]=n[d.tableCellInner]}return r}matchCaption(e,t){for(let e=0;e<t.ops.length;e++){let n=t.ops[e],{attributes:r}=n;r&&r[d.tableCaption]&&(r[d.tableCaption].tableId=this.tableId,n.attributes=r)}return t}},li=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <!-- Icon from Tabler Icons by Paweł Kuna - https://github.com/tabler/tabler-icons/blob/master/LICENSE -->
  <path
    fill="none"
    stroke="currentColor"
    stroke-linecap="round"
    stroke-linejoin="round"
    stroke-width="2"
    d="M4 12V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v6m-10 6H3m18 0h-7m-8-3l-3 3l3 3m12-6l3 3l-3 3"
  />
</svg>
`,ui=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="none"
    stroke="currentColor"
    stroke-linecap="round"
    stroke-linejoin="round"
    stroke-width="2"
    d="m4 8l4-4m6 0L4 14m0 6L20 4m0 6L10 20m10-4l-4 4"
  />
</svg>
`,di=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="none"
    stroke="currentColor"
    stroke-linecap="round"
    stroke-linejoin="round"
    stroke-width="1.5"
    d="m12.01 16l-.01.011M12.01 12l-.01.011M12.01 8l-.01.011M8.01 12l-.01.011M16.01 12l-.01.011M21 3.6v16.8a.6.6 0 0 1-.6.6H3.6a.6.6 0 0 1-.6-.6V3.6a.6.6 0 0 1 .6-.6h16.8a.6.6 0 0 1 .6.6"
  />
</svg>
`,fi=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 256">
  <g fill="currentColor">
    <path d="M216 40v128h-48V88H88V40Z" opacity=".2" />
    <path
      d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"
    />
  </g>
</svg>
`,pi=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 32 32">
  <path
    fill="currentColor"
    d="m19.05 13.733l-1-1.733l-10.122 5.846l-.997-.576a3 3 0 0 0 .667-.769A3 3 0 1 0 3.5 17.599L5.928 19L3.5 20.402a3.034 3.034 0 1 0 3.44.323l.988-.57L14.59 24l1-1.73L9.928 19zM4.034 15.26a1 1 0 1 1 .466.607a1 1 0 0 1-.466-.607M5 22a1 1 0 1 1-.865 1.5A1 1 0 0 1 5 22m12 4h4v2h-4zm-7 0h4v2h-4z"
  />
  <path fill="currentColor" d="M28 28h-4v-2h4V4H7v4H5V4a2 2 0 0 1 2-2h21a2 2 0 0 1 2 2v22a2 2 0 0 1-2 2" />
</svg>
`,mi=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="currentColor"
    d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm11.94 5.5h2v-4h2v4h2l-3 3z"
  />
</svg>
`,hi=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="currentColor"
    d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm14.44 2v2h4v2h-4v2l-3-3z"
  />
</svg>
`,gi=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="currentColor"
    d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm15.44 8v-2h-4v-2h4v-2l3 3z"
  />
</svg>
`,_i=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="currentColor"
    d="M4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4zm17.94 4.5h-2v4h-2v-4h-2l3-3z"
  />
</svg>
`,vi=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="currentColor"
    d="M5 10H3V4h8v2H5zm14 8h-6v2h8v-6h-2zM5 18v-4H3v6h8v-2zM21 4h-8v2h6v4h2zM8 13v2l3-3l-3-3v2H3v2zm8-2V9l-3 3l3 3v-2h5v-2z"
  />
</svg>
`,yi=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="currentColor"
    d="M4 2h7a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 8v4h7v-4zm0 6v4h7v-4zM4 4v4h7V4zm13.59 8L15 9.41L16.41 8L19 10.59L21.59 8L23 9.41L20.41 12L23 14.59L21.59 16L19 13.41L16.41 16L15 14.59z"
  />
</svg>
`,bi=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="currentColor"
    d="M9.41 13L12 15.59L14.59 13L16 14.41L13.41 17L16 19.59L14.59 21L12 18.41L9.41 21L8 19.59L10.59 17L8 14.41zM22 9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2zM4 9h4V6H4zm6 0h4V6h-4zm6 0h4V6h-4z"
  />
</svg>
`,xi=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="currentColor"
    d="m15.46 15.88l1.42-1.42L19 16.59l2.12-2.13l1.42 1.42L20.41 18l2.13 2.12l-1.42 1.42L19 19.41l-2.12 2.13l-1.42-1.42L17.59 18zM4 3h14a2 2 0 0 1 2 2v7.08a6 6 0 0 0-4.32.92H12v4h1.08c-.11.68-.11 1.35 0 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2m0 4v4h6V7zm8 0v4h6V7zm-8 6v4h6v-4z"
  />
</svg>
`,Si=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <path
    fill="currentColor"
    d="M19 14h2v6H3v-6h2v4h14zM3 4v6h2V6h14v4h2V4zm8 7v2H8v2l-3-3l3-3v2zm5 0V9l3 3l-3 3v-2h-3v-2z"
  />
</svg>
`,Ci=`<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24">
  <!-- Icon from TDesign Icons by TDesign - https://github.com/Tencent/tdesign-icons/blob/main/LICENSE -->
  <path fill="currentColor" d="M21 10v12h-2V12H5v10H3V10zm0-8v6H3V2zm-2 2H5v2h14z" />
</svg>
`;let wi=`color-selector`,Q={Break:{name:`break`},CopyCell:{name:`CopyCell`,tip:`Copy cell`,icon:fi,handle:(e,t)=>{let n=e.getTextByCell(t),r=e.getHTMLByCell(t),i=new ClipboardItem({"text/plain":new Blob([n],{type:`text/plain`}),"text/html":new Blob([r],{type:`text/html`})});navigator.clipboard.write([i]),e.hideTableTools()}},CutCell:{name:`CutCell`,tip:`Cut cell`,icon:pi,handle:(e,t)=>{let n=e.getTextByCell(t),r=e.getHTMLByCell(t,!0),i=new ClipboardItem({"text/plain":new Blob([n],{type:`text/plain`}),"text/html":new Blob([r],{type:`text/html`})});navigator.clipboard.write([i]),e.hideTableTools()}},InsertTop:{name:`InsertTop`,icon:_i,tip:`Insert row above`,handle:(e,t)=>{e.appendRow(t,!1),e.hideTableTools()}},InsertRight:{name:`InsertRight`,icon:gi,tip:`Insert column right`,handle:(e,t)=>{e.appendCol(t,!0),e.hideTableTools()}},InsertBottom:{name:`InsertBottom`,icon:mi,tip:`Insert row below`,handle:(e,t)=>{e.appendRow(t,!0),e.hideTableTools()}},InsertLeft:{name:`InsertLeft`,icon:hi,tip:`Insert column Left`,handle:(e,t)=>{e.appendCol(t,!1),e.hideTableTools()}},MergeCell:{name:`MergeCell`,icon:vi,tip:`Merge Cell`,handle:(e,t)=>{e.mergeCells(t),e.hideTableTools()}},SplitCell:{name:`SplitCell`,icon:Si,tip:`Split Cell`,handle:(e,t)=>{e.splitCell(t),e.hideTableTools()}},DeleteRow:{name:`DeleteRow`,icon:bi,tip:`Delete Row`,handle:(e,t)=>{e.removeRow(t),e.hideTableTools()}},DeleteColumn:{name:`DeleteColumn`,icon:yi,tip:`Delete Column`,handle:(e,t)=>{e.removeCol(t),e.hideTableTools()}},DeleteTable:{name:`DeleteTable`,icon:xi,tip:`Delete table`,handle:(e,t)=>{e.deleteTable(t)}},BackgroundColor:{name:`BackgroundColor`,icon:ui,isColorChoose:!0,tip:`Set background color`,key:`background-color`,handle:(e,t,n)=>{e.setCellAttrs(t,`background-color`,n,!0)}},BorderColor:{name:`BorderColor`,icon:di,isColorChoose:!0,tip:`Set border color`,key:`border-color`,handle:(e,t,n)=>{e.setCellAttrs(t,`border-color`,n,!0)}},SwitchWidth:{name:`SwitchWidth`,icon:li,tip:`Switch table width`,handle:e=>{if(!e.table)return;let n=t.default.find(e.table);n&&(n.full?n.cancelFull():n.setFull())}},InsertCaption:{name:`InsertCaption`,icon:Ci,tip:`Insert table caption`,handle(e){if(!e.table)return;let n=t.default.find(e.table);if(!n)return;let r=e.quill.scroll.create(`text`,`Table Caption`).wrap(d.tableCaption,{tableId:n.tableId});n.insertBefore(r,n.children.head)}}},Ti=10,Ei=b(`color-map`),$={selectWrapper:Ei.b(),used:Ei.bm(`used`),item:Ei.be(`item`),btn:Ei.be(`btn`),map:Ei.be(`content`),mapRow:Ei.be(`content-row`)};var Di=class{constructor(e,n,r){this.tableModule=e,this.quill=n,P(this,`usedColors`,new Set),P(this,`options`,void 0),P(this,`menu`,null),P(this,`isMenuDisplay`,!1),P(this,`isColorPicking`,!1),P(this,`updateUsedColor`,void 0),P(this,`tooltipItem`,[]),P(this,`activeTooltip`,null),P(this,`bem`,b(`menu`)),P(this,`colorItemClass`,`color-${G()}`),P(this,`colorChooseTooltipOption`,{direction:`top`}),P(this,`updateWhenTextChange`,()=>{this.isMenuDisplay&&this.update()}),this.options=this.resolveOptions(r);try{let e=localStorage.getItem(this.options.localstorageKey)||`[]`,t=JSON.parse(e);k(t)||(t=[]),t.slice(-1*Ti).map(e=>this.usedColors.add(e))}catch(e){}this.updateUsedColor=_n(e=>{if(!e)return;if(this.usedColors.add(e),this.usedColors.size>Ti){let e=Array.from(this.usedColors).slice(-1*Ti);this.usedColors.clear(),e.map(e=>this.usedColors.add(e))}localStorage.setItem(this.options.localstorageKey,JSON.stringify(Array.from(this.usedColors)));let t=Array.from(document.querySelectorAll(`.${this.colorItemClass}.${$.used}`));for(let n of t){let t=document.createElement(`div`);t.classList.add($.item),t.style.backgroundColor=String(e);let r=Array.from(n.querySelectorAll(`.${$.item}[style*="background-color: ${t.style.backgroundColor}"]`));r.length<=0&&n.appendChild(t);let i=Array.from(n.querySelectorAll(`.${$.item}`)).slice(0,-1*Ti);for(let e of i)e.remove()}},1e3),this.quill.on(t.default.events.TEXT_CHANGE,this.updateWhenTextChange)}resolveOptions(e){let t=Object.assign({tipText:!0,tools:[Q.InsertTop,Q.InsertRight,Q.InsertBottom,Q.InsertLeft,Q.Break,Q.MergeCell,Q.SplitCell,Q.Break,Q.DeleteRow,Q.DeleteColumn,Q.DeleteTable,Q.Break,Q.BackgroundColor,Q.BorderColor],localstorageKey:`__table-bg-used-color`,defaultColorMap:h},e);return t}buildTools(){let e=document.createElement(`div`);e.classList.add(this.bem.b()),Object.assign(e.style,{display:`flex`});for(let t of this.options.tools){let{name:n,icon:r,handle:i,isColorChoose:a,key:o,tip:s=``}=t,c=document.createElement(`span`);if(c.classList.add(this.bem.be(`item`)),n===`break`)c.classList.add(this.bem.is(`break`));else{let e=document.createElement(`i`);if(e.classList.add(`icon`),oe(r)?e.appendChild(r(this.tableModule)):e.innerHTML=r,c.appendChild(e),a&&o){let e=this.createColorChoose(c,{name:n,icon:r,handle:i,isColorChoose:a,key:o,tip:s});this.tooltipItem.push(e),c.classList.add(wi)}else oe(i)&&c.addEventListener(`click`,e=>{this.quill.focus(),i(this.tableModule,this.getSelectedTds(),e)},!1);let t=this.tableModule.options.texts[n]||s;this.options.tipText&&t&&s&&this.createTipText(c,t)}e.appendChild(c)}return e}createColorChoose(e,{handle:t,key:n}){let r=document.createElement(`div`);if(r.classList.add($.selectWrapper),this.options.defaultColorMap.length>0){let e=document.createElement(`div`);e.classList.add($.map);for(let t of this.options.defaultColorMap){let n=document.createElement(`div`);n.classList.add($.mapRow);for(let e of t){let t=document.createElement(`div`);t.classList.add($.item),t.style.backgroundColor=e,n.appendChild(t)}e.appendChild(n)}r.appendChild(e)}let i=document.createElement(`div`);i.classList.add($.mapRow),Object.assign(i.style,{marginTop:`4px`});let a=document.createElement(`div`);a.classList.add($.btn,`transparent`),a.textContent=this.tableModule.options.texts.transparent,a.addEventListener(`click`,()=>{t(this.tableModule,this.getSelectedTds(),`transparent`)});let o=document.createElement(`div`);o.classList.add($.btn,`clear`),o.textContent=this.tableModule.options.texts.clear,o.addEventListener(`click`,()=>{t(this.tableModule,this.getSelectedTds(),null)});let s=document.createElement(`div`);s.classList.add($.btn,`custom`),s.textContent=this.tableModule.options.texts.custom;let c=le({onChange:e=>{t(this.tableModule,this.getSelectedTds(),e),this.updateUsedColor(e)}}),{hide:l,destroy:u}=rn(s,{direction:`right`,type:`click`,content:c,container:s});i.appendChild(a),i.appendChild(o),i.appendChild(s),r.appendChild(i);let d=document.createElement(`div`);d.classList.add($.used,this.colorItemClass);for(let e of this.usedColors){let t=document.createElement(`div`);t.classList.add($.item),t.style.backgroundColor=e,d.appendChild(t)}r.appendChild(d),r.addEventListener(`click`,e=>{e.stopPropagation(),l();let t=e.target,r=t.style.backgroundColor,i=this.getSelectedTds();if(t&&r&&i.length>0){if(this.tableModule.setCellAttrs(i,n,r,!0),!t.closest(`.${$.item}`))return;this.updateUsedColor(r)}});let f=rn(e,F({type:`click`,content:r,onOpen:()=>(this.isMenuDisplay&&this.tableModule.tableSelection&&this.tableModule.tableSelection.hideDisplay(),this.setActiveTooltip(f),!1),onClose:()=>{this.isMenuDisplay&&this.tableModule.tableSelection&&(this.tableModule.tableSelection.updateWithSelectedTds(),this.tableModule.tableSelection.showDisplay());let e=r.contains(c);return e&&l(),this.activeTooltip===f&&(this.activeTooltip=null),!1},onDestroy:()=>{u(),this.activeTooltip===f&&(this.activeTooltip=null)}},this.colorChooseTooltipOption));return f.isColorPick=!0,f}setActiveTooltip(e){this.activeTooltip&&this.activeTooltip!==e&&this.activeTooltip.hide(!0),this.activeTooltip=e}getSelectedTds(){var e;return((e=this.tableModule.tableSelection)==null?void 0:e.selectedTds)||[]}createTipText(e,t){let n=rn(e,{msg:t});n&&this.tooltipItem.push(n)}show(){!this.menu||!this.tableModule.tableSelection||!this.tableModule.tableSelection.boundary||(Object.assign(this.menu.style,{display:`flex`}),this.isMenuDisplay=!0,this.update())}update(){}hide(){this.menu&&Object.assign(this.menu.style,{display:`none`});for(let e of this.tooltipItem)e.hide(!0);this.isMenuDisplay=!1}destroy(){this.quill.off(t.default.events.TEXT_CHANGE,this.updateWhenTextChange),this.activeTooltip=null;for(let e of this.tooltipItem)e.destroy();this.menu&&(this.hide(),this.menu.remove(),this.menu=null)}},Oi=class extends Di{constructor(e,t,n){super(e,t,n),this.tableModule=e,this.quill=t,P(this,`colorChooseTooltipOption`,{direction:`right`}),P(this,`listenContextmenu`,e=>{var t;e.preventDefault();let n=e.composedPath();if(!n||n.length<=0)return;let r=n.find(e=>e.tagName&&e.tagName.toUpperCase()===`TABLE`&&e.classList.contains(`ql-table`));r&&!((t=this.tableModule.tableSelection)==null||(t=t.selectedTds)==null)&&t.length?(this.menu||(this.menu=this.buildTools()),Object.assign(this.menu.style,{display:`flex`}),this.isMenuDisplay=!0,this.update({x:e.clientX,y:e.clientY}),document.addEventListener(`click`,()=>{this.hide()},{once:!0})):this.hide()}),this.quill.root.addEventListener(`contextmenu`,this.listenContextmenu)}buildTools(){let e=super.buildTools();e.classList.add(this.bem.is(`contextmenu`));let t=e.getElementsByClassName(wi);for(let e of Array.from(t))e.addEventListener(`click`,e=>e.stopPropagation());return document.body.appendChild(e),e}createTipText(e,t){let n=document.createElement(`span`);n.textContent=t,e.appendChild(n)}show(){}update(e){if(!this.isMenuDisplay||!this.menu||!this.tableModule.tableSelection||!this.tableModule.tableSelection.isDisplaySelection||!e)return;super.update();let t={display:`flex`,left:0,top:0},{x:n,y:r}=e;t.left=n,t.top=r,Object.assign(this.menu.style,F(F({},t),{},{left:`${t.left+window.scrollX}px`,top:`${t.top+window.scrollY}px`}));let i=this.menu.getBoundingClientRect(),{left:a,top:o}=cn(i);Object.assign(this.menu.style,{left:`${a+window.scrollX}px`,top:`${o+window.scrollY}px`})}destroy(){this.quill.root.removeEventListener(`contextmenu`,this.listenContextmenu),super.destroy()}},ki=class extends Di{constructor(e,t,n){super(e,t,n),this.tableModule=e,this.quill=t,this.menu=this.buildTools(),this.tableModule.addContainer(this.menu),this.show(),this.update()}update(){!this.isMenuDisplay||!this.menu||!this.tableModule.tableSelection||!this.tableModule.tableSelection.isDisplaySelection||(super.update(),$t(this.tableModule.tableSelection.cellSelect,this.menu,{placement:`bottom`,middleware:[Zt(),Xt({limiter:Qt()}),Yt(20)]}).then(({x:e,y:t})=>{Object.assign(this.menu.style,{left:`${e}px`,top:`${t}px`})}))}};let Ai=e=>!e.full&&e.align===`right`;var ji=class{constructor(e,t){this.tableModule=e,this.quill=t,P(this,`colIndex`,-1),P(this,`tableMain`,void 0),P(this,`dragging`,!1),P(this,`dragColBreak`,null),P(this,`handleColMouseUpFunc`,this.handleColMouseUp.bind(this)),P(this,`handleColMouseMoveFunc`,this.handleColMouseMove.bind(this)),P(this,`handleColMouseDownFunc`,this.handleColMouseDown.bind(this)),P(this,`rowIndex`,-1),P(this,`dragRowBreak`,null),P(this,`handleRowMouseUpFunc`,this.handleRowMouseUp.bind(this)),P(this,`handleRowMouseMoveFunc`,this.handleRowMouseMove.bind(this)),P(this,`handleRowMouseDownFunc`,this.handleRowMouseDown.bind(this)),P(this,`dragBEM`,b(`drag-line`))}findCurrentColIndex(e){return-1}colWidthChange(e,t,n){}createConfirmDialog({message:e,confirm:t,cancel:n}){return N(function*(){return new Promise(r=>{let i=document.createElement(`div`);Object.assign(i.style,{padding:`8px 12px`,fontSize:`14px`,lineHeight:`1.5`});let a=document.createElement(`p`);a.textContent=e;let o=document.createElement(`div`);Object.assign(o.style,{display:`flex`,justifyContent:`flex-end`,gap:`6px`});let s=M({content:n}),c=M({type:`confirm`,content:t});o.appendChild(s),o.appendChild(c),i.appendChild(a),i.appendChild(o);let{close:l}=de({child:i});s.addEventListener(`click`,()=>{r(!1),l()}),c.addEventListener(`click`,()=>{r(!0),l()})})})()}handleColMouseUp(){var e=this;return N(function*(){if(!e.dragColBreak||!e.tableMain||e.colIndex===-1)return;let t=e.tableMain.getCols(),n=Number.parseInt(e.dragColBreak.dataset.w||`0`),r=e.tableMain.full,i=!1,a=[];if(r){let r=e.tableMain.domNode.getBoundingClientRect().width,o=n/r*100,s=t[e.colIndex].width;if(o<s){if(o=Math.max(f.colMinWidthPre,o),t[e.colIndex+1]||t[e.colIndex-1]){let n=t[e.colIndex+1]?e.colIndex+1:e.colIndex-1;a.push({index:n,width:t[n].width+s-o})}else o=100;i=!0,a.push({index:e.colIndex,width:o})}else if(t[e.colIndex+1]){let n=s+t[e.colIndex+1].width;o=Math.min(n-f.colMinWidthPre,o),i=!0,a.push({index:e.colIndex,width:o},{index:e.colIndex+1,width:n-o})}}else e.tableMain.domNode.style.width=`${Number.parseFloat(e.tableMain.domNode.style.width)-t[e.colIndex].domNode.getBoundingClientRect().width+n}px`,i=!0,a.push({index:e.colIndex,width:n});if(document.body.removeChild(e.dragColBreak),e.dragColBreak=null,document.removeEventListener(`mouseup`,e.handleColMouseUpFunc),document.removeEventListener(`mousemove`,e.handleColMouseMoveFunc),e.dragging=!1,i){let n=e.tableMain.domNode.getBoundingClientRect().width;if(r){let i=0,o=new Set(a.map(({index:e,width:t})=>(i+=t,e)));for(let[e,n]of t.entries()){if(o.has(e))continue;i+=n.width}if(i>100){if(!(yield e.createConfirmDialog({message:e.tableModule.options.texts.perWidthInsufficient,confirm:e.tableModule.options.texts.confirmText,cancel:e.tableModule.options.texts.cancelText})))return;e.tableMain.cancelFull(),r=!1;for(let[e,t]of a.entries()){let{width:r,index:i}=t;a[e]={index:i,width:r/100*n}}}}for(let{index:i,width:o}of a)t[i].width=`${Math.round(o)}${r?`%`:`px`}`,e.colWidthChange(i,{px:Math.round(o/100*n),pre:Math.round(o)},r)}e.quill.emitter.emit(p.AFTER_TABLE_RESIZE)})()}getColumnRect(e){if(!this.tableMain)return null;let t=this.tableMain.getCols();if(e>=t.length)return null;let n=t[0].domNode.getBoundingClientRect().left;for(let r=0;r<e;r++){let e=t[r].domNode.getBoundingClientRect();n+=e.width}let r=t[e],i=r.domNode.getBoundingClientRect().width;return{left:n,right:n+i,width:i}}handleColMouseMove(e){if(e.preventDefault(),!this.dragColBreak||!this.tableMain||this.colIndex===-1)return;let t=this.tableMain.getCols(),n=this.getColumnRect(this.colIndex),r=this.tableMain.domNode.getBoundingClientRect(),i=e.clientX;if(this.tableMain.full){let e=f.colMinWidthPre/100*r.width,a=r.right;i>n.right&&t[this.colIndex+1]&&(a=Math.max(this.getColumnRect(this.colIndex+1).right-e,n.left+e));let o=n.left+e;i=Math.min(Math.max(i,o),a)}else Ai(this.tableMain)?n.right-i<f.colMinWidthPx&&(i=n.right-f.colMinWidthPx):i-n.left<f.colMinWidthPx&&(i=n.left+f.colMinWidthPx);let a=i-n.left;return Ai(this.tableMain)&&(a=n.right-i),this.dragColBreak.style.left=`${i}px`,this.dragColBreak.dataset.w=String(a),{left:i,width:a}}handleColMouseDown(e){if(e.button!==0||(e.preventDefault(),!this.tableMain))return;let{rect:t,body:n}=Qr(this.tableMain);if(!n||!t)return;let r=this.tableMain.getCols();if(this.colIndex=this.findCurrentColIndex(e),this.colIndex===-1)return;let i=r[this.colIndex].width,a=this.tableMain.full?i/100*t.width:i;document.addEventListener(`mouseup`,this.handleColMouseUpFunc),document.addEventListener(`mousemove`,this.handleColMouseMoveFunc),this.dragging=!0;let o=document.createElement(`div`);o.classList.add(this.dragBEM.b()),o.classList.add(this.dragBEM.is(`col`)),o.dataset.w=String(a);let s={top:t.y,left:e.clientX,height:t.height};Object.assign(o.style,{top:`${s.top}px`,left:`${s.left}px`,height:`${s.height}px`});let c=document.body;return c.appendChild(o),this.dragColBreak&&c.removeChild(this.dragColBreak),this.dragColBreak=o,s}findCurrentRowIndex(e){return-1}rowHeightChange(e,t){}handleRowMouseUp(){if(!this.tableMain||!this.dragRowBreak||this.rowIndex===-1)return;let e=Number.parseInt(this.dragRowBreak.dataset.h||`0`),t=this.tableMain.getRows();t[this.rowIndex].setHeight(`${e}px`),this.rowHeightChange(this.rowIndex,e),document.body.removeChild(this.dragRowBreak),this.dragRowBreak=null,document.removeEventListener(`mouseup`,this.handleRowMouseUpFunc),document.removeEventListener(`mousemove`,this.handleRowMouseMoveFunc),this.dragging=!1,this.quill.emitter.emit(p.AFTER_TABLE_RESIZE)}handleRowMouseMove(e){if(!this.tableMain||!this.dragRowBreak||this.rowIndex===-1)return;e.preventDefault();let t=this.tableMain.getRows(),n=t[this.rowIndex].domNode.getBoundingClientRect(),r=e.clientY;return r-n.y<f.rowMinHeightPx&&(r=n.y+f.rowMinHeightPx),this.dragRowBreak.style.top=`${r}px`,this.dragRowBreak.dataset.h=String(r-n.y),{top:r,height:r-n.y}}handleRowMouseDown(e){if(e.button!==0||(e.preventDefault(),!this.tableMain)||(this.rowIndex=this.findCurrentRowIndex(e),this.rowIndex===-1))return;this.dragging=!0,document.addEventListener(`mouseup`,this.handleRowMouseUpFunc),document.addEventListener(`mousemove`,this.handleRowMouseMoveFunc);let t=this.tableMain.getRows(),n=t[this.rowIndex].domNode.getBoundingClientRect().height,r=this.tableMain.domNode.getBoundingClientRect(),i=document.createElement(`div`);i.classList.add(this.dragBEM.b()),i.classList.add(this.dragBEM.is(`row`)),i.dataset.h=String(n);let a={top:e.clientY,left:r.x,width:r.width};Object.assign(i.style,{top:`${a.top}px`,left:`${a.left}px`,width:`${a.width}px`});let o=document.body;return o.appendChild(i),this.dragRowBreak&&o.removeChild(this.dragRowBreak),this.dragRowBreak=i,a}update(){}destroy(){}},Mi=class extends ji{constructor(e,n,r){super(e,r),this.tableModule=e,this.table=n,P(this,`root`,void 0),P(this,`tableMain`,void 0),P(this,`tableWrapper`,void 0),P(this,`resizeObserver`,void 0),P(this,`tableCols`,[]),P(this,`tableRows`,[]),P(this,`rowHeadWrapper`,null),P(this,`colHeadWrapper`,null),P(this,`corner`,null),P(this,`scrollHandler`,[]),P(this,`lastHeaderSelect`,null),P(this,`size`,12),P(this,`bem`,b(`resize-box`)),P(this,`updateWhenTextChange`,()=>{this.update()}),P(this,`handleColMouseDownFunc`,function(e){let t=this.handleColMouseDown(e);if(t&&this.dragColBreak){let[e]=w(this.tableMain,Kr),n=e&&e.side===`top`?0:this.size;Object.assign(this.dragColBreak.style,{top:`${t.top-n}px`,left:`${t.left}px`,height:`${t.height+this.size}px`})}return t}.bind(this)),P(this,`handleRowMouseDownFunc`,function(e){let t=this.handleRowMouseDown(e);return t&&this.dragRowBreak&&Object.assign(this.dragRowBreak.style,{top:`${t.top}px`,left:`${t.left-this.size}px`,width:`${t.width+this.size}px`}),t}.bind(this)),this.tableMain=t.default.find(this.table),this.tableMain&&(this.tableWrapper=this.tableMain.parent,this.tableWrapper&&(this.root=this.tableModule.addContainer(this.bem.b()),this.resizeObserver=new ResizeObserver(()=>{this.show()}),this.resizeObserver.observe(this.table),this.quill.on(t.default.events.TEXT_CHANGE,this.updateWhenTextChange)))}handleResizerHeader(e,t,n){let{clientX:r,clientY:i}=n,a=this.table.getBoundingClientRect();if(this.tableModule.tableSelection){let o=this.tableModule.tableSelection;n.shiftKey||(this.lastHeaderSelect=null);let s=[{x:e?a.left:r,y:e?i:a.top},{x:e?a.right:r,y:e?i:a.bottom}];if(this.lastHeaderSelect){let t,n;if(this.lastHeaderSelect.isX){let e=Array.from(this.root.getElementsByClassName(this.bem.be(`row-header`))),r=e[this.lastHeaderSelect.index].getBoundingClientRect();t=Math.min(r.left,a.left),n=r.top+r.height/2}else{let e=Array.from(this.root.getElementsByClassName(this.bem.be(`col-header`))),r=e[this.lastHeaderSelect.index].getBoundingClientRect();t=r.left+r.width/2,n=Math.min(r.top,a.top)}this.lastHeaderSelect.isX===e?e?(s[0].y=Math.min(s[0].y,n),s[1].y=Math.max(s[1].y,n)):(s[0].x=Math.min(s[0].x,t),s[1].x=Math.max(s[1].x,t)):(s[1]={x:Math.max(s[0].x,t),y:Math.max(s[0].y,n)},s[0]={x:Math.min(s[0].x,t),y:Math.min(s[0].y,n)})}else this.lastHeaderSelect={isX:e,index:t};o.table=this.table,o.selectedTds=o.computeSelectedTds(...s),o.show()}}findCurrentColIndex(e){return Array.from(this.root.getElementsByClassName(this.bem.be(`col-separator`))).indexOf(e.target)}colWidthChange(e,t,n){let r=Array.from(this.root.getElementsByClassName(this.bem.be(`col-header`)));r[e].style.width=n?`${t.pre}%`:`${t.px}px`}bindColEvents(){let e=Array.from(this.root.getElementsByClassName(this.bem.be(`col-header`))),t=Array.from(this.root.getElementsByClassName(this.bem.be(`col-separator`)));un.call(this,this.tableWrapper.domNode,()=>{this.colHeadWrapper.scrollLeft=this.tableWrapper.domNode.scrollLeft});for(let[t,n]of e.entries())n.addEventListener(`click`,this.handleResizerHeader.bind(this,!1,t));for(let e of t)e.addEventListener(`mousedown`,this.handleColMouseDownFunc),e.addEventListener(`dragstart`,e=>e.preventDefault())}findCurrentRowIndex(e){return Array.from(this.root.getElementsByClassName(this.bem.be(`row-separator`))).indexOf(e.target)}rowHeightChange(e,t){let n=Array.from(this.root.getElementsByClassName(this.bem.be(`row-header`)));n[e].style.height=`${t}px`}bindRowEvents(){let e=Array.from(this.root.getElementsByClassName(this.bem.be(`row-header`))),t=Array.from(this.root.getElementsByClassName(this.bem.be(`row-separator`)));un.call(this,this.tableWrapper.domNode,()=>{this.rowHeadWrapper.scrollTop=this.tableWrapper.domNode.scrollTop});for(let[t,n]of e.entries())n.addEventListener(`click`,this.handleResizerHeader.bind(this,!0,t));for(let e of t)e.addEventListener(`mousedown`,this.handleRowMouseDownFunc),e.addEventListener(`dragstart`,e=>e.preventDefault())}update(){let{rect:e,body:t}=Qr(this.tableMain);if(!t||!e)return;let n=this.tableWrapper.domNode.getBoundingClientRect(),r=this.quill.root.getBoundingClientRect();Object.assign(this.root.style,{top:`${Math.max(e.y,n.y)-r.y}px`,left:`${Math.max(e.x,n.x)-r.x}px`});let i=-1*this.size,a=-1*this.size;Ai(this.tableMain)?(this.root.classList.add(this.bem.is(`align-right`)),i=Math.min(n.width,e.width),a=Math.min(n.width,e.width)):this.root.classList.remove(this.bem.is(`align-right`));let[o]=w(this.tableMain,Kr),s=!o||!(o&&o.side===`top`);s?this.root.classList.remove(this.bem.is(`caption-bottom`)):this.root.classList.add(this.bem.is(`caption-bottom`)),this.corner&&Object.assign(this.corner.style,{transform:`translateY(${-1*this.size}px) translateX(${i}px)`,top:`${s?0:e.height+this.size}px`}),this.rowHeadWrapper&&Object.assign(this.rowHeadWrapper.style,{transform:`translateX(${a}px)`}),this.colHeadWrapper&&Object.assign(this.colHeadWrapper.style,{top:`${s?0:e.height+this.size}px`})}show(){this.tableCols=this.tableMain.getCols(),this.tableRows=this.tableMain.getRows(),this.root.innerHTML=``;let{rect:e,body:t}=Qr(this.tableMain);if(!t||!e)return;let n=this.tableWrapper.domNode.getBoundingClientRect();if(this.tableCols.length>0&&this.tableRows.length>0&&(this.corner=document.createElement(`div`),this.corner.classList.add(this.bem.be(`corner`)),Object.assign(this.corner.style,{width:`${this.size}px`,height:`${this.size}px`}),this.corner.addEventListener(`click`,()=>{if(this.tableModule.tableSelection){let e=this.tableMain.descendants(q),t=this.tableModule.tableSelection;t.selectedTds=e,t.show(),t.updateWithSelectedTds()}}),this.root.appendChild(this.corner)),this.tableCols.length>0){let t=``;for(let[,n]of this.tableCols.entries()){let r=n.domNode.getBoundingClientRect().width;t+=`<div class="${this.bem.be(`col-header`)}" style="width: ${r}px">
          <div class="${this.bem.be(`col-separator`)}" style="height: ${e.height+this.size-3}px"></div>
        </div>`}let r=document.createElement(`div`);r.classList.add(this.bem.be(`col`));let i=document.createElement(`div`);i.classList.add(this.bem.be(`col-wrapper`)),Object.assign(r.style,{transform:`translateY(-${this.size}px)`,maxWidth:`${n.width}px`,height:`${this.size}px`}),Object.assign(i.style,{width:`${e.width}px`}),i.innerHTML=t,r.appendChild(i),this.root.appendChild(r),r.scrollLeft=this.tableWrapper.domNode.scrollLeft,this.colHeadWrapper=r,this.bindColEvents()}if(this.tableRows.length>0){let t=``;for(let[,n]of this.tableRows.entries()){let r=`${n.domNode.getBoundingClientRect().height}px`;t+=`<div class="${this.bem.be(`row-header`)}" style="height: ${Number.parseFloat(r)}px">
          <div class="${this.bem.be(`row-separator`)}" style="width: ${e.width+this.size-3}px"></div>
        </div>`}let r=document.createElement(`div`);r.classList.add(this.bem.be(`row`));let i=document.createElement(`div`);i.classList.add(this.bem.be(`row-wrapper`)),Object.assign(r.style,{transform:`translateX(-${this.size}px)`,width:`${this.size}px`,maxHeight:`${n.height}px`}),Object.assign(i.style,{height:`${e.height}px`}),i.innerHTML=t,r.appendChild(i),this.root.appendChild(r),r.scrollTop=this.tableWrapper.domNode.scrollTop,this.rowHeadWrapper=r,this.bindRowEvents()}this.update(),un.call(this,this.quill.root,()=>{this.update()})}hide(){this.root.classList.add(this.bem.is(`hidden`))}destroy(){this.hide(),dn.call(this),this.resizeObserver.disconnect(),this.quill.off(t.default.events.TEXT_CHANGE,this.updateWhenTextChange);for(let[e,t]of this.scrollHandler)e.removeEventListener(`scroll`,t);this.root.remove()}},Ni=class extends ji{constructor(e,n,r){super(e,r),this.tableModule=e,this.table=n,P(this,`colResizer`,void 0),P(this,`rowResizer`,void 0),P(this,`currentTableCell`,void 0),P(this,`dragging`,!1),P(this,`curColIndex`,-1),P(this,`curRowIndex`,-1),P(this,`tableCellBlot`,void 0),P(this,`bem`,b(`resize-line`)),P(this,`mousemoveHandler`,e=>{if(this.dragging||this.tableModule.tableSelection&&this.tableModule.tableSelection.dragging)return;let n=this.findTableCell(e);if(!n)return this.hide();let r=t.default.find(n);r&&this.currentTableCell!==n&&(this.show(),this.currentTableCell=n,this.tableCellBlot=r,this.tableMain=x(r,d.tableMain),this.tableMain.getCols().length>0&&this.updateColResizer(),this.updateRowResizer())}),P(this,`hideWhenTextChange`,()=>{this.hide()}),P(this,`handleColMouseUpFunc`,N(function*(){yield this.handleColMouseUp(),this.updateColResizer()}).bind(this)),P(this,`handleRowMouseUpFunc`,function(){this.handleRowMouseUp(),this.updateRowResizer()}.bind(this)),this.colResizer=this.tableModule.addContainer(this.bem.be(`col`)),this.rowResizer=this.tableModule.addContainer(this.bem.be(`row`)),this.table.addEventListener(`mousemove`,this.mousemoveHandler),this.quill.on(t.default.events.TEXT_CHANGE,this.hideWhenTextChange)}findTableCell(e){for(let t of e.composedPath()){if(t instanceof HTMLElement&&t.tagName===`TD`)return t;if(t===document.body)return null}return null}findCurrentColIndex(){var e;return this.curColIndex+(((e=this.tableCellBlot)==null?void 0:e.colspan)||1)-1}updateColResizer(){if(!this.tableMain||!this.tableCellBlot)return;let e=this.tableCellBlot;this.tableModule.toolBox.removeChild(this.colResizer),this.colResizer=this.tableModule.addContainer(this.bem.be(`col`));let[t]=S(e,[d.tableBody]),n=t.domNode.getBoundingClientRect(),r=e.domNode.getBoundingClientRect(),i=this.quill.root.getBoundingClientRect(),a=r.right-i.x;Ai(this.tableMain)&&(a=r.left-i.x),Object.assign(this.colResizer.style,{top:`${n.y-i.y}px`,left:`${a}px`,height:`${n.height}px`});let o=this.tableMain.getCols();this.curColIndex=o.findIndex(t=>t.colId===e.colId),this.colResizer.addEventListener(`mousedown`,this.handleColMouseDownFunc),this.colResizer.addEventListener(`dragstart`,e=>{e.preventDefault()})}findCurrentRowIndex(){return this.curRowIndex}updateRowResizer(){if(!this.tableMain||!this.tableCellBlot)return;let e=this.tableCellBlot;this.tableModule.toolBox.removeChild(this.rowResizer),this.rowResizer=this.tableModule.addContainer(this.bem.be(`row`));let t=e.parent;if(!(t instanceof J))return;let[n]=S(e,[d.tableBody]),r=n.domNode.getBoundingClientRect(),i=e.domNode.getBoundingClientRect(),a=this.quill.root.getBoundingClientRect();Object.assign(this.rowResizer.style,{top:`${i.bottom-a.y}px`,left:`${r.x-a.x}px`,width:`${r.width}px`});let o=this.tableMain.getRows();this.curRowIndex=o.indexOf(t),this.rowResizer.addEventListener(`mousedown`,this.handleRowMouseDownFunc),this.rowResizer.addEventListener(`dragstart`,e=>{e.preventDefault()})}show(){this.rowResizer.classList.remove(this.bem.is(`hidden`)),this.colResizer.classList.remove(this.bem.is(`hidden`))}hide(){this.currentTableCell=void 0,this.rowResizer.classList.add(this.bem.is(`hidden`)),this.colResizer.classList.add(this.bem.is(`hidden`))}update(){this.updateColResizer(),this.updateRowResizer()}destroy(){this.colResizer.remove(),this.rowResizer.remove(),this.table.removeEventListener(`mousemove`,this.mousemoveHandler),this.quill.off(t.default.events.TEXT_CHANGE,this.hideWhenTextChange)}},Pi=class{constructor(e,n,r,i){this.tableModule=e,this.table=n,this.quill=r,P(this,`scrollHandler`,[]),P(this,`tableMainBlot`,null),P(this,`tableWrapperBlot`,null),P(this,`bem`,b(`scale`)),P(this,`startX`,0),P(this,`startY`,0),P(this,`offset`,6),P(this,`options`,void 0),P(this,`root`,void 0),P(this,`block`,void 0),P(this,`resizeobserver`,new ResizeObserver(()=>this.update())),P(this,`updateWhenTextChange`,()=>{this.update()}),this.options=this.resolveOptions(i),this.tableMainBlot=t.default.find(n),this.tableMainBlot&&!this.tableMainBlot.full&&(this.tableWrapperBlot=this.tableMainBlot.parent,this.buildResizer(),this.show()),this.quill.on(t.default.events.TEXT_CHANGE,this.updateWhenTextChange)}resolveOptions(e){return Object.assign({blockSize:12},e)}buildResizer(){if(!this.tableMainBlot||!this.tableWrapperBlot)return;this.root=this.tableModule.addContainer(this.bem.b()),this.root.classList.add(this.bem.is(`hidden`)),this.block=document.createElement(`div`),this.block.classList.add(this.bem.be(`block`)),Object.assign(this.block.style,{width:`${this.options.blockSize}px`,height:`${this.options.blockSize}px`}),this.root.appendChild(this.block);let e=[],t=[],n=n=>{if(!this.tableMainBlot)return;let r=Ai(this.tableMainBlot)?-1:1,i=(n.clientX-this.startX)*r,a=n.clientY-this.startY,o=Math.floor(i/e.length),s=Math.floor(a/t.length);for(let{blot:t,width:n}of e)t.width=Math.max(n+o,f.colMinWidthPx);for(let{blot:e,height:n}of t)e.setHeight(`${Math.max(n+s,f.rowMinHeightPx)}px`)},r=()=>{e=[],t=[],document.removeEventListener(`mousemove`,n),document.removeEventListener(`mouseup`,r)};this.block.addEventListener(`mousedown`,i=>{!this.tableMainBlot||this.isTableOutofEditor()||(this.startX=i.clientX,this.startY=i.clientY,e=this.tableMainBlot.getCols().map(e=>({blot:e,width:Math.floor(e.width)})),t=this.tableMainBlot.getRows().map(e=>({blot:e,height:Math.floor(e.domNode.getBoundingClientRect().height)})),document.addEventListener(`mousemove`,n),document.addEventListener(`mouseup`,r))}),this.block.addEventListener(`dragstart`,e=>e.preventDefault()),this.resizeobserver.observe(this.tableMainBlot.domNode),un.call(this,this.quill.root,()=>this.update()),un.call(this,this.tableWrapperBlot.domNode,()=>this.update())}isTableOutofEditor(){if(!this.tableMainBlot||!this.tableWrapperBlot||this.tableMainBlot.full)return!1;let e=this.tableMainBlot.domNode.getBoundingClientRect(),t=this.tableWrapperBlot.domNode.getBoundingClientRect();if(e.width>t.width){for(let n of this.tableMainBlot.getCols())n.width=Math.floor(n.width/e.width*t.width);return this.tableMainBlot.colWidthFillTable(),!0}return!1}update(){if(!this.block||!this.root||!this.tableMainBlot||!this.tableWrapperBlot)return;if(this.tableMainBlot.full){this.hide();return}let{rect:e,body:t}=Qr(this.tableMainBlot);if(!t||!e)return;let n=this.tableWrapperBlot.domNode.getBoundingClientRect(),r=this.quill.root.getBoundingClientRect(),{scrollTop:i,scrollLeft:a}=this.tableWrapperBlot.domNode,o=this.options.blockSize*2+this.offset,s=Math.min(e.width,n.width)+o,c=Math.min(e.height,n.height)+o;Object.assign(this.root.style,{width:`${s}px`,height:`${c}px`,left:`${Math.max(e.x,n.x)-r.x-this.options.blockSize}px`,top:`${Math.max(e.y,n.y)-r.y-this.options.blockSize}px`});let l={left:`${e.width+o-a}px`,top:`${c-i}px`};Ai(this.tableMainBlot)?(this.root.classList.add(this.bem.is(`align-right`)),l.left=`${this.options.blockSize+-1*a}px`):this.root.classList.remove(this.bem.is(`align-right`)),Object.assign(this.block.style,l)}show(){this.root&&(this.root.classList.remove(this.bem.is(`hidden`)),this.update())}hide(){this.root&&this.root.classList.add(this.bem.is(`hidden`))}destroy(){this.hide(),this.quill.off(t.default.events.TEXT_CHANGE,this.updateWhenTextChange),this.resizeobserver.disconnect(),this.root&&this.root.remove(),dn.call(this)}},Fi=class{constructor(e,n,r,i){this.quill=e,this.isVertical=n,this.table=r,this.scrollbarContainer=i,P(this,`minSize`,20),P(this,`gap`,4),P(this,`move`,0),P(this,`cursorDown`,!1),P(this,`cursorLeave`,!1),P(this,`ratioY`,1),P(this,`ratioX`,1),P(this,`sizeWidth`,``),P(this,`sizeHeight`,``),P(this,`size`,``),P(this,`thumbState`,{X:0,Y:0}),P(this,`ob`,void 0),P(this,`container`,void 0),P(this,`scrollbar`,void 0),P(this,`thumb`,document.createElement(`div`)),P(this,`scrollHandler`,[]),P(this,`propertyMap`,void 0),P(this,`bem`,b(`scrollbar`)),P(this,`tableMainBlot`,void 0),P(this,`showScrollbar`,_n(()=>{this.cursorLeave=!1,this.scrollbar.removeEventListener(`transitionend`,this.hideScrollbarTransitionend),this.scrollbar.style.display=this.size?`block`:`none`,requestAnimationFrame(()=>{this.scrollbar.classList.remove(this.bem.is(`transparent`))})},200)),P(this,`hideScrollbar`,_n(()=>{this.cursorLeave=!0,!this.cursorDown&&(this.scrollbar.removeEventListener(`transitionend`,this.hideScrollbarTransitionend),this.scrollbar.addEventListener(`transitionend`,this.hideScrollbarTransitionend,{once:!0}),this.scrollbar.classList.add(this.bem.is(`transparent`)))},200)),P(this,`hideScrollbarTransitionend`,()=>{this.scrollbar.style.display=this.cursorDown&&this.size?`block`:`none`}),this.tableMainBlot=t.default.find(this.table),this.container=r.parentElement,this.propertyMap=this.isVertical?{size:`height`,offset:`offsetHeight`,scrollDirection:`scrollTop`,scrollSize:`scrollHeight`,axis:`Y`,direction:`top`,client:`clientY`}:{size:`width`,offset:`offsetWidth`,scrollDirection:`scrollLeft`,scrollSize:`scrollWidth`,axis:`X`,direction:`left`,client:`clientX`},this.calculateSize(),this.ob=new ResizeObserver(()=>{this.update()}),this.ob.observe(r),this.scrollbar=this.createScrollbar(),this.setScrollbarPosition(),un.call(this,this.quill.root,()=>this.setScrollbarPosition()),this.showScrollbar()}update(){this.calculateSize(),this.setScrollbarPosition()}setScrollbarPosition(){let{rect:e,body:t}=Qr(this.tableMainBlot);if(!t||!e)return;let{scrollLeft:n,scrollTop:r,offsetLeft:i,offsetTop:a}=this.quill.root,{offsetLeft:o,offsetTop:s}=this.container,{offsetLeft:c,offsetTop:l}=t.domNode,{width:u,height:d}=this.container.getBoundingClientRect(),f=o+c-i,p=s+l-a;this.isVertical?f+=Math.min(u,e.width):p+=Math.min(d,e.height),this.tableMainBlot&&this.tableMainBlot.align!==`left`&&(f+=this.table.offsetLeft-o),Object.assign(this.scrollbar.style,{[this.propertyMap.size]:`${this.isVertical?Math.min(d,e.height):u}px`,transform:`translate(${f-n}px, ${p-r}px)`}),this.containerScrollHandler(this.container)}calculateSize(){let e=this.container.offsetHeight-this.gap,t=this.container.offsetWidth-this.gap,n=Math.pow(e,2)/this.container.scrollHeight,r=Math.pow(t,2)/this.container.scrollWidth,i=Math.max(n,this.minSize),a=Math.max(r,this.minSize);this.ratioY=n/(e-n)/(i/(e-i)),this.ratioX=r/(t-r)/(a/(t-a)),this.sizeWidth=a+this.gap<t?`${a}px`:``,this.sizeHeight=i+this.gap<e?`${i}px`:``,this.size=this.isVertical?this.sizeHeight:this.sizeWidth}createScrollbar(){let e=document.createElement(`div`);e.classList.add(this.bem.b()),e.classList.add(this.isVertical?this.bem.is(`vertical`):this.bem.is(`horizontal`),this.bem.is(`transparent`)),Object.assign(e.style,{display:`none`}),this.thumb.classList.add(this.bem.be(`thumb`));let t=null,n=e=>{if(this.cursorDown===!1)return;let t=this.thumbState[this.propertyMap.axis];if(!t)return;let n=Math.pow(this.scrollbar[this.propertyMap.offset],2)/this.container[this.propertyMap.scrollSize]/(this.isVertical?this.ratioY:this.ratioX)/this.thumb[this.propertyMap.offset],r=(this.scrollbar.getBoundingClientRect()[this.propertyMap.direction]-e[this.propertyMap.client])*-1,i=this.thumb[this.propertyMap.offset]-t,a=(r-i)*100*n/this.scrollbar[this.propertyMap.offset];this.container[this.propertyMap.scrollDirection]=a*this.container[this.propertyMap.scrollSize]/100},r=()=>{this.thumbState[this.propertyMap.axis]=0,this.cursorDown=!1,document.removeEventListener(`mousemove`,n),document.removeEventListener(`mouseup`,r),this.cursorLeave&&this.hideScrollbar(),document.onselectstart=t},i=e=>{e.stopImmediatePropagation(),this.cursorDown=!0,document.addEventListener(`mousemove`,n),document.addEventListener(`mouseup`,r),t=document.onselectstart,document.onselectstart=()=>!1};this.thumb.addEventListener(`mousedown`,e=>{var t;if(e.stopPropagation(),e.ctrlKey||[1,2].includes(e.button))return;(t=window.getSelection())==null||t.removeAllRanges(),i(e);let n=e.currentTarget;n&&(this.thumbState[this.propertyMap.axis]=n[this.propertyMap.offset]-(e[this.propertyMap.client]-n.getBoundingClientRect()[this.propertyMap.direction]))});let a=[this.table,e];for(let e of a)e.addEventListener(`mouseenter`,this.showScrollbar),e.addEventListener(`mouseleave`,this.hideScrollbar);return un.call(this,this.container,()=>{this.containerScrollHandler(this.container)}),e.appendChild(this.thumb),e}containerScrollHandler(e){let t=e[this.propertyMap.offset]-this.gap;this.move=e[this.propertyMap.scrollDirection]*100/t*(this.isVertical?this.ratioY:this.ratioX),Object.assign(this.thumb.style,{[this.propertyMap.size]:this.size,transform:`translate${this.propertyMap.axis}(${this.move}%)`})}destroy(){this.ob.disconnect(),dn.call(this),this.table.removeEventListener(`mouseenter`,this.showScrollbar),this.table.removeEventListener(`mouseleave`,this.hideScrollbar)}},Ii=class{constructor(e,n,r){this.tableModule=e,this.table=n,this.quill=r,P(this,`scrollbarContainer`,void 0),P(this,`scrollbar`,void 0),P(this,`bem`,b(`scrollbar`)),P(this,`updateWhenTextChange`,()=>{this.update()}),this.scrollbarContainer=this.tableModule.addContainer(this.bem.be(`container`)),this.scrollbar=[new Fi(r,!0,n,this.scrollbarContainer),new Fi(r,!1,n,this.scrollbarContainer)];for(let e of this.scrollbar)this.scrollbarContainer.appendChild(e.scrollbar);this.quill.on(t.default.events.TEXT_CHANGE,this.updateWhenTextChange)}hide(){for(let e of this.scrollbar)e.hideScrollbar()}show(){for(let e of this.scrollbar)e.showScrollbar()}update(){for(let e of this.scrollbar)e.calculateSize(),e.setScrollbarPosition()}destroy(){this.scrollbarContainer.remove(),this.quill.off(t.default.events.TEXT_CHANGE,this.updateWhenTextChange);for(let e of this.scrollbar)e.destroy()}};let Li=0;var Ri=class{constructor(e,n,r={}){this.tableModule=e,this.quill=n,P(this,`options`,void 0),P(this,`boundary`,null),P(this,`scrollRecordEls`,[]),P(this,`startScrollRecordPosition`,[]),P(this,`selectedTableScrollX`,0),P(this,`selectedTableScrollY`,0),P(this,`selectedEditorScrollX`,0),P(this,`selectedEditorScrollY`,0),P(this,`selectedTds`,[]),P(this,`cellSelectWrap`,void 0),P(this,`cellSelect`,void 0),P(this,`dragging`,!1),P(this,`scrollHandler`,[]),P(this,`tableMenu`,void 0),P(this,`resizeObserver`,void 0),P(this,`table`,void 0),P(this,`isDisplaySelection`,!1),P(this,`bem`,b(`selection`)),P(this,`lastSelection`,{anchorNode:null,anchorOffset:0,focusNode:null,focusOffset:0}),P(this,`updateAfterEvent`,()=>{this.updateWithSelectedTds()}),P(this,`quillSelectionChangeHandler`,(e,n,r)=>{if(r!==t.default.sources.API&&e&&!this.quill.composition.isComposing&&this.selectedTds.length>0){let t=this.quill.getFormat(e),[n]=this.quill.getLine(e.index),r=!!t[d.tableCellInner]&&!!n,i=this.selectedTds.some(e=>e.children.contains(n));if(r&&!i)try{let e=x(n,d.tableCellInner);this.selectedTds=[e],this.updateWithSelectedTds()}catch(e){}else r&&i||this.hide()}}),P(this,`selectionChangeHandler`,()=>{let e=window.getSelection();if(!e)return;let{anchorNode:n,focusNode:r,anchorOffset:i,focusOffset:a}=e;if(!n||!r)return;let o=t.default.find(n),s=t.default.find(r);if(!o||!s||o.scroll!==this.quill.scroll||s.scroll!==this.quill.scroll)return;let c=C(o),l=C(s),u=c.has(d.tableColgroup),f=l.has(d.tableColgroup);if(u||f){let t=n,o=i,s=r,p=a;if(u){let e=c.get(d.tableWrapper),n=e.descendants(q);n.length>0&&(t=n[0].domNode,o=0)}if(f){let e=l.get(d.tableWrapper),t=e.descendants(q);t.length>0&&(s=t[0].domNode,p=0)}this.setSelectionData(e,{anchorNode:t,anchorOffset:o,focusNode:s,focusOffset:p});return}let p=c.has(d.tableCellInner),m=l.has(d.tableCellInner),h=p&&m;if(h){let e=c.get(d.tableCellInner),t=l.get(d.tableCellInner);h&&(h=e!==t)}if(p&&m&&h||!p&&m||!m&&p){this.setSelectionData(e,this.lastSelection),this.selectedTds.length>0&&this.hide();return}this.lastSelection={anchorNode:n,anchorOffset:i,focusNode:r,focusOffset:a}}),P(this,`mouseDownHandler`,e=>{let{button:t,target:n,clientX:r,clientY:i}=e,a=n.closest(`.ql-table`),o=n.closest(`caption`);if(t!==0||!a||o)return;this.setSelectionTable(a);let s=a.dataset.tableId,c={x:r,y:i};this.recordScrollPosition(),this.selectedTds=this.computeSelectedTds(c,c),this.dragging=!0,this.show();let l=e=>{this.tableMenu&&this.tableMenu.hide(),this.tableModule.tableResize&&this.tableModule.tableResize.hide();let{button:t,target:n,clientX:r,clientY:i}=e,a=n.closest(`.ql-table`),o=n.closest(`caption`);if(t!==0||o||!a||a.dataset.tableId!==s)return;let l={x:r,y:i};this.selectedTds=this.computeSelectedTds(c,l),this.selectedTds.length>1&&this.quill.blur(),this.update()},u=()=>{document.body.removeEventListener(`mousemove`,l,!1),document.body.removeEventListener(`mouseup`,u,!1),this.dragging=!1,this.clearRecordScrollPosition(),this.tableMenu&&this.selectedTds.length>0&&this.tableMenu.show()};document.body.addEventListener(`mousemove`,l,!1),document.body.addEventListener(`mouseup`,u,!1)}),P(this,`removeCell`,e=>{let n=this.quill.getSelection();if(!(n||e.key!==`Backspace`&&e.key!==`Delete`)){for(let e of this.selectedTds)e.deleteAt(0,e.length()-1);if(this.table){let e=t.default.find(this.table),n=e.descendants(q);this.selectedTds.length===n.length&&e.remove()}}}),this.options=this.resolveOptions(r),this.scrollRecordEls=[this.quill.root,document.documentElement],this.cellSelectWrap=e.addContainer(this.bem.b()),this.cellSelect=this.helpLinesInitial(),this.resizeObserver=ln(()=>this.updateAfterEvent(),{ignoreFirstBind:!0}),this.resizeObserver.observe(this.quill.root),this.quill.root.addEventListener(`mousedown`,this.mouseDownHandler,{passive:!1}),document.addEventListener(`selectionchange`,this.selectionChangeHandler,{passive:!1}),this.quill.on(p.AFTER_TABLE_RESIZE,this.updateAfterEvent),this.quill.on(t.default.events.SELECTION_CHANGE,this.quillSelectionChangeHandler),this.quill.on(t.default.events.TEXT_CHANGE,this.updateAfterEvent),this.options.tableMenu&&(this.tableMenu=new this.options.tableMenu(e,n,this.options.tableMenuOptions)),this.hide()}getFirstTextNode(e){for(let t of Array.from(e.childNodes))if(t.nodeType===Node.TEXT_NODE)return t;return e}getLastTextNode(e){for(let t=e.childNodes.length-1;t>=0;t--){let n=e.childNodes[t];if(n.nodeType===Node.TEXT_NODE)return n}return e}getNodeTailOffset(e){let t=document.createRange();return t.selectNodeContents(e),t.collapse(!1),t.startOffset}setSelectionData(e,t){let{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:a}=t;if(!n||!i)return;let o=document.createRange(),s=this.selectionDirectionUp(t);s?(o.setStart(n,r),o.setEnd(n,r)):(o.setStart(n,r),o.setEnd(i,a)),e.removeAllRanges(),e.addRange(o),s&&e.extend(i,a)}selectionDirectionUp(e){let{anchorNode:t,anchorOffset:n,focusNode:r,focusOffset:i}=e;if(!t||!r)return!1;if(t===r)return n>i;let a=t.compareDocumentPosition(r);return a&Node.DOCUMENT_POSITION_CONTAINS||a&Node.DOCUMENT_POSITION_CONTAINED_BY?(a&Node.DOCUMENT_POSITION_FOLLOWING)!==0:(a&Node.DOCUMENT_POSITION_PRECEDING)!==0}findWrapSelection(e){let t=null,n=0,r=null,i=0;for(let{node:a,offset:o}of e)a&&((!t||this.selectionDirectionUp({anchorNode:t,anchorOffset:n,focusNode:a,focusOffset:o}))&&(t=a,n=o),(!r||this.selectionDirectionUp({anchorNode:a,anchorOffset:o,focusNode:r,focusOffset:i}))&&(r=a,i=o));return{startNode:t,startOffset:n,endNode:r,endOffset:i}}resolveOptions(e){return Object.assign({selectColor:`#0589f340`,tableMenuOptions:{}},e)}helpLinesInitial(){this.cellSelectWrap.style.setProperty(`--select-color`,this.options.selectColor);let e=document.createElement(`div`);return e.classList.add(this.bem.be(`line`)),this.cellSelectWrap.appendChild(e),e}computeSelectedTds(e,n){if(!this.table)return[];let r=t.default.find(this.table);if(!r)return[];let i=r.descendants(Tn)[0];if(!i)return[];let a=new Set(i.descendants(X).map((e,t)=>(e.index=t,e))),o=this.getScrollPositionDiff(),{rect:s}=Qr(r);if(!s)return[];let c=e.x+o.x,l=e.y+o.y,u={x:Math.max(s.left,Math.min(n.x,c)),y:Math.max(s.top,Math.min(n.y,l)),x1:Math.min(s.right,Math.max(n.x,c)),y1:Math.min(s.bottom,Math.max(n.y,l))},d=new Set,f=!0;for(;f;){f=!1;for(let e of a){e.__rect||(e.__rect=e.domNode.getBoundingClientRect());let{x:t,y:n,right:r,bottom:i}=e.__rect;if(an({x:Math.floor(u.x),y:Math.floor(u.y),x1:Math.floor(u.x1),y1:Math.floor(u.y1)},{x:Math.floor(t),y:Math.floor(n),x1:Math.floor(r),y1:Math.floor(i)},Li,d.size===0)){d.add(e),a.delete(e),u={x:Math.min(u.x,t),y:Math.min(u.y,n),x1:Math.max(u.x1,r),y1:Math.max(u.y1,i)},f=!0;break}}}for(let e of[...d,...a])delete e.__rect;return this.boundary=on(F(F({},u),{},{width:u.x1-u.x,height:u.y1-u.y}),this.quill.root),Array.from(d).sort((e,t)=>e.index-t.index).map(e=>(delete e.index,e.getCellInner()))}getScrollPositionDiff(){let{x:e,y:t}=this.getTableViewScroll(),{x:n,y:r}=fn(this.quill.root);return this.selectedTableScrollX=e,this.selectedTableScrollY=t,this.selectedEditorScrollX=n,this.selectedEditorScrollY=r,this.startScrollRecordPosition.reduce((e,{x:t,y:n},r)=>{let{x:i,y:a}=fn(this.scrollRecordEls[r]);return e.x+=t-i,e.y+=n-a,e},{x:0,y:0})}recordScrollPosition(){this.clearRecordScrollPosition();for(let e of this.scrollRecordEls)this.startScrollRecordPosition.push(fn(e))}clearRecordScrollPosition(){this.startScrollRecordPosition=[]}updateWithSelectedTds(){if(this.selectedTds.length<=0)return;let e={x:1/0,y:1/0},t={x:-1/0,y:-1/0};for(let n of this.selectedTds){let r=n.domNode.getBoundingClientRect();e.x=Math.min(e.x,r.left),e.y=Math.min(e.y,r.top),t.x=Math.max(t.x,r.right),t.y=Math.max(t.y,r.bottom)}this.selectedTds=this.computeSelectedTds(e,t),this.selectedTds.length>0?this.update():this.hide()}update(){if(this.selectedTds.length===0||!this.boundary||!this.table)return;let{x:e,y:t}=fn(this.quill.root),{x:n,y:r}=this.getTableViewScroll(),i=this.table.parentElement.getBoundingClientRect(),a=this.quill.root.getBoundingClientRect(),o=i.x-a.x,s=i.y-a.y;Object.assign(this.cellSelect.style,{left:`${this.selectedEditorScrollX*2-e+this.boundary.x+this.selectedTableScrollX-n-o}px`,top:`${this.selectedEditorScrollY*2-t+this.boundary.y+this.selectedTableScrollY-r-s}px`,width:`${this.boundary.width}px`,height:`${this.boundary.height}px`}),Object.assign(this.cellSelectWrap.style,{left:`${o}px`,top:`${s}px`,width:`${i.width}px`,height:`${i.height}px`}),!this.dragging&&this.tableMenu&&this.tableMenu.update()}getTableViewScroll(){return this.table?fn(this.table.parentElement):{x:0,y:0}}setSelectionTable(e){this.table!==e&&(this.table=e,this.table?this.scrollRecordEls.push(this.table.parentElement):this.scrollRecordEls.pop())}showDisplay(){Object.assign(this.cellSelectWrap.style,{display:`block`}),this.isDisplaySelection=!0,this.table&&this.resizeObserver.observe(this.table)}show(){this.table&&(dn.call(this),this.update(),this.showDisplay(),document.addEventListener(`keydown`,this.removeCell),un.call(this,this.quill.root,()=>{this.update()}),un.call(this,this.table.parentElement,()=>{this.update()}))}hideDisplay(){Object.assign(this.cellSelectWrap.style,{display:`none`}),this.isDisplaySelection=!1,this.table&&this.resizeObserver.unobserve(this.table)}hide(){dn.call(this),document.removeEventListener(`keydown`,this.removeCell),this.hideDisplay(),this.boundary=null,this.selectedTds=[],this.setSelectionTable(void 0),this.tableMenu&&this.tableMenu.hide()}destroy(){this.resizeObserver.disconnect(),this.hide(),this.cellSelectWrap.remove(),this.tableMenu&&this.tableMenu.destroy(),dn.call(this),this.quill.root.removeEventListener(`mousedown`,this.mouseDownHandler),document.removeEventListener(`selectionchange`,this.selectionChangeHandler),this.quill.off(t.default.events.SELECTION_CHANGE,this.quillSelectionChangeHandler),this.quill.off(t.default.events.TEXT_CHANGE,this.updateAfterEvent),this.quill.on(p.AFTER_TABLE_RESIZE,this.updateAfterEvent)}};let zi=[`attributes`],Bi=[`style`],Vi=t.default.import(`parchment`),Hi=t.default.import(`delta`),Ui=t.default.import(`ui/icons`),Wi=t.default.import(`blots/break`),Gi=t.default.import(`blots/block`),Ki=t.default.import(`blots/block/embed`);function qi(e,{tableId:t,rowId:n,colId:r}){let i={tableId:t,rowId:n,colId:r,colspan:1,rowspan:1},a=e.create(d.tableCell,i),o=e.create(d.tableCellInner,i),s=e.create(`block`);return s.appendChild(e.create(`break`)),o.appendChild(s),a.appendChild(o),a}function Ji(e){_.delete(d.tableCellInner),Object.assign(d,e.blotName||{}),Object.assign(f,e.tableUpSize||{}),Object.assign(p,e.tableUpEvent||{}),Object.assign(m,e.tableUpInternal||{}),Zi.moduleName=m.moduleName,Zi.toolName=d.tableWrapper,K.blotName=d.container,Zr.blotName=d.tableWrapper,Z.blotName=d.tableMain,Yr.blotName=d.tableColgroup,Jr.blotName=d.tableCol,Tn.blotName=d.tableBody,J.blotName=d.tableRow,X.blotName=d.tableCell,q.blotName=d.tableCellInner,_.add(d.tableCellInner)}function Yi(e,t){return ge({onSelect:(n,r)=>{e.insertTable(n,r),t&&t.close()},customBtn:e.options.customBtn,texts:e.options.texts})}function Xi(e){return{bindInHead:!1,key:e?`ArrowUp`:`ArrowDown`,collapsed:!0,format:[d.tableCellInner],handler(n,r){let i=e?`prev`:`next`,a=e?`tail`:`head`;if(r.line[i])return!0;let o=this.quill.selection.getBounds(n.index),s=r.line.domNode.getBoundingClientRect();if(!o||!s)return!0;if(e){if(o.top-s.top>3)return!0}else if(s.bottom-o.bottom>3)return!0;let c,l,u,f;try{[c,l,u,f]=S(r.line,[d.tableWrapper,d.tableMain,d.tableRow,d.tableCell])}catch(e){return!0}let p=l.getColIds(),m=c.descendants(Kr,0)[0],h;if(m){let e=window.getComputedStyle(m.domNode);h=i===`next`&&e.captionSide===`bottom`?m:i===`next`?c.next:m}else h=c[i];if(r.line[i]||!h)return!0;let g=u[i];if(g){let e=p.indexOf(f.colId),n=g.getCellByColId(p[e],i);if(!n)return!0;let o=n.children[a];o.children&&(o=o.children[a]);let s=o.offset(this.quill.scroll)+Math.min(r.offset,o.length()-1);this.quill.setSelection(s,0,t.default.sources.USER)}else{let n=h.offset(this.quill.scroll)+(e?h.length()-1:0);this.quill.setSelection(n,0,t.default.sources.USER)}return!1}}}var Zi=class e{static register(){Zr.allowedChildren=[Z],Z.allowedChildren=[Tn,Yr,Kr],Z.requiredContainer=Zr,Kr.requiredContainer=Z,Yr.allowedChildren=[Jr],Yr.requiredContainer=Z,Tn.allowedChildren=[J],Tn.requiredContainer=Z,J.allowedChildren=[X],X.requiredContainer=Tn,X.allowedChildren=[q,Wi],X.requiredContainer=J,q.requiredContainer=X;let e=new Set([`table`]),n=Object.entries(t.default.imports).filter(([t,n])=>{let r=t.split(`formats/`)[1];return t.startsWith(`formats/`)&&!e.has(r)&&!D(n,Vi.Attributor)&&(D(n,Gi)||D(n,Ki))}),r=n.reduce((e,[t,n])=>{let r=D(n,Ki)?Rr:kn;return e[t]=class extends E(n,[r]){static register(){}},e},{});t.default.register(F(F({"blots/scroll":Vr,"blots/block":kn,"blots/block/embed":Rr},r),{},{[`blots/${d.container}`]:K,[`formats/${d.tableCell}`]:X,[`formats/${d.tableCellInner}`]:q,[`formats/${d.tableRow}`]:J,[`formats/${d.tableBody}`]:Tn,[`formats/${d.tableCol}`]:Jr,[`formats/${d.tableColgroup}`]:Yr,[`formats/${d.tableCaption}`]:Kr,[`formats/${d.tableMain}`]:Z,[`formats/${d.tableWrapper}`]:Zr,"modules/clipboard":ci}),!0)}get statics(){return this.constructor}constructor(n,r){if(P(this,`quill`,void 0),P(this,`options`,void 0),P(this,`toolBox`,void 0),P(this,`fixTableByLisenter`,_n(this.balanceTables,100)),P(this,`selector`,void 0),P(this,`table`,void 0),P(this,`tableSelection`,void 0),P(this,`tableResize`,void 0),P(this,`tableScrollbar`,void 0),P(this,`tableAlign`,void 0),P(this,`tableResizeScale`,void 0),P(this,`resizeOb`,void 0),this.quill=n,this.options=this.resolveOptions(r||{}),this.toolBox=this.initialContainer(),!this.options.scrollbar){let e=b(`scrollbar`);this.quill.container.classList.add(e.bm(`origin`))}this.options.selection&&(this.tableSelection=new this.options.selection(this,this.quill,this.options.selectionOptions));let i=this.quill.getModule(`toolbar`);if(i&&this.quill.theme.pickers){let[,e]=(i.controls||[]).find(([e])=>e===this.statics.toolName)||[];if(e&&e.tagName.toLocaleLowerCase()===`select`){let t=this.quill.theme.pickers.find(t=>t.select===e);t&&(t.label.innerHTML=this.options.icon,this.buildCustomSelect(this.options.customSelect,t),t.label.addEventListener(`mousedown`,()=>{if(!this.selector||!t)return;let e=this.selector.getBoundingClientRect(),{leftLimited:n}=cn(e);if(n){let e=t.label.getBoundingClientRect();Object.assign(t.options.style,{transform:`translateX(calc(-100% + ${e.width}px))`})}else Object.assign(t.options.style,{transform:void 0})}))}}let a=this.quill.getModule(`keyboard`);for(let t of Object.values(e.keyboradHandler))t.bindInHead?a.bindings[t.key].unshift(t):a.addBinding(t.key,t);this.quill.root.addEventListener(`click`,e=>{let t=e.composedPath();if(!t||t.length<=0)return;let n=t.find(e=>e.tagName&&e.tagName.toUpperCase()===`TABLE`&&e.classList.contains(`ql-table`));if(n){if(this.table===n){this.tableSelection&&this.tableSelection.show(),this.tableAlign&&this.tableAlign.update(),this.tableResize&&this.tableResize.update(),this.tableScrollbar&&this.tableScrollbar.update();return}this.table&&this.hideTableTools(),this.showTableTools(n)}else this.table&&this.hideTableTools()},!1),this.quill.on(t.default.events.EDITOR_CHANGE,e=>{e===t.default.events.TEXT_CHANGE&&(!this.table||!this.quill.root.contains(this.table))&&this.hideTableTools()}),this.quillHack(),this.listenBalanceCells()}initialContainer(){let e=b(`toolbox`),t=this.quill.addContainer(e.b()),n=()=>{let e=this.quill.root.getBoundingClientRect(),{offsetLeft:n,offsetTop:r}=this.quill.root;Object.assign(t.style,{top:`${r}px`,left:`${n}px`,width:`${e.width}px`,height:`${e.height}px`})};return this.resizeOb=new ResizeObserver(n),this.resizeOb.observe(this.quill.root),t}addContainer(e){if(A(e)){let t=document.createElement(`div`);for(let n of e.split(` `))t.classList.add(n);return this.toolBox.appendChild(t),t}else return this.toolBox.appendChild(e),e}resolveOptions(e){return Object.assign({customBtn:!1,texts:this.resolveTexts(e.texts||{}),full:!1,fullSwitch:!0,icon:Ui.table,selectionOptions:{},alignOptions:{},scrollbarOptions:{},resizeOptions:{},resizeScaleOptions:{},autoMergeCell:!0},e)}resolveTexts(e){return Object.assign({fullCheckboxText:`Insert full width table`,customBtnText:`Custom`,confirmText:`Confirm`,cancelText:`Cancel`,rowText:`Row`,colText:`Column`,notPositiveNumberError:`Please enter a positive integer`,custom:`Custom`,clear:`Clear`,transparent:`Transparent`,perWidthInsufficient:`The percentage width is insufficient. To complete the operation, the table needs to be converted to a fixed width. Do you want to continue?`,CopyCell:`Copy cell`,CutCell:`Cut cell`,InsertTop:`Insert row above`,InsertRight:`Insert column right`,InsertBottom:`Insert row below`,InsertLeft:`Insert column Left`,MergeCell:`Merge Cell`,SplitCell:`Split Cell`,DeleteRow:`Delete Row`,DeleteColumn:`Delete Column`,DeleteTable:`Delete table`,BackgroundColor:`Set background color`,BorderColor:`Set border color`},e)}quillHack(){let e=this.quill.getSemanticHTML;this.quill.getSemanticHTML=(n=0,r)=>{let i=e.call(this.quill,n,r),a=t.default.import(`formats/${d.tableWrapper}`),o=new DOMParser,s=o.parseFromString(i,`text/html`);for(let e of Array.from(s.querySelectorAll(`.${a.className} caption[contenteditable], .${a.className} td > [contenteditable]`)))e.removeAttribute(`contenteditable`);return s.body.innerHTML};let n=this.quill.format;this.quill.format=function(e,r,i=t.default.sources.API){let a=this.scroll.query(e);if(!(a.prototype instanceof Vi.EmbedBlot)){let t=this.getModule(m.moduleName),a=this.getSelection(!0),o=this.getFormat(a);if(!o[d.tableCellInner]||a.length>0||t&&t.tableSelection&&t.tableSelection.selectedTds.length<=1)return n.call(this,e,r,i);if(t&&t.tableSelection&&t.tableSelection.selectedTds.length>0){let n=t.tableSelection.selectedTds,a=!1,o=[];for(let t of n){let n=t.offset(this.scroll),i=t.length();o.push({index:n,length:i});let s=this.getFormat(n,i);s[e]!==r&&(a=!0)}let s=a?r:!1,c=new Hi;for(let[t,{index:n,length:r}]of o.entries()){let i=t===0?0:o[t-1].index+o[t-1].length;c.retain(n-i).retain(r,{[e]:s})}let l=this.updateContents(c,i);return this.blur(),l}}return n.call(this,e,r,i)};let r=this.quill.theme.modules.toolbar;if(r){var i;let e=(i=r.handlers)==null?void 0:i.clean;if(e){let n=(e,t,n=()=>``)=>{let r=this.quill.getText(e,t),[i,a]=this.quill.getLine(e+t),o=0,s=new Hi;i!=null&&(o=i.length()-a,s=i.delta().slice(a,a+o-1).insert(`
`));let c=this.quill.getContents(e,t+o),l=c.diff(new Hi().insert(r).concat(s)),u=0,f=l.ops.map(e=>{let{attributes:t}=e,r=R(e,zi);if(e.insert?u-=A(e.insert)?e.insert.length:1:e.retain?u+=se(e.retain)?e.retain:1:e.delete&&(u+=e.delete),t){let e=d.tableCellInner,{[e]:i}=t,a=R(t,[e].map(ye));if(n){let e=c.slice(u-1,u).ops[0];if(e&&e.attributes&&e.attributes[d.tableCellInner]){let t=e.attributes[d.tableCellInner],{style:i}=t,o=R(t,Bi),s=n(i);return s?F(F({},r),{},{attributes:F(F({},a),{},{[d.tableCellInner]:F({style:s},o)})}):F(F({},r),{},{attributes:F(F({},a),{},{[d.tableCellInner]:o})})}}return F(F({},r),{},{attributes:F({},a)})}return e});return new Hi(f)};r.handlers.clean=function(r){let i=this.quill.getModule(m.moduleName),a=this.quill.getSelection();if(a&&a.length>0){let e=this.quill.getFormat(a);if(e[d.tableCellInner]){let e=n(a.index,a.length,!1),r=new Hi().retain(a.index).concat(e);this.quill.updateContents(r,t.default.sources.USER);return}}if(i&&i.tableSelection&&i.tableSelection.selectedTds.length>0&&i.tableSelection.table){let e=t.default.find(i.tableSelection.table);if(!e){console.warn(`TableMainFormat not found`);return}let r=i.tableSelection.selectedTds,a=new Set,o=[];for(let e of r)if(e.parent instanceof X){for(let t of e.parent.getNearByCell(`top`)){if(a.has(t))continue;a.add(t),o.push({td:t,cleanBorder:`bottom`})}for(let t of e.parent.getNearByCell(`left`)){if(a.has(t))continue;a.add(t),o.push({td:t,cleanBorder:`right`})}a.add(e.parent),o.push({td:e.parent,cleanBorder:!0})}let s=e.descendants(X),c=new Map(s.map((e,t)=>[e,t]));o.sort((e,t)=>c.get(e.td)-c.get(t.td));let l=new Hi,u=0;for(let{td:e,cleanBorder:t}of o){let r=e.getCellInner().offset(this.quill.scroll),i=e.getCellInner().length(),a=n(r,i-1,e=>{if(!e||t===!0)return``;let n=pn(e),r=Object.keys(n).filter(e=>!e.startsWith(gn(`border-${t}`))).reduce((e,t)=>(e[t]=n[t],e),{});return mn(r)}),o=new Hi().retain(r-u).concat(a);l=l.concat(o),u=r+i}this.quill.updateContents(l,t.default.sources.USER),r.length>1&&this.quill.blur();return}return e.call(this,r)}}}}showTableTools(e){if(e){var t;this.table=e,(t=this.tableSelection)==null||t.show(),this.options.align&&(this.tableAlign=new this.options.align(this,e,this.quill,this.options.alignOptions)),this.options.scrollbar&&(this.tableScrollbar=new this.options.scrollbar(this,e,this.quill,this.options.scrollbarOptions)),this.options.resize&&(this.tableResize=new this.options.resize(this,e,this.quill,this.options.resizeOptions)),this.options.resizeScale&&(this.tableResizeScale=new this.options.resizeScale(this,e,this.quill,this.options.resizeScaleOptions))}}hideTableTools(){var e;(e=this.tableSelection)==null||e.hide(),this.tableScrollbar&&(this.tableScrollbar.destroy(),this.tableScrollbar=void 0),this.tableAlign&&(this.tableAlign.destroy(),this.tableAlign=void 0),this.tableResize&&(this.tableResize.destroy(),this.tableResize=void 0),this.tableResizeScale&&this.tableResizeScale.destroy(),this.table=void 0}buildCustomSelect(e,t){var n=this;return N(function*(){if(!e||!oe(e))return;let r=document.createElement(`div`);if(r.classList.add(`ql-custom-select`),n.selector=yield e(n,t),r.appendChild(n.selector),n.options.fullSwitch){let e=b(`creator`),t=document.createElement(`label`);t.classList.add(e.be(`checkbox`));let i=document.createElement(`input`);i.type=`checkbox`,i.checked=n.options.full,i.addEventListener(`change`,()=>{n.options.full=i.checked});let a=document.createElement(`span`);a.textContent=n.options.texts.fullCheckboxText,t.appendChild(i),t.appendChild(a),r.appendChild(t)}t.options.innerHTML=``,t.options.appendChild(r)})()}setCellAttrs(e,t,n,r=!1){if(e.length!==0)for(let i of e)i.setFormatValue(t,n,r)}getTextByCell(e){let t=``;for(let n of e){let e=n.offset(this.quill.scroll),r=n.length();for(let n of this.quill.getContents(e,r).ops)A(n.insert)&&(t+=n.insert)}return t}getHTMLByCell(e,t=!1){if(e.length===0)return``;let n=null;try{for(let t of e){let e=x(t,d.tableMain);if(n||(n=e),e!==n)return console.error(`tableMain is not same`),``}}catch(e){return console.error(`tds must be in same tableMain`),``}if(!n)return``;let r=this.quill.getIndex(n),i=n.length(),a=this.quill.getSemanticHTML(r,i),o=new DOMParser,s=o.parseFromString(a,`text/html`),c=[],l=new Set,u=new Set;for(let t of e)l.add(t.colId),u.add(`${t.rowId}-${t.colId}`);for(let e of Array.from(s.querySelectorAll(`col`)))l.has(e.dataset.colId)?c.push(e.getAttribute(`width`)):e.remove();let f=0,p=null;for(let e of Array.from(s.querySelectorAll(`td`)))if(u.has(`${e.dataset.rowId}-${e.dataset.colId}`))p!==e.dataset.rowId&&(f+=1,p=e.dataset.rowId);else{let t=e.parentElement;e.remove(),t&&t.children.length<=0&&t.remove()}let m=Array.from(s.querySelectorAll(`col`)),h=m.map(e=>Jr.value(e));if(n.full){let e=h.reduce((e,t)=>t.width+e,0);for(let[t,n]of h.entries())n.width=Math.round(n.width/e*100),m[t].setAttribute(`width`,`${n.width}%`)}else{let e=0;for(let t of h)e+=t.width;let t=s.querySelector(`table`);t.style.width=`${e}px`}if(t){let t=n.getRows();if(f===t.length)this.removeCol(e);else for(let t of e)t.domNode.innerHTML=`<p><br></p>`}return s.body.innerHTML}insertTable(e,n){if(e>=30||n>=30)throw Error(`Both rows and columns must be less than 30.`);this.quill.focus();let r=this.quill.getSelection();if(r==null)return;let[i]=this.quill.getLeaf(r.index);if(!i)return;if(y(i))throw Error(`Not supported ${i.statics.blotName} insert into table.`);let a=this.calculateTableCellBorderWidth(),o=getComputedStyle(this.quill.root),s=Number.parseInt(o.paddingLeft),c=Number.parseInt(o.paddingRight),l=Number.parseInt(o.width)-s-c-a,u=G(),p=Array(n).fill(0).map(()=>G()),m=this.options.full?`${Math.max(1/n*100,f.colMinWidthPre)}%`:`${Math.max(Math.floor(l/n),f.colMinWidthPx)}px`,h=[{retain:r.index}],g=this.quill.getContents(r.index,1),[,_]=this.quill.getLine(r.index);g.ops[0].insert!==`
`&&_!==0&&h.push({insert:`
`});for(let e=0;e<n;e++)h.push({insert:{[d.tableCol]:{width:m,tableId:u,colId:p[e],full:this.options.full}}});for(let t=0;t<e;t++){let e=G();for(let t=0;t<n;t++)h.push({insert:`
`,attributes:{[d.tableCellInner]:{tableId:u,rowId:e,colId:p[t],rowspan:1,colspan:1}}})}this.quill.updateContents(new Hi(h),t.default.sources.USER),this.quill.setSelection(r.index+n,t.default.sources.SILENT),this.quill.focus()}calculateTableCellBorderWidth(){let e=`
      <table class="${Z.className}">
        <tbody>
          <tr>
            <td class="${X.className}"></td>
          </tr>
        </tbody>
      </table>
    `,t=document.createElement(`div`);t.className=Zr.className,t.innerHTML=e,t.style.position=`absolute`,t.style.left=`-9999px`,t.style.top=`-9999px`,t.style.visibility=`hidden`,this.quill.root.appendChild(t);let n=window.getComputedStyle(t.querySelector(`td`)),r=Number.parseFloat(n.borderWidth)||0;return this.quill.root.removeChild(t),r}fixUnusuaDeletelTable(e){let t=e.getRows(),n=e.getColIds();if(t.length===0)return e.remove();if(n.length===0)return;let r=Array(t.length).fill(0).map(()=>Array(n.length).fill(!1)),i=e.tableId;for(let[e,a]of t.entries()){let o=0,s=0,c=r[e],l=a.descendants(X);for(;s<n.length;){if(c[s]){s+=1;continue}let u=l[o];if(!u||u.colId!==n[s])a.insertBefore(qi(this.quill.scroll,{tableId:i,colId:n[s],rowId:a.rowId}),u);else{e+u.rowspan-1>=t.length&&(u.getCellInner().rowspan=t.length-e);let{colspan:n,rowspan:i}=u;if(n>1)for(let e=1;e<n;e++)c[s+e]=!0;if(i>1)for(let t=e+1;t<e+i;t++)for(let e=0;e<n;e++)r[t][s+e]=!0;o+=1}s+=1}if(o<l.length)for(let e=o;e<l.length;e++)l[e].remove()}}balanceTables(){for(let e of this.quill.scroll.descendants(Z))e.checkEmptyCol(this.options.autoMergeCell),e.checkEmptyRow(this.options.autoMergeCell),this.fixUnusuaDeletelTable(e)}listenBalanceCells(){this.quill.on(t.default.events.SCROLL_OPTIMIZE,e=>{e.some(e=>[`TD`,`TR`,`TBODY`,`TABLE`].includes(e.target.tagName)?(this.fixTableByLisenter(),!0):!1);for(let n of e){let e=n.target;if(e.tagName===`TABLE`){let n=t.default.find(e);if(n){n.sortMergeChildren();break}}}})}deleteTable(e){if(e.length===0)return;let t=x(e[0],d.tableMain);t&&t.remove(),this.hideTableTools()}appendRow(e,t){if(e.length<=0)return;let n=e[t?e.length-1:0],[r,i,a]=S(n,[d.tableMain,d.tableBody,d.tableRow]),o=r.getRows(),s=o.indexOf(a),c=s+(t?n.rowspan:0);i.insertRow(c)}appendCol(e,t){if(e.length<=0)return;let[n]=e.reduce((e,n)=>{let r=n.getColumnIndex();return(!t&&r<=e[1]||t&&r>=e[1])&&(e=[n,r]),e},[e[0],e[0].getColumnIndex()]),r=n.getColumnIndex()+(t?n.colspan:0),i=x(n,d.tableMain),a=i.tableId,o=G(),[s]=i.descendants(Yr);s&&s.insertColByIndex(r,{tableId:a,colId:o,width:i.full?6:160,full:i.full});let c=i.getRows(),l=[],u=0;for(let e of Object.values(c)){let t=l.shift()||0;if(u>0){--u;continue}let n=e.insertCell(r-t,{tableId:a,rowId:e.rowId,colId:o,rowspan:1,colspan:1});n.skipRowNum&&(u+=n.skipRowNum);for(let[e,t]of n.entries())l[e]=(l[e]||0)+t}}fixTableByRemove(e){if(!this.options.autoMergeCell)return;let t=e.getRows(),n=e.getCols(),r=n.reduce((e,t)=>(e[t.colId]=0,e),{}),i=[...t].reverse(),a=[];for(let[e,n]of i.entries()){let i=t.length-e-1;n.children.length<=0?a.push(i):n.foreachCellInner(e=>{let t=a.reduce((t,n)=>e.rowspan+i>n?t+1:t,0);e.rowspan-=t,r[e.colId]+=1})}let o=0;for(let e of Object.values(r))if(e===0){let e=[],n=0;for(let r of Object.values(t)){let t=e.shift()||0,i=[];n>0?(i=r.getCellByColumIndex(o-t)[2],--n):(i=r.removeCell(o-t),i.skipRowNum&&(n+=i.skipRowNum));for(let[t,n]of i.entries())e[t]=(e[t]||0)+n}}else o+=1;for(let e of n)r[e.colId]===0&&(e.prev?e.prev.width+=e.width:e.next&&(e.next.width+=e.width),e.remove())}removeRow(e){if(e.length<=0)return;let t=e[0],n=x(t,d.tableMain),r=n.getRows(),i=r.length,a=-1;for(let t of e){let e=x(t,d.tableRow),n=r.indexOf(e);n<i&&(i=n),n+t.rowspan>a&&(a=n+t.rowspan)}let o={};for(let e=i;e<Math.min(r.length,a);e++){let t=r[e];t.foreachCellInner(t=>{t.rowspan+e>a&&(o[t.colId]={rowspan:t.rowspan+e-a,colspan:t.colspan,colIndex:t.getColumnIndex()}),t.parent.remove()}),t.length()===0&&t.remove()}if(r[a]){let e=r[a],t=n.tableId;for(let[n,{colIndex:r,colspan:i,rowspan:a}]of Object.entries(o))e.insertCell(r,{tableId:t,rowId:e.rowId,colId:n,colspan:i,rowspan:a})}this.fixTableByRemove(n)}removeCol(e){if(e.length<=0)return;let t=e[0],n=x(t,d.tableMain),r={};for(let t of e)r[t.rowId]||(r[t.rowId]=0),r[t.rowId]+=t.colspan;let i=Math.max(...Object.values(r)),a=t.getColumnIndex(),o=n.descendants(J);for(let e=0;e<i;e++){let e=[],t=0;for(let n of Object.values(o)){let r=e.shift()||0;if(t>0){--t;continue}let i=n.removeCell(a-r);i.skipRowNum&&(t+=i.skipRowNum);for(let[t,n]of i.entries())e[t]=(e[t]||0)+n}}let[s]=n.descendants(Yr);if(s)for(let e=0;e<i;e++)s.removeColByIndex(a);this.fixTableByRemove(n)}mergeCells(e){if(e.length<=1)return;let t=e.reduce((e,t,n)=>{let r=t.colId;e[0][r]||(e[0][r]=0),e[0][r]+=t.rowspan;let i=t.rowId;return e[1][i]||(e[1][i]=0),e[1][i]+=t.colspan,n!==0&&(t.moveChildren(e[2]),t.parent.remove()),e},[{},{},e[0]]),n=Math.max(...Object.values(t[0])),r=Math.max(...Object.values(t[1])),i=t[2];i.colspan=r,i.rowspan=n;let a=x(i,d.tableMain);this.fixTableByRemove(a)}splitCell(e){if(e.length!==1)return;let t=e[0];if(t.colspan===1&&t.rowspan===1)return;let[n,r]=S(t,[d.tableMain,d.tableRow]),i=n.tableId,a=t.getColumnIndex(),o=n.getColIds().slice(a,a+t.colspan).reverse(),s=t.formats()[d.tableCellInner].style,c=r,l=t.rowspan;for(t.colspan=1,t.rowspan=1;c&&l>0;){for(let e of o){if(c===r&&e===t.colId)continue;let n={tableId:i,rowId:c.rowId,colId:e,rowspan:1,colspan:1};s&&(n.style=s),c.insertCell(a+(c===r?1:0),n)}--l,c=c.next}}};P(Zi,`moduleName`,m.moduleName),P(Zi,`toolName`,d.tableWrapper),P(Zi,`keyboradHandler`,{"forbid remove table by backspace":{bindInHead:!0,key:`Backspace`,collapsed:!0,offset:0,handler(e,t){let n=this.quill.getLine(e.index),r=n[0];if(r.prev instanceof Zr)return r.prev.remove(),!1;if(t.format[d.tableCellInner]){let e=r.offset(x(r,d.tableCellInner));if(e===0)return!1}return!0}},"forbid remove table by delete":{bindInHead:!0,key:`Delete`,collapsed:!0,handler(e,t){let n=this.quill.getLine(e.index),r=n[0],i=n[1];if((r.next instanceof Zr||r.next instanceof Jr)&&i===r.length()-1)return!1;if(t.format[d.tableCellInner]){let e=x(r,d.tableCellInner);if(r===e.children.tail&&i===r.length()-1)return!1}return!0}},"table up":Xi(!0),"table down":Xi(!1),"table caption break":{bindInHead:!0,key:`Enter`,shiftKey:null,format:[d.tableCaption],handler(e,t){return!1}}});var Qi=Zi;exports.BlockEmbedOverride=Rr,exports.BlockOverride=kn,exports.ContainerFormat=K,exports.ScrollOverride=Vr,exports.Scrollbar=Fi,exports.TableAlign=$r,exports.TableBodyFormat=Tn,exports.TableCaptionFormat=Kr,exports.TableCellFormat=X,exports.TableCellInnerFormat=q,exports.TableClipboard=ci,exports.TableColFormat=Jr,exports.TableColgroupFormat=Yr,exports.TableMainFormat=Z,exports.TableMenuCommon=Di,exports.TableMenuContextmenu=Oi,exports.TableMenuSelect=ki,exports.TableResizeBox=Mi,exports.TableResizeCommon=ji,exports.TableResizeLine=Ni,exports.TableResizeScale=Pi,exports.TableRowFormat=J,exports.TableSelection=Ri,exports.TableUp=Zi,exports.TableVirtualScrollbar=Ii,exports.TableWrapperFormat=Zr,exports.blotName=d,exports.createColorPicker=le,exports.createSelectBox=ge,exports.createTooltip=rn,exports.default=Qi,exports.defaultCustomSelect=Yi,exports.findParentBlot=x,exports.findParentBlots=S,exports.getTableMainRect=Qr,exports.isTableAlignRight=Ai,exports.randomId=G,exports.tableMenuTools=Q,exports.tableUpEvent=p,exports.tableUpInternal=m,exports.tableUpSize=f,exports.updateTableConstants=Ji});
//# sourceMappingURL=index.umd.js.map